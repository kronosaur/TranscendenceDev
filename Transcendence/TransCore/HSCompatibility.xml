<?xml version="1.0" encoding="utf-8"?>

<TranscendenceModule>

<!-- COMPATIBILITY TYPES =======================================================

	This module contains types that have been DEPRECATED and superceded by 
	newer types.

							API
	OLD TYPE				VERSION		NEW TYPE

	stCargoCrate			26			stGenericCargoCrate
	stNavSign				19			stCommonwealthNavSign
	dsFleetDockServices		23			Use rpgDockServices function and <Trade>

	-->

	<!-- Cargo Crate -->

	<StationType UNID="&stCargoCrate;"
			obsoleteVersion=			"37"
			name=				"abandoned cargo crate"
			sovereign=			"&svNeutral;"
			abandonedScreen=	"&dsAbandonedCrate;"

			structuralHitPoints="10"
			ejectaType=			"&vtWreckEjecta;"

			scale=				"ship"
			mobile=				"true"
			mass=				"50"
			destroyWhenEmpty=	"true"
			noMapIcon=			"true"
			>

		<ImageVariants>
			<Image			imageID="&rsStations1;" imageX="480" imageY="256" imageWidth="32" imageHeight="32" />
			<Image			imageID="&rsStations1;" imageX="480" imageY="288" imageWidth="32" imageHeight="32" />
			<Image			imageID="&rsStations1;" imageX="480" imageY="320" imageWidth="32" imageHeight="32" />
			<Image			imageID="&rsStations1;" imageX="480" imageY="352" imageWidth="32" imageHeight="32" />
		</ImageVariants>

		<Events>
			<GetExplosionType>
				(intContainerGetExplosionType gSource)
			</GetExplosionType>

			<OnDamage>
				(intContainerOnDamage gSource aDamageHP)
			</OnDamage>
		</Events>

		<DockingPorts
				portCount=		"2"
				portRadius=		"24"
				maxDist=		"3"
				/>

	</StationType>

	<StationType UNID="&stNavSign;"
			obsoleteVersion=			"37"
			name=				"(navigational beacon)"
			sovereign=			"&svIndependent;"
			dockScreen=			"&dsNavSign;"
			abandonedScreen=	"&dsAbandonedNavSign;"
			noMapLabel=			"true"

			mass=				"5000"
			armorID=			"&itUltraLightTitaniumArmor;"
			hitPoints=			"10"

			sign=				"true"
			>

		<Image imageID="&rsStations1;" imageX="0" imageY="668" imageWidth="128" imageHeight="64"/>

		<DockingPorts>
			<Port x="-80"		y="0" />
		</DockingPorts>
	</StationType>

	<!-- Fleet Dock Services -->

	<DockScreen UNID="&dsFleetDockServices;"	nestedScreen="true"
			obsoleteVersion=			"37"
			>
		<Panes>
			<Default>
				<OnPaneInit>
					(block Nil
						; Set the description
						(scrSetDesc gScreen "You are at the docking services deck.")
						)
				</OnPaneInit>

				<Actions>
					<Action name="Refuel" key="R">
						(block Nil
							; Figure out what kind of fuel to use
							(intSetCompatibleFuelEx '((&itPteracniumFuelRod; 88) (&itXenotiteFuelRod; 88) (&itHeliumAssembly; 88)))

							; Free refueling if level 3 or higher
							(if (geq (objGetData gPlayerShip "fleetLevel") 3)
								(setq gCost 0)
								)

							(scrShowScreen gScreen "&dsRefuel;")
							)
					</Action>

					<Action name="Repair or Replace Armor" key="A" >
						(block Nil
							(setq gTechLevel 10)
							(setq gArmorSegment 0)
							(setq gCheckMilitaryID True)
							; Dock services are free if at fleetLevel 4 or greater
							(setq gMargin (if (geq (objGetData gPlayerShip "fleetLevel") 4) 0 100))
							(scrShowScreen gScreen "&dsRepairArmor;")
							)
					</Action>

					<Action name="Install Device" key="D" >
						(block Nil
							(setq gTechLevel 9)
							(setq gTechModifier Nil)
							(setq gCheckMilitaryID True)
							(setq gMargin (if (geq (objGetData gPlayerShip "fleetLevel") 4) 0 100))
							(scrShowScreen gScreen "&dsInstallDevice;")
							)
					</Action>

					<Action name="Remove Device" key="V" >
						(block Nil
							(setq gMargin (if (geq (objGetData gPlayerShip "fleetLevel") 4) 0 100))
							(scrShowScreen gScreen "&dsRemoveDevice;")
							)
					</Action>

					<Action name="Upgrade Reactor" key="P" >
						(scrShowScreen gScreen &dsRPGInstallDeviceFromList;
							{
							itemList: (rpgGetReactorUpgradeList gSource gPlayerShip "r L:1-9;")
							priceAdj: 100
							checkMilitaryID: Nil
							noItemsText: "The technology required to upgrade your reactor is not available at this station."
							})
					</Action>

					<Action name="Done" cancel="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</Default>
		</Panes>
	</DockScreen>

	<!-- Battle Arena Wall -->

	<StationType UNID="&stBattleArenaWall;"
			obsoleteVersion=			"37"
			name=				"(arena wall segment)"
			sovereign=			"&svCommonwealth;"
			attributes=			"battleArenaSegment"

			barrier=			"true"
			barrierEffect=		"&efBattleArenaWallHit;"
			multiHull=			"true"
			immutable=			"true"

			mass=				"500"
			noMapLabel=			"true"
			>

		<ImageVariants>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="0"    imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="128"  imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="256"  imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="384"  imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="512"  imageWidth="128" imageHeight="128"/>

			<Image			imageID="&rsBattleArena;" imageX="0" imageY="640"  imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="768"  imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="896"  imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="1024" imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="1152" imageWidth="128" imageHeight="128"/>

			<Image			imageID="&rsBattleArena;" imageX="0" imageY="1280" imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="1408" imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="1536" imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="1664" imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="1792" imageWidth="128" imageHeight="128"/>

			<Image			imageID="&rsBattleArena;" imageX="0" imageY="1920" imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="2048" imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="2176" imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="2304" imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArena;" imageX="0" imageY="2432" imageWidth="128" imageHeight="128"/>
			
			<Image			imageID="&rsBattleArenaExtra;" imageX="0" imageY="0"	imageWidth="164" imageHeight="164"/>
			<Image			imageID="&rsBattleArenaExtra;" imageX="0" imageY="164"	imageWidth="164" imageHeight="164"/>
			<Image			imageID="&rsBattleArenaExtra;" imageX="18" imageY="18"	imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArenaExtra;" imageX="18" imageY="182"	imageWidth="128" imageHeight="128"/>
			<Image			imageID="&rsBattleArenaExtra;" imageX="0" imageY="0"	imageWidth="0"	 imageHeight="0"/>
		</ImageVariants>

	</StationType>

	<Image UNID="&rsBattleArena;"	bitmap="Resources\BattleArena.jpg"	bitmask="Resources\BattleArenaMask.bmp"  loadOnUse="true"
			obsoleteVersion=			"37"
			/>
	<Image UNID="&rsBattleArenaExtra;"	bitmap="Resources\BattleArenaExtra.jpg" bitmask="Resources\BattleArenaExtraMask.bmp" loadOnUse="true"
			obsoleteVersion=			"37"
			/>
	
	<!-- Install weapon screen

		gTechLevel: Tech level at which device is installed
		gTechModifier: Can install if item has given modifier
		gCheckMilitaryID: If True, this screen does not allow installing
				military weapons without an ID
		gMargin: 100 = same as install cost
	-->

	<DockScreen UNID="&dsInstallWeapon;"
			type=				"itemPicker"
			nestedScreen=		"true"
			obsoleteVersion=			"37"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"wUN"
			/>

		<Panes>
			<Default
					desc=	"Pick a weapon to install.">

				<OnPaneInit>
					(block (thisItem)
						(setq theResult
							(intInstallDevicePrepEx
								(scrGetItem gScreen)				; item to install
								Nil									; Cost to install
								gMargin								; install cost margin
								(objGetDefaultCurrency gSource)		; currency to use
								gTechLevel							; max tech level
								Nil									; install criteria
								gCheckMilitaryID					; check military ID
								True									; item is in cargo
								Nil									; buy and install
								(if gTechModifier					; tech criteria override
									(cat "w +" gTechModifier ";")
									)
								)
							)
							
						(setq gCanInstall (item theResult 0))
						(setq gCost (item theResult 1))
							
						(scrSetDesc gScreen (item theResult 2))

						; Disable actions
						(scrEnableAction gScreen 0 gCanInstall)
						)
				</OnPaneInit>

				<Actions>
					<Action name="Install this Weapon" default="1" key="I">
						(if gCanInstall
							(block Nil
								(shpInstallDevice gPlayerShip (scrGetItem gScreen))
								(objCharge gPlayerShip (objGetDefaultCurrency gSource) gCost)
								(typSetData &svPlayer; 'tutorialInstalled True)
								(scrExitScreen gScreen)
								)
							)
					</Action>

					<Action name="Cancel" cancel="1" key="C">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</Default>
		</Panes>
	</DockScreen>

	<!-- Remove weapon screen -->

	<DockScreen UNID="&dsRemoveWeapon;"
			type=				"itemPicker"
			nestedScreen=		"true"
			obsoleteVersion=			"37"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"wI"
			/>

		<Panes>
			<Default
					desc=	"Pick a weapon to remove.">

				<OnPaneInit>
					(block (thisItem currencyUsed)
						(setq thisItem (scrGetItem gScreen))
						(setq currencyUsed (objGetDefaultCurrency gSource))
						
						(if thisItem
							(block Nil
								; Half the price of install cost
								(setq gCost (divide (itmGetInstallCost thisItem currencyUsed) 2))

								(switch
									(gr (itmGetMass thisItem) (objGetCargoSpaceLeft gPlayerShip))
										(block Nil
											(scrSetDesc gScreen "This weapon cannot be removed because there is no room in your cargo hold to store it.")
											(setq thisItem Nil)
											)

									(ls (objGetBalance gPlayerShip currencyUsed) gCost)
										(scrSetDesc gScreen (cat "This weapon can be removed from your ship for " (fmtCurrency currencyUsed gCost) ". Unfortunately, you cannot afford the cost."))

									(scrSetDesc gScreen (cat "This weapon can be removed from your ship for " (fmtCurrency currencyUsed gCost) "."))
									)
								)
							(scrSetDesc gScreen "You do not have any weapons that can be removed.")
							)

						; Enable/disable actions
						(scrEnableAction gScreen 0
							(and thisItem (geq (plyGetCredits gPlayer) gCost))
							)
						)
				</OnPaneInit>

				<Actions>
					<Action name="Remove this Weapon" default="1" key="R">
						(block (thisItem currencyUsed)
							(setq thisItem (scrGetItem gScreen))
							(setq currencyUsed (objGetDefaultCurrency gSource))

							(if (and thisItem (geq (objGetBalance gPlayerShip currencyUsed) gCost))
								(block Nil
									(shpRemoveDevice gPlayerShip thisItem)
									(objCharge gPlayerShip currencyUsed gCost)
									(scrExitScreen gScreen)
									)
								)
							)
					</Action>

					<Action name="Cancel" cancel="1" key="C">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</Default>
		</Panes>
	</DockScreen>

	<!-- Commodities Exchange
	
		gMargin: This is the mark-up as a percentage of the item price.

		gInstallCriteria: Install items that match this criteria.
			If gInstallCriteria is not Nil, then:

			gTechLevel: Tech capability of this station
			gCheckMilitaryID: If True, this screen does not allow installing
					military weapons without an ID
			gInstallMargin: 100 = same as install cost

		-->

	<DockScreen UNID="&dsExchangeBuy;"
			type=				"itemPicker"
			nestedScreen=		"true"
			obsoleteVersion=			"37"
			>

		<ListOptions
				dataFrom=	"station"
				list=		"*"
				>
			(switch
				(not gMargin)
					(scrSetListFilter gScreen intComputeSellPrice)

				(isfunction gMargin)
					(scrSetListFilter gScreen gMargin)

				(scrSetListFilter gScreen "*")
				)
		</ListOptions>

		<Panes>
			<Default
					desc=			"There are no items here.">

				<OnPaneInit>
					(block (thisItem)
						(setq thisItem (scrGetItem gScreen))
						(if thisItem
							(block (affordCount availCount currencyUsed desc fitCount)

								; Set the currency

								(setq currencyUsed (objGetDefaultCurrency gSource))
								
								; Compute the cost of this item.

								(switch
									; If gMargin is a function, then we call the function
									; to evaluate the price.

									(isfunction gMargin)
										(setq gCost (apply gMargin thisItem Nil))
										
									; Otherwise we let the station price the item
									
									(setq gCost (objGetSellPrice gSource thisItem))
									)
									
								(if (not gCost) (setq gCost 0))

								(setq availCount (itmGetCount thisItem))

								(if (gr gCost 0)
									(setq affordCount (divide (objGetBalance gPlayerShip currencyUsed) gCost))
									(setq affordCount 0)
									)

								(setq fitCount (objGetFitCount gPlayerShip thisItem))
								
								(setq gMaxCount (min availCount affordCount fitCount))

								; Set the price and description
								(setq desc (cat "Unit price: " (if (eq gCost 0) "N/A" (fmtCurrency currencyUsed gCost))))
								(if (gr gMaxCount 1)
									(setq desc (cat desc " (" gMaxCount " for " (fmtCurrency currencyUsed (multiply gCost gMaxCount)) ")"))
									)

								(setq desc (cat desc "\nUnit mass: " (fmtNumber 'massKg (itmGetMass thisItem))))
								(if (gr gMaxCount 1)
									(setq desc (cat desc " (" gMaxCount " at " (fmtNumber 'massKg (multiply (itmGetMass thisItem) gMaxCount)) ")"))
									)

								(setq desc (cat desc "\n\n"))

								(switch
									(eq gCost 0)
										(setq desc (cat desc "This item is not for sale."))
									(eq affordCount 0)
										(setq desc (cat desc "You do not have enough " (fmtCurrency currencyUsed True) " to purchase any."))
									(eq fitCount 0)
										(setq desc (cat desc "Unfortunately, you cannot fit any in your cargo hold."))
									(and (gr availCount affordCount) (gr fitCount affordCount))
										(setq desc (cat desc "You have enough " (fmtCurrency currencyUsed True) " to buy " affordCount "."))
									(and (gr availCount fitCount))
										(setq desc (cat desc "You have enough room in your cargo hold to carry " fitCount "."))
									)

								(scrSetDesc gScreen desc)
								)
							(setq gMaxCount 0)
							)

						; Enable/disable actions
						(scrEnableAction gScreen 0 (gr gMaxCount 0))
						)
				</OnPaneInit>

				<Actions>
					<Action name="Buy this Item" default="1" key="B">
						(if (gr gMaxCount 1)
							(scrShowPane gScreen "BuyQuantity")
							(if (eq gMaxCount 1)
								(block Nil
									(setq gItem (scrGetItem gScreen))

									; Install?
									
									(switch
										(and gInstallCriteria
												(item
													(intInstallDevicePrepEx
														gItem								; item to install
														0									; specify cost of 0 because we check later
														Nil									; install cost margin
														(objGetDefaultCurrency gSource)		; currency to use
														gTechLevel							; max tech level
														gInstallCriteria					; install criteria
														gCheckMilitaryID					; check military ID
														True								; item is in cargo
														True)								; buy and install
													0)
												)
											(scrShowPane gScreen "InstallItem")
											
										; Otherwise...
										
										(block Nil
											(rpgBuyItems 1 gCost)
											(scrShowPane gScreen "Default")
											)
										)
									)
								)
							)
					</Action>

					<Action name="Done" cancel="1" key="D">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</Default>

			<BuyQuantity
					showCounter=	"true">

				<OnPaneInit>
					(block Nil
						(scrSetDesc gScreen (cat "How many items do you wish to purchase at " (fmtCurrency (objGetDefaultCurrency gSource) gCost) " each?"))
						(scrSetCounter gScreen gMaxCount)
						)
				</OnPaneInit>

				<Actions>
					<Action name="Buy" default="1" key="B">
						(block (count)
							(setq gItem (scrGetItem gScreen))
							(setq count (scrGetCounter gScreen))
							(if (gr count gMaxCount)
								(scrSetCounter gScreen gMaxCount)
								
								; Install?
								(if (and gInstallCriteria
										(eq count 1)
										(item
											(intInstallDevicePrepEx
												gItem								; item to install
												0									; specify cost of 0 because we check later
												Nil									; install cost margin
												(objGetDefaultCurrency gSource)		; currency to use
												gTechLevel							; max tech level
												gInstallCriteria					; install criteria
												gCheckMilitaryID					; check military ID
												True								; item is in cargo
												True)								; buy and install
											0)
										)
									(scrShowPane gScreen "InstallItem")
									
									; Otherwise...
									
									(block Nil
										(rpgBuyItems count gCost)
										(scrShowPane gScreen "Default")
										)
									)
								)
							)
					</Action>

					<Action name="Cancel" cancel="1" key="C">
						<ShowPane pane="Default"/>
					</Action>

				</Actions>

			</BuyQuantity>

			<InstallItem
					noListNavigation="true"
					>
				<OnPaneInit>
					(block (currencyUsed desc installResult)
						(setq gItem (itmSetCount (scrGetItem gScreen) 1))
						(setq currencyUsed (objGetDefaultCurrency gSource))

						(setq installResult						
							(intInstallDevicePrepEx
								gItem								; item to install
								Nil									; compute installation cost
								gInstallMargin						; install cost margin
								currencyUsed						; currency to use
								gTechLevel							; max tech level
								gInstallCriteria					; install criteria
								gCheckMilitaryID					; check military ID
								True								; item is in cargo
								True)								; buy and install
							)

						(setq gCanInstall (item installResult 0))
						(setq gInstallCost (item installResult 1))
						(setq gDesc (item installResult 2))

						(switch
							(gr (add gCost gInstallCost) (objGetBalance gPlayerShip currencyUsed))
								(block Nil
									(setq desc (cat gDesc
										"\n\nUnfortunately, you cannot afford the installation cost. "
										"Do you wish to buy it without installation for " (fmtCurrency currencyUsed gCost) "?"
										))
									(setq gCanInstall Nil)
									)

							(setq desc (cat gDesc
								"\n\nDo you wish to buy and install it for " (fmtCurrency currencyUsed (add gCost gInstallCost)) ", "
								"or do you wish to only buy it for " (fmtCurrency currencyUsed gCost) "?"
								))
							)

						(scrSetDesc gScreen desc)

						; Disable actions
						(scrEnableAction gScreen 0 gCanInstall)
						)
				</OnPaneInit>

				<Actions>
					<Action name="Buy &amp; Install" default="1" key="I">
						(if gCanInstall
							(block (itemInstalled)
								;	We need to store gItem elsewhere in case it gets clobbered
								;	after we buy it.
								
								(setq itemInstalled gItem)
								(scrSetData gScreen 'itemInstalled itemInstalled)
								
								(rpgBuyItems 1 (add gCost gInstallCost))
								
								(shpInstallDevice gPlayerShip itemInstalled)
								(typSetData &svPlayer; 'tutorialInstalled True)
								(scrShowPane gScreen "InstallSuccess")
								)
							)
					</Action>

					<Action name="Buy Only" key="B">
						(block Nil
							(rpgBuyItems 1 gCost)
							(scrShowPane gScreen "Default")
							)
					</Action>

					<Action name="Cancel" cancel="1" key="C">
						(scrShowPane gScreen "Default")
					</Action>
				</Actions>
			</InstallItem>

			<InstallSuccess
					noListNavigation="true"
					>
				<OnPaneInit>
					(block (itemInstalled)
						(setq itemInstalled (scrGetData gScreen 'itemInstalled))
						(scrSetDesc gScreen
							(cat (itmGetName itemInstalled 0x01) " installed successfully.")
							)
						)
				</OnPaneInit>

				<Actions>
					<Action name="Continue" default="1" cancel="1" key="C">
						(scrShowPane gScreen "Default")
					</Action>
				</Actions>
			</InstallSuccess>
		</Panes>

	</DockScreen>

	<!-- Install device screen

		gTechLevel: Tech capability of this station
		gTechModifier: Can install if item has given modifier
		gCheckMilitaryID: If True, this screen does not allow installing
				military weapons without an ID
		gMargin: 100 = same as install cost
	-->

	<DockScreen UNID="&dsInstallDevice;"
			type=				"itemPicker"
			nestedScreen=		"true"
			obsoleteVersion=			"37"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"dUN"
			/>

		<Panes>
			<Default
					desc=	"Pick a device to install.">

				<OnPaneInit>
					(block (thisItem theResult)
						(setq theResult
							(intInstallDevicePrepEx
								(scrGetItem gScreen)				; item to install
								Nil									; Nil cost means we compute it
								gMargin								; install cost margin
								(objGetDefaultCurrency gSource)		; currency to use
								gTechLevel							; max tech level
								Nil									; install criteria
								gCheckMilitaryID					; check military ID
								True								; item is in cargo
								Nil									; buy and install
								(if gTechModifier					; tech criteria override
									(cat "d +" gTechModifier ";")
									)
								)
							)
					
						(setq gCanInstall (item theResult 0))
						(setq gCost (item theResult 1))

						; Set the description						
						(scrSetDesc gScreen (item theResult 2))

						; Disable actions
						(scrEnableAction gScreen 0 gCanInstall)
						)
				</OnPaneInit>

				<Actions>
					<Action name="Install this Device" default="1" key="I">
						(if gCanInstall
							(block Nil
								(shpInstallDevice gPlayerShip (scrGetItem gScreen))
								(objCharge gPlayerShip (objGetDefaultCurrency gSource) gCost)
								(typSetData &svPlayer; 'tutorialInstalled True)
								
								(scrExitScreen gScreen)
								)
							)
					</Action>

					<Action name="Cancel" cancel="1" key="C">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</Default>
		</Panes>
	</DockScreen>

	<!-- Repair armor 

		gTechLevel: Tech level at which armor is repaired
		gArmorSegment: Armor segment being repaired/replaced (0-3)
		gCheckMilitaryID: If True, check to make sure player has military ID to install military armor
		gMargin: Cost multiplies (100 = no adjustment; <100 = discount; >100 = surcharge)

	-->

	<DockScreen UNID="&dsRepairArmor;"
			type=				"itemPicker"
			nestedScreen=		"true"
			obsoleteVersion=			"37"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"aI"

			initialItem="=(eq (itmGetArmorInstalledLocation (scrGetItem gScreen)) gArmorSegment)"
			/>

		<Panes>

			<Default
					desc=	"">

				<OnPaneInit>
					(block (currencyUsed type damage desc)
						(setq currencyUsed (objGetDefaultCurrency gSource))
						(setq gArmorSegment (itmGetArmorInstalledLocation (scrGetItem gScreen)))
						(setq type (objGetArmorType gPlayerShip gArmorSegment))
						(setq damage (objGetArmorDamage gPlayerShip gArmorSegment))
						(setq desc (cat "The ship's " (objGetArmorName gPlayerShip gArmorSegment) " " (armGetName type)))
						(setq maxHP (shpGetArmorMaxHitPoints gPlayerShip gArmorSegment))
						(setq gCanRepair True)
						(setq gCost (ecoExchange (multiply damage (armGetRepairCost type)) (itmGetDefaultCurrency type) currencyUsed))
						(setq gCost (divide (multiply gMargin gCost) 100))
						(switch
							(eq damage 0)
								(block Nil
									(setq desc (cat desc " is not damaged."))
									(setq gCanRepair Nil)
									)
							(gr (armGetRepairTech type) gTechLevel)
								(block Nil
									(setq desc (cat desc " cannot be repaired. The technology required is not available at this station."))
									(setq gCanRepair Nil)
									)
							(ls (subtract maxHP damage) (divide maxHP 4))
								(block Nil
									(setq desc (cat desc " is heavily damaged and cannot be repaired."))
									(setq gCanRepair Nil)
									)
							(ls (objGetBalance gPlayerShip currencyUsed) gCost)
								(block Nil
									(setq desc (cat desc " can be repaired for " (fmtCurrency currencyUsed gCost) ", which, unfortunately, is more than you can afford."))
									(setq gCanRepair Nil)
									)
							(eq gCost 0)
								(setq desc (cat desc " is damaged and can be repaired free of charge."))

							(setq desc (cat desc " is damaged and will cost " (fmtCurrency currencyUsed gCost) " to repair."))
							)
						(scrSetDesc gScreen desc)

						; Disable actions if we cannot repair
						(scrEnableAction gScreen 0 gCanRepair)
						)
				</OnPaneInit>

				<Actions>
					<Action name="Repair" key="R" >
						(if gCanRepair
							(block Nil
								(objRepairArmor gPlayerShip gArmorSegment)
								(objCharge gPlayerShip (objGetDefaultCurrency gSource) gCost)
								(scrShowPane gScreen "Default")
								)
							)
					</Action>

					<Action name="Replace" key="P" >
						(scrShowScreen gScreen "&dsReplaceArmor;")
					</Action>

					<Action name="Done" cancel="1" key="D">
						(scrExitScreen gScreen)
					</Action>

				</Actions>
			</Default>
		</Panes>
	</DockScreen>

	<!-- Replace armor screen -->

	<DockScreen UNID="&dsReplaceArmor;"
			type=				"itemPicker"
			nestedScreen=		"true"
			obsoleteVersion=			"37"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"aU"
			/>

		<Panes>
			<Default
					desc=	"Pick an armor segment to install.">

				<OnPaneInit>
					(block (thisItem canInstall currencyUsed)
						(setq thisItem (scrGetItem gScreen))
						(setq canInstall True)
						(setq currencyUsed (objGetDefaultCurrency gSource))
						
						(if thisItem
							(block (desc cargoNeeded)
								(setq gResult (shpCanInstallArmor gPlayerShip thisItem gArmorSegment))
								(setq gCost (divide (multiply gMargin (itmGetInstallCost thisItem currencyUsed)) 100))
								(setq cargoNeeded (subtract (itmGetMass (shpGetArmor gPlayerShip gArmorSegment)) (itmGetMass thisItem)))

								(switch
									(eq gResult 1)
										(block Nil
											(setq desc (cat (itmGetName thisItem 3) " are too heavy for your ship's hull."))
											(setq canInstall Nil)
											)

									(and gCheckMilitaryID 
											(itmHasModifier thisItem "Military")
											(not (objGetItems gPlayerShip "*+MilitaryID"))
											)
										(block Nil
											(setq desc (cat "You must have a military ID to install " (itmGetName thisItem 0x80) "."))
											(setq canInstall Nil)
											)
											
									(and gCheckMilitaryID
											(itmHasModifier thisItem "Illegal")
											)
										(block Nil
											(setq desc "We do not install illegal armor segments.")
											(setq canInstall Nil)
											)
											
									(not (isint gResult))
										(block Nil
											(setq desc gResult)
											(setq canInstall Nil)
											)

									(not (eq gResult 0))
										(block Nil
											(setq desc "This armor segment cannot be installed.")
											(setq canInstall Nil)
											)

									(gr cargoNeeded (objGetCargoSpaceLeft gPlayerShip))
										(block Nil
											(setq desc "There is no room in your cargo hold to store the old armor segment.")
											(setq canInstall Nil)
											)

									(gr gCost (objGetBalance gPlayerShip currencyUsed))
										(block Nil
											(setq desc (cat "This armor segment can be installed for " (fmtCurrency currencyUsed gCost) ". Unfortunately, you cannot afford this cost."))
											(setq canInstall Nil)
											)

									(eq gCost 0)
										(setq desc "This armor segment can be installed free of charge.")

									(setq desc (cat "This armor segment can be installed for " (fmtCurrency currencyUsed gCost) "."))
									)

								(scrSetDesc gScreen desc)
								)

							(block Nil
								(scrSetDesc gScreen "You do not have any armor segments in your cargo hold.")
								(setq canInstall Nil)
								)
							)

						(scrEnableAction gScreen 0 canInstall)
						)
				</OnPaneInit>

				<Actions>
					<Action name="Install this Armor" default="1" key="I" >
						(block (thisItem currencyUsed)
							(setq thisItem (scrGetItem gScreen))
							(setq currencyUsed (objGetDefaultCurrency gSource))

							(if (and thisItem (geq (objGetBalance gPlayerShip currencyUsed) gCost))
								(block Nil
									(shpInstallArmor gPlayerShip thisItem gArmorSegment)
									(objCharge gPlayerShip currencyUsed gCost)
									
									(scrExitScreen gScreen)
									)
								)
							)
					</Action>

					<Action name="Cancel" cancel="1" key="C">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</Default>
		</Panes>
	</DockScreen>
	
	<!-- Sisters Intro
	
	NOTE: Deprecated in 1.3. See BenedictStoryArc.xml instead.
	
	-->

	<DockScreen UNID="&dsSistersIntro;"
			nestedScreen=	"true"
			obsoleteVersion=			"37"
			>

		<Panes>
			<Default>
				<OnPaneInit>
					(block Nil
						(scrSetDesc gScreen "You are docked at an abbey of the Sisters of Domina. A woman wearing a flowing red robe approaches you.\n\n\"Welcome, pilgrim! Your journey to the Galactic Core has just begun. Your path will be filled with many obstacles, but do not worry: Domina chooses only those who have the strength to succeed.\"")

						(objSetData gSource "freeSanctum" True)
						(objSetData gPlayerShip "sistersStory" "done")
						)
				</OnPaneInit>

				<Actions>
					<Action name="&quot;Who is Domina?&quot;" default="1" key="D">
						<ShowPane pane="A1"/>
					</Action>
					<Action name="&quot;How do I reach the Galactic Core?&quot;" key="G">
						<ShowPane pane="A2"/>
					</Action>
					<Action name="&quot;What kind of obstacles will I face?&quot;" key="W">
						<ShowPane pane="A3"/>
					</Action>
					<Action name="Done" cancel="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</Default>

			<A1 desc="&quot;Domina speaks to you in your dreams and visions. She summons those like you to journey to the Core. Perhaps if you reach her you will understand. But do not be afraid&#x97;Domina will protect you.&quot;">
				<Actions>
					<Action name="&quot;How do I reach the Galactic Core?&quot;" default="1" key="G">
						<ShowPane pane="A11"/>
					</Action>
					<Action name="&quot;What kind of obstacles will I face?&quot;" key="W">
						<ShowPane pane="A12"/>
					</Action>
					<Action name="Done" cancel="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A1>

			<A11 desc="&quot;The stargates will take you. Seek them out and enter. But be prepared for many obstacles. You must grow stronger to reach the Core.&quot;">
				<Actions>
					<Action name="&quot;What kind of obstacles will I face?&quot;" default="1" key="W">
						<ShowPane pane="A111"/>
					</Action>
					<Action name="Done" cancel="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A11>

			<A111 desc="&quot;Star travel is not safe anymore. Pirates, outlaws and worse will attack you. But if you can overcome them, you might be able to improve the weapons and armor of your own ship.&quot;">
				<Actions>
					<Action name="Done" cancel="1" default="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A111>

			<A12 desc="&quot;Star travel is not safe anymore. Pirates, outlaws and worse will attack you. But if you can overcome them, you might be able to improve the weapons and armor of your own ship.&quot;">
				<Actions>
					<Action name="&quot;How do I reach the Galactic Core?&quot;" default="1" key="G">
						<ShowPane pane="A121"/>
					</Action>
					<Action name="Done" cancel="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A12>

			<A121 desc="&quot;The stargates will take you. Seek them out and enter. But remember that the farther you go, the greater the dangers.&quot;">
				<Actions>
					<Action name="Done" cancel="1" default="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A121>


			<A2 desc="&quot;The stargates will take you. Seek them out and enter. But be prepared for many obstacles. You must grow stronger to reach the Core.&quot;">
				<Actions>
					<Action name="&quot;Who is Domina?&quot;" default="1" key="D">
						<ShowPane pane="A21"/>
					</Action>
					<Action name="&quot;What kind of obstacles will I face?&quot;" key="W">
						<ShowPane pane="A22"/>
					</Action>
					<Action name="Done" cancel="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A2>

			<A21 desc="&quot;Domina speaks to you from her throne at the Galactic Core. Only she knows the purpose of your journey. Perhaps if you reach her you will understand.&quot;">
				<Actions>
					<Action name="&quot;What kind of obstacles will I face?&quot;" default="1" key="W">
						<ShowPane pane="A211"/>
					</Action>
					<Action name="Done" cancel="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A21>

			<A211 desc="&quot;The civilized universe is smaller than you think. Pirates, outlaws and worse live in the deep dark of space. But if you can overcome them, you might be able to improve the weapons and armor of your own ship.&quot;">
				<Actions>
					<Action name="Done" cancel="1" default="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A211>

			<A22 desc="&quot;Pirates, outlaws and worse live out in the depths of space. They will kill you and take your ship, if you let them. The deeper you go, the more dangerous it becomes. But with luck and Domina&apos;s help you will be able to improve your ship.&quot;">
				<Actions>
					<Action name="&quot;Who is Domina?&quot;" default="1" key="D">
						<ShowPane pane="A221"/>
					</Action>
					<Action name="Done" cancel="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A22>

			<A221 desc="&quot;Domina speaks to you from her throne at the Galactic Core. Only she knows the purpose of your journey. Perhaps if you reach her you will understand.&quot;">
				<Actions>
					<Action name="Done" cancel="1" default="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A221>


			<A3 desc="&quot;Pirates and outlaws rule the depths of space. They will kill you and take your ship, if you let them. But if you can overcome them, perhaps you will find more powerful weapons to help you in your journey to Domina.&quot;">
				<Actions>
					<Action name="&quot;Who is Domina?&quot;" default="1" key="D">
						<ShowPane pane="A31"/>
					</Action>
					<Action name="&quot;How do I reach the Galactic Core?&quot;" key="G">
						<ShowPane pane="A32"/>
					</Action>
					<Action name="Done" cancel="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A3>

			<A31 desc="&quot;Domina speaks to you through dreams and visions. Only she knows what the purpose of your journey is. Perhaps if you reach the Core you will understand.&quot;">
				<Actions>
					<Action name="&quot;How do I reach the Galactic Core?&quot;" default="1" key="G">
						<ShowPane pane="A311"/>
					</Action>
					<Action name="Done" cancel="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A31>

			<A311 desc="&quot;The stargates will take you to the Core. Seek them out and enter. But remember that the farther you go, the greater the danger.&quot;">
				<Actions>
					<Action name="Done" cancel="1" default="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A311>

			<A32 desc="&quot;The stargates will take you to Domina. Seek them out and enter. But remember that the farther you go, the greater the danger.&quot;">
				<Actions>
					<Action name="&quot;Who is Domina?&quot;" default="1" key="D">
						<ShowPane pane="A321"/>
					</Action>
					<Action name="Done" cancel="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A32>

			<A321 desc="&quot;Domina is the divine intelligence that guides you. She waits for you at the Galactic Core for some purpose. Perhaps if you reach her you will understand.&quot;">
				<Actions>
					<Action name="Done" cancel="1" default="1" key="N">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</A321>


			<Done desc="&quot;Take your ease here before you go, or seek guidance at our Sanctum, if you wish. May the blessings of Domina protect you.&quot;">
				<Actions>
					<Action name="Continue" default="1" cancel="1" key="C">
						(scrExitScreen gScreen)
					</Action>
				</Actions>
			</Done>
		</Panes>
	</DockScreen>

	<!-- Contemplate Domina Screen
	
		NOTE: Deprecated in 1.3 (API 22)

		gPrevScreen: Must be set to the name/UNID of the screen to
				navigate to when done.
		gPrevPane: Must be set to the name of the pane to navigate
				to when done.
		gBonus: Increases/decreases chance of getting through to domina.
				-1 to -10	= decreases chance
				0			= no bonus
				1 to 10		= increases chance

		-->

	<DockScreen UNID="&dsContemplateDomina;"
			obsoleteVersion=			"37"
			>

		<Panes>

			<Default
					desc="Luminous veils dance in your head as your consciousness strains to hear the distant voice of Domina's mind...">

				<Actions>
					<Action name="Continue" default="1" cancel="1" key="C">
						(block (roll attitude contemplate)
							; consume
							(setq attitude (objGetData gPlayerShip "sistersAttitude"))
							(setq contemplate Nil)
							(if (gr attitude 0)
								(block Nil
									(setq attitude (subtract attitude 1))
									(objSetData gPlayerShip "sistersAttitude" attitude)
									(setq contemplate True)
									)
								)

							; Random result
							(setq roll (subtract (random 1 20) gBonus))
							(if (gr gBonus 0)
								(setq gBonus (subtract gBonus 1))
								)

							; If we listened to the story, we always get the stargate
							(if (objGetData gSource "freeSanctum")
								(block Nil
									(if (eq (sysGetLevel) 1)
										(block Nil
											(setq contemplate True)
											(setq roll 8)
											)
										)
									(objSetData gSource "freeSanctum" Nil)
									)
								)

							(switch
								(not contemplate)
									(scrShowPane gScreen "Nothing")

								; Gain in relationship
								(leq roll 2)
									(block Nil
										(domGainXP 10)
										(if (eq (random 1 3) 1)
											(domGainXP 10)
											)
										(scrShowPane gScreen "Domina")
										)

								; All stations in system mapped
								(leq roll 4)
									(block Nil
										(enum (sysFindObject gPlayerShip "Ts -uncharted;") obj
											(objSetKnown obj)
											)
										(scrShowPane gScreen "MapSystem")
										)

								; Outbound stargate revealed
								(leq roll 8)
									(block Nil
										(setq gDest (sysGetObjectByName gSource "Outbound"))
										(if (and gDest (not (objIsKnown gDest)))
											(block Nil
												(objSetKnown gDest)
												(scrShowPane gScreen "RevealStargate")
												)

											(scrShowPane gScreen "Nothing")
											)
										)

								(scrShowPane gScreen "Nothing")
								)
							)
					</Action>
				</Actions>

			</Default>

			<Domina
					desc="Your disembodied mind hurtles through space in the wake of a photon. Stars dance around you like fireflies. Nebulous veils part before you to reveal a fragment of the Eternal Pattern.\n\nYou feel the blessing of Domina upon you. She urges you to continue your journey to the Galactic Core.">

				<Actions>
					<Action name="Continue Contemplating" default="1" key="C">
						(if (gr (objGetData gPlayerShip "sistersAttitude") 0)
							(scrShowPane gScreen "Default")
							(scrShowPane gScreen "NoMoreContemplating")
							)
					</Action>

					<Action name="Leave" cancel="1" key="L">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>
				</Actions>
			</Domina>

			<MapSystem
					desc="Images and patterns dance in your head like spinning galaxies. You see with the eyes of Domina but the visions blast your brain like a nova.\n\nWhen you recover from your reverie you remember only some mundane information about the position of stations in this star system.">

				<Actions>
					<Action name="Continue Contemplating" default="1" key="C">
						(if (gr (objGetData gPlayerShip "sistersAttitude") 0)
							(scrShowPane gScreen "Default")
							(scrShowPane gScreen "NoMoreContemplating")
							)
					</Action>

					<Action name="Leave" cancel="1" key="L">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>
				</Actions>
			</MapSystem>

			<Nothing
					desc="Your contemplation ends as your rational mind considers the impossibility of communicating across the light-years.">

				<Actions>
					<Action name="Continue Contemplating" default="1" key="C">
						(if (gr (objGetData gPlayerShip "sistersAttitude") 0)
							(scrShowPane gScreen "Default")
							(scrShowPane gScreen "NoMoreContemplating")
							)
					</Action>

					<Action name="Leave" cancel="1" key="L">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>
				</Actions>
			</Nothing>

			<RevealStargate>

				<OnPaneInit>
					(scrSetDesc gScreen (cat "A connection with Domina is denied to you, but your brief attempt points the way to your destiny's end.\n\nStep through the " (objGetName gDest) " to the next system and you will be one step nearer to your goal."))
				</OnPaneInit>

				<Actions>
					<Action name="Continue Contemplating" default="1" key="C">
						(if (gr (objGetData gPlayerShip "sistersAttitude") 0)
							(scrShowPane gScreen "Default")
							(scrShowPane gScreen "NoMoreContemplating")
							)
					</Action>

					<Action name="Leave" cancel="1" key="L">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>
				</Actions>
			</RevealStargate>

			<NoMoreContemplating
					desc=	"&quot;You must not abuse the kindness of Domina. You must give of yourself to receive her blessing.&quot;">

				<Actions>
					<Action name="Leave" default="1" cancel="1" key="L">
						(scrShowScreen gScreen gPrevScreen gPrevPane)
					</Action>
				</Actions>
			</NoMoreContemplating>

		</Panes>

	</DockScreen>


	<!-- Korolov Shipping in Charon System

	NOTE: Deprecated in 1.8. See KSMissionC01.xml instead.

	EXTRA DATA:

	MissionStatus:		Status:
							Nil						= Attack has not begun
							'underAttack			= Station is under attack
							'destroyed				= Station has been destroyed by pirate attack
							'revenge				= Player has been asked to avenge the station (by destroying Charon Fortress)
							'success				= Attack on station defeated
							'attackPlan				= Player has been asked to destroy Charon Fortress
							'fortressDestroyed		= Charon Fortress destroyed
	-->

	<StationType UNID="&stKorolovAtCharon;"
			obsoleteVersion=			"37"
			name=				": Korolov Shipping"
			sovereign=			"&svCorporate;"
			dockScreen=			"Dispatch"
			abandonedScreen=	"Destroyed"
			dockingPorts=		"10"
			ignoreFriendlyFire=	"true"

			level=              "4"
			multiHull=			"true"
			armorID=			"&itPlasteelPlate;"
			maxHitPoints=		"630"
			hitPoints=			"250"
			regen=			    "6"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"corporate, corporateCustoms, corporateDecon, friendly, human, populated, majorStation, korolovCharon, korolovShipping"
			>

		<!-- Image and Effects -->
		
		<Image			imageID="&rsKorolovShipping;" imageWidth="292" imageHeight="364"/>

		<DockingPorts>
			<Port x="-18"	y="128" />
			<Port x="100"	y="127" />
			<Port x="156"	y="31" />
			<Port x="165"	y="-45" />
			<Port x="98"	y="-75" />
			<Port x="120"	y="-153" />

			<Port x="0"		y="-162" />
			<Port x="-90"	y="-165" />
			<Port x="-103"	y="-82" />
			<Port x="-178"	y="-46" />
			<Port x="-113"	y="43" />
			<Port x="-98"	y="122" />
		</DockingPorts>

		<Trade currency="credit">
			<Sell	criteria="*NU -illegal; -notForSale; -notStandard;"	priceAdj="100" noDescription="true"/>
			
			<Refuel			criteria="f +BasicFuel; L:1-5;" priceAdj="100"/>
			<RepairArmor	criteria="a L:1-8;" priceAdj="100"/>
			<ReplaceArmor	criteria="a L:1-8;" priceAdj="100"/>
			<InstallDevice	criteria="d L:1-6" priceAdj="100"/>
			<RemoveDevice	criteria="d L:1-6;" priceAdj="100"/>
		</Trade>
		
		<Items>
			<RandomItem count="1d4" criteria="r -illegal; -military; -notForSale; -notStandard; L:3-6;"		levelFrequency="systemLevel:ru|c|curv"/>
		</Items>

		<Ships>
			<Lookup count="1d2" table="&tbCommDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
			<Ship	count="3d6" class="&scRoninB;" orders="patrol" patrolDist="10"/>
		</Ships>

		<Events>
			<OnCreate>
				(block Nil
					; Create fleets of pirates to attack
					(for i 1 5
						(sysAddEncounterEventAtDist 500 gSource &etPirateAmbush3; (random 100 200))
						)

					; Under attack
					(sysAddObjTimerEvent 500 gSource "OnTimerAttack1")

					; Create drakes
					(sysAddObjTimerEvent 850 gSource "OnTimerAttack2")
					)
			</OnCreate>

			<OnDestroy>
				(block Nil
					(if (and 
							(eq (objGetData gSource "MissionStatus") "underAttack")
							(not (eq aOrderGiver gPlayerShip))
							)
						(block Nil
							(objSetData gSource "MissionStatus" "destroyed")
							(sysAddObjRecurringTimerEvent 150 gSource "OnCheckRevenge")
							)
						)
						
					(rpgDestroyItems gSource)
					)
			</OnDestroy>

			<OnObjDestroyed>
				(if (eq (objGetData gSource "MissionStatus") "underAttack")
					(block Nil
						(if (objGetData aObjDestroyed "Destroyer")
							(objIncData gSource "DestroyerCount" -1)
							)

						(if (leq (objGetData gSource "DestroyerCount") 0)
							(objSetData gSource "MissionStatus" "success")
							)
						)
					)
			</OnObjDestroyed>

			<OnTimerAttack1>
				(if (not (objIsAbandoned gSource))
					(block Nil
						(objSetData gSource "MissionStatus" "underAttack")
						)
					)
			</OnTimerAttack1>

			<OnTimerAttack2>
				(if (eq (objGetData gSource "MissionStatus") 'underAttack)
					(block (pos)
						(setq pos (sysVectorPolarOffset gSource (random 0 359) 120))

						; Create drake ships
						(for i 1 5
							(block (theShip)
								(setq theShip 
									(sysCreateShip 
											&scDrake; 
											(sysVectorPolarOffset pos (multiply i 30) 24)
											&svPirates;)
									)

								(shpOrderAttack theShip gSource)
								(shpOrderGate theShip)

								(objSetData theShip "Destroyer" True)
								(objRegisterForEvents gSource theShip)
								)
							)

						(objSetData gSource "DestroyerCount" 5)
						)
					)
			</OnTimerAttack2>

			<OnCheckRevenge>
				(block Nil
					(if (and (not (sysFindObject gSource "AT:charonFortress;"))
							(eq (count (sysFindObject gSource "AT:charonPirates;")) 0)
							)

						; Replace the destroyed korolov with new construction
						(block (newStation)
							(setq newStation (sysCreateStation &stKorolovAtCharonCons; (objGetPos gSource)))
							(objSetKnown newStation)
							(objDestroy gSource)
							(typSetGlobalData &stCharonPirateFortress; "status" 'allDestroyed)
							)
						)
					)
			</OnCheckRevenge>
		</Events>

		<DockScreens>
			<Dispatch
				name=			"Korolov Shipping"
				>

				<InitialPane>
					(block (missionStatus)
						(setq missionStatus (objGetData gSource "MissionStatus"))

						(switch
							(and (eq missionStatus 'success)
									(sysFindObject gSource "AT:charonPirates;"))
								"DestroyFortressMission"

							(and (eq missionStatus 'attackPlan)
									(not (sysFindObject gSource "AT:charonPirates;")))
								"DestroyFortressSuccess"

							"Default"
							)
						)
				</InitialPane>

				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDesc gScreen (typTranslate &stKorolovShipping; 'descWelcome))
						</OnPaneInit>

						<Actions>
							<Action name="Escort Freighter" default="1" key="E">
								(block (missionStatus)
									(setq missionStatus (objGetData gSource "MissionStatus"))
									(switch
										(eq missionStatus 'success)
											(scrShowPane gScreen "MissionOver")

										(eq missionStatus 'attackPlan)
											(scrShowPane gScreen "DestroyFortressInProgress")

										(eq missionStatus 'fortressDestroyed)
											(scrShowPane gScreen "MissionOver")

										(eq missionStatus 'underAttack)
											(scrShowPane gScreen "UnderAttack")

										(leq (typGetData &unidKorolovShipping; 'xp) 0)
											(scrShowPane gScreen "CantUseCommandCenter")

										(scrShowPane gScreen "Defend")
										)
									)
							</Action>

							<Action name="Dock Services" key="D">
								(block (xp)
									(setq xp (typGetData &unidKorolovShipping; 'xp))
									(if (leq xp 0)
										(scrShowPane gScreen "CantUseDockServices")
										
										(rpgDockServices gPlayerShip {
											checkMilitaryID: True
											})
										)
									)
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<CantUseCommandCenter
							desc=	"Sorry, only experienced pilots are allowed to escort freighters.">

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</CantUseCommandCenter>

					<CantUseDockServices
							desc=	"The dock services area is restricted to members only.">

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>

					</CantUseDockServices>

					<Defend
							desc=	"As you enter the command center, you see several people gathered around a central display table.&#x0a;&#x0a;A woman approaches you, &quot;We're planning a big attack on the Charon fortress in this system and we could use all the help we can get. Are you...&quot;">

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<ShowPane pane="Defend2"/>
							</Action>
						</Actions>

					</Defend>

					<Defend2
							desc=	"Before she can finish, the alarms bleat and she turns back to the display table.&#x0a;&#x0a;Her face goes white as she sees the mass of signals approaching the stations...">

						<Actions>
							<Action name="Leave" default="1" cancel="1" key="L">
								(block Nil
									(if (not (objGetData gSource "MissionStatus"))
										(objSetData gSource "MissionStatus" "underAttack")
										)
									(scrExitDock gScreen)
									)
							</Action>
						</Actions>

					</Defend2>

					<MissionOver
							desc=	"After a violent pirate attack, the command center is nearly ruined.&#x0a;&#x0a;&quot;Sorry, no freighters are looking for escorts right now.&quot;">

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>

					</MissionOver>

					<UnderAttack
							desc=	"The command center is filled with men and women shouting orders and counter-orders. The constant drone of sirens is punctuated frequently by concussive blow of explosions.&#x0a;&#x0a;A woman shouts at you, &quot;Get out of here and make yourself useful!&quot;">

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>

					</UnderAttack>

					<DestroyFortressMission>
						<OnPaneInit>
							(scrSetDesc gScreen (cat "The command center is smashed. Some people are caring for the injured while others look at the tactical screens. A woman approaches you:\n\n"
								"\"Thanks for your help! We were lucky that you were in the area. Now we need you to strike while we have the initiative. Destroy all the Charon stations in the system!\""
								))
						</OnPaneInit>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(block Nil
									(objSetData gSource "MissionStatus" 'attackPlan)
									(scrExitDock gScreen)
									)
							</Action>
						</Actions>
					</DestroyFortressMission>

					<DestroyFortressInProgress>
						<OnPaneInit>
							(block (pirateStationsLeft)
								(setq pirateStationsLeft (count (sysFindObject gSource "AT:charonPirates; -charonFortress;")))
								(setq fortress (sysFindObject gSource "AT:charonFortress;"))

								(scrSetDesc gScreen (cat
									"The command center is nearly ruined, but several people are tracking the tactical situation:\n\n"
									(switch
										(and (not fortress) (eq pirateStationsLeft 1))
											"\"There is still one Charon station left in the system. Destroy it and you'll be done!\""

										(not fortress)
											(cat "\"Although the Charon Fortress has been destroyed there are still " (strNumber pirateStationsLeft) " Charon stations in the system.\"")

										(eq pirateStationsLeft 1)
											"\"There are two Charon stations still active in the system: the Fortress of the Charon Pirates and another lesser Charon station.\""

										(cat "\"There are " (strNumber pirateStationsLeft) " Charon pirate stations left, in addition to the Fortress of the Charon Pirates.\"")
										)
									))
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</DestroyFortressInProgress>

					<DestroyFortressSuccess>
						<OnPaneInit>
							(block (roll)
								(setq roll (random 1 100))
								(switch
									(leq roll 30)
										(setq gItem (itmCreate &itXRayLaserCannon; 1))

									(leq roll 60)
										(setq gItem (itmCreate &itOmniParticleCannon; 1))

									(leq roll 80)
										(setq gItem (itmCreate &itMarkIHowitzer; 1))

									(setq gItem (itmCreate &itClass5Deflector; 1))
									)

								(scrSetDesc gScreen (cat "Everyone cheers as you enter.\n\n"
									"\"We don't have much in the way of rewards, but it would be our honor if you would accept "
									(itmGetName gItem 0x040)
									". The Charon pirates will no longer threaten the Commonwealth, and we owe it all to you!\""
									))
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(block Nil
									(objAddItem gPlayerShip gItem)
									(objSetData gSource "MissionStatus" 'fortressDestroyed)
									(scrShowPane gScreen "Default")
									)
							</Action>
						</Actions>
					</DestroyFortressSuccess>
				</Panes>

			</Dispatch>

			<Destroyed
				name=			"Korolov Shipping"
				>

				<OnScreenInit>
					(if (not (eq (objGetData gSource "MissionStatus") "destroyed"))
						(scrShowScreen gScreen "&dsRPGAbandonedStation;")
						)
				</OnScreenInit>

				<Panes>
					<Default
							desc=	"You are docked at the lifeless ruins of a destroyed station. Amid wrecked machinery and smouldering bodies you find a woman who is still alive.&#x0a;&#x0a;She grabs your hand, &quot;Avenge us...the Fortress is in the system...kill them all...&quot;">

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								(block Nil
									(setq gItem (itmCreate &itCharonPirateMapROM; 1))
									(objAddItem gPlayerShip gItem)

									(objSetData gSource "MissionStatus" "revenge")
									(scrShowPane gScreen "Map")
									)
							</Action>
						</Actions>
					</Default>

					<Map>
						<OnPaneInit>
							(scrSetDesc gScreen
								(cat "As her lifeless hand releases yours, she drops " (itmGetName gItem 0x08) ".\n\nYou take the ROM with you, hoping that it will contain some useful information.")
								)
						</OnPaneInit>

						<Actions>
							<Action name="Undock" default="1" cancel="1" key="U">
								<Exit/>
							</Action>
						</Actions>
					</Map>
				</Panes>
			</Destroyed>

		</DockScreens>

		<Language>
			<Text id="core.mapDescMain">
				"Hires freighter escorts"
			</Text>
		</Language>
	</StationType>


	<!-- Dantalion Settlement (DEPRECATED)

	NOTE: Deprecated in 1.8, use standard Commonwealth Settlement instead

	EXTRA DATA

	informant:		Status of informant
						Nil = never encountered
						"offered" = informant has offered to reveal location of Antarctica
						"paid" = informant has been paid

	-->

	<StationType UNID="&stDantalionSettlement;"
			obsoleteVersion=			"38"
			name=				"Commonwealth settlement"
			sovereign=			"&svCommonwealth;"
			inherit=			"&baCommonwealthStation;"
				 
			attributes=			"commonwealth, commonwealthCustoms, fleetDelivery, friendly, human, majorStation, populated"
				 
			dockScreen=			"Main"
			abandonedScreen=	"&dsRPGAbandonedStation;"
				 
			size=				"390"
			armorID=			"&itP120HexphaseArmor;"
			hitPoints=			"740"
			multiHull=			"true"
			regen=			    "15"
			shipRegen=			"6"
				 
			explosionType=		"&vtThermoExplosion2;"
			ejectaType=			"&vtWreckEjecta;"
			fireRateAdj=		"80"

			enemyExclusionRadius="40"
			>

		<Names noArticle="true">Commonwealth Settlement %1%0%0%0</Names>

		<!-- Trade and Items -->
		
		<Trade currency="credit">
			<Sell	criteria="m +commonwealth; -premiumAmmo; -illegal; -notForSale; -notStandard;" priceAdj="100" inventoryAdj="200" levelFrequency="systemLevel:ruc|c|cur"/>
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="100"/>
			<Buy	criteria="amdNU -Illegal; -NotForSale;"	priceAdj="50"/>
			<Buy	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="90"/>
			<Buy	criteria="*NU -Illegal; -ID;"				priceAdj="10"/>
			
			<Refuel			criteria="f +BasicFuel; L:1-7;" priceAdj="100"/>
			<RepairArmor	criteria="a L:1-8;" priceAdj="100"/>
			<ReplaceArmor	criteria="a L:1-8;" priceAdj="100"/>
		</Trade>

		<Items>
			<RandomItem count="10" 
					criteria=		"ad L:1-8; -Illegal; -Military; -Alien; -Specialty; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:u|c|crv"
					/>
			<RandomItem count="10" 
					criteria=		"*~ad -Illegal; -Military; -Alien; -Specialty; -NotStandard; -NotForSale;"
					levelFrequency=	"systemLevel:ru|c|cur"
					/>

			<Item count="4d12"	item="&itPteracniumFuelRod;" />
		</Items>

		<!-- Configuration -->
		
		<Devices>
			<Device deviceID="&itTeV9Blaster;"	omnidirectional="true"/>
		</Devices>

		<!-- Satellites -->
		
		<Satellites overlapCheck="asteroids">
			<Orbitals distance="12" angle="45">
				<Station type="&stCommonwealthTurret;" imageVariant="2"/>
			</Orbitals>

			<Orbitals distance="12" angle="135">
				<Station type="&stCommonwealthTurret;" imageVariant="1"/>
			</Orbitals>

			<Orbitals distance="12" angle="225">
				<Station type="&stCommonwealthTurret;" imageVariant="0"/>
			</Orbitals>

			<Orbitals distance="12" angle="315">
				<Station type="&stCommonwealthTurret;" imageVariant="3"/>
			</Orbitals>
		</Satellites>

		<!-- Ships and Defenses -->
		
		<Ships>
			<Lookup count="2" table="&tbCommDefenders;"/>
			<Lookup count="1d4" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<Reinforcements minShips="5">
			<Table>
				<Lookup chance="75" table="&tbCommDefenders;"/>
				<Lookup chance="25" table="&tbCommPrivateCrafts;"/>
			</Table>
		</Reinforcements>

		<!-- Image and Effects -->
		
		<Image imageID="&rsCommonwealthSettlement;" imageWidth="320" imageHeight="290" viewportRatio="0.05"/>

		<DockingPorts
				portCount=		"10"
				portRadius=		"175"
				>
		</DockingPorts>
		
		<!-- Dock Screens -->
		
		<DockScreens>
			<Main>
				<Panes>
					<Default
							desc=	"You are in the docking bay of a Commonwealth settlement. Except for a few shuttles, the docking bay of this station is deserted. A loose hose is spilling dirty water onto the landing pad; elsewhere, an automatic load-lifter moves forward and back again as it unloads a ship's cargo hold. The air smells of liquid fuel and exhaust.">

						<Actions>
							<Action name="Meeting Hall" key="M" default="1">
								<ShowPane pane="MeetingHall"/>
							</Action>

							<Action name="Commodities Exchange" key="C">
								(scrShowScreen gScreen &dsRPGCommoditiesExchange;)
							</Action>

							<Action name="Dock Services" key="D">
								(rpgDockServices gPlayerShip {
									checkMilitaryID: True
									})
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<MeetingHall>
						<OnPaneInit>
							(block (desc)
								(switch
									; Antarctica not yet encountered
									(not (typGetGlobalData &scCSCTerra; "antarctica"))
										(setq desc (cat "The Meeting Hall is filled with worried-looking residents. Many are talking amongst themselves in low voices. The station master is addressing the group from the front of the hall:\n\n"
												"\"Once again, I urge everyone to remain calm! We have no reason to believe that the Antarctica will approach this settlement. The Fleet has been informed of the sighting, but we do not know when or if they will arrive.\""
												)
											)

									; Antarctica escaped
									(eq (typGetGlobalData &scCSCTerra; "antarctica") "escaped")
										(setq desc (cat "The Meeting Hall is filled with people. Most look happy and are talking amongst themselves. The station master addresses the crowd:\n\n"
												"\"Our latest information is that the Antarctica has left the system. We believe that it is heading for St. Katharine's, where the Fleet will no doubt deal with her.\""
												)
											)

									; Antarctica destroyed
									(setq desc (cat "The Meeting Hall is filled with people. Most look happy and are talking amongst themselves. The station master addresses the crowd:\n\n"
											"\"Our latest information is that the Antarctica was destroyed. We don't have any more information at this point, but we believe that the danger is over.\""
											)
										)
									)

								(scrSetDesc gScreen desc)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								(switch
									(and (not (typGetGlobalData &scCSCTerra; "antarctica"))
											(not (typGetGlobalData &scCSCAntarctica; "status"))
											(not (eq (objGetData gSource "informant") 'paid))
											)
										(scrShowPane gScreen "Informant")

									(scrShowPane gScreen "Default")
									)
							</Action>
						</Actions>
					</MeetingHall>

					<Informant>
						<OnPaneInit>
							(switch
								(not (objGetData gSource "informant"))
									(scrSetDesc gScreen "A woman wearing a ragged Fleet jacket with torn patches stops you as you leave.\n\n\"I know where the Antarctica is. It will cost you 10,000 rin if you want to know too.\"")

								(scrSetDesc gScreen "The woman wearing the ragged Fleet jacket stops you again.\n\n\"I know you're still looking for the Antarctica. For 10,000 rin I will tell you her location.\"")
								)
						</OnPaneInit>

						<Actions>
							<Action name="&quot;OK, you have a deal.&quot;" key="O">
								(block Nil
									(objSetData gSource "informant" 'offered)
									(switch
										(ls (objGetBalance gPlayerShip 'rin) 10000)
											(scrShowPane gScreen "NotEnoughRin")

										(scrShowPane gScreen "Informant2")
										)
									)
							</Action>

							<Action name="&quot;No thanks, I'll find her myself.&quot;" key="N" cancel="1">
								(block Nil
									(objSetData gSource "informant" 'offered)
									(scrShowPane gScreen "Default")
									)
							</Action>
						</Actions>
					</Informant>

					<Informant2>
						<OnPaneInit>
							(scrSetDesc gScreen "You transfer 10,000 rin to the woman's account. When she is satisfied, she takes your arm and whispers the coordinates in your ear. You memorize them and enter them into your computer.")
						</OnPaneInit>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(block (theAntarctica)
									(objSetData gSource "informant" 'paid)
									(objCharge gPlayerShip 'rin 10000)

									(enum (sysFindObject gSource "s D:CSC;") theObj
										(if (eq (objGetData theObj "CSC") 'antarctica)
											(setq theAntarctica theObj)
											)
										)

									(if theAntarctica
										(block Nil
											(shpCancelOrders gPlayerShip)
											(shpOrder gPlayerShip 'attack theAntarctica)
											(objSetIdentified theAntarctica)
											)
										)

									(scrShowPane gScreen "Default")
									)
							</Action>
						</Actions>
					</Informant2>

					<NotEnoughRin>
						<OnPaneInit>
							(scrSetDesc gScreen 
								(cat "Unfortunately, you "
									(switch
										(eq (objGetBalance gPlayerShip 'rin) 0)
											"do not have any rin."
										(eq (objGetBalance gPlayerShip 'rin) 1)
											"only have a single rin."
										(cat "only have " (objGetBalance gPlayerShip 'rin) " rin.")
										)
									"\n\nThe woman smiles at you and says, \"Come back when you have something to deal with.\""
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" key="C" default="1" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>
					</NotEnoughRin>
				</Panes>
			</Main>

		</DockScreens>

		<!-- Events and Data -->
		
		<StaticData>
			<NPCService>
				(	;	service					level	margin
					(	'repairArmor			8		100		)
					)
			</NPCService>
		</StaticData>
	</StationType>

	<!-- CSC America Encounter (DEPRECATED) -->

	<EncounterType UNID="&stCSCAmericaEncounter;"
			obsoleteVersion=			"37"
			name=				"(CSC America)"
			sovereign=			"&svCommonwealthFleet;"

			attributes=			"fleet,friendly,envAir,envEarth,envFire,envWater"
			>

		<Ships>
			<Ship	count="1"	class="&scCSCTaskForce;" orders="hold">

				<Names definiteArticle="true">CSC America</Names>

				<InitialData>
					<CSC>"america"</CSC>
				</InitialData>

				<Escorts>
					<Ship					count="1"	class="&scCenturion;"	orders="guard" controller="fleetcommand">
						<Escorts>
							<Ship     count="6"	class="&scCenturion;"	orders="escort" controller="fleet"/>
						</Escorts>
					</Ship>
					<Ship					count="1"	class="&scCenturion;"	orders="guard" controller="fleetcommand">
						<Escorts>
							<Ship     count="6"	class="&scCenturion;"	orders="escort" controller="fleet"/>
						</Escorts>
					</Ship>
				</Escorts>
			</Ship>
		</Ships>

	</EncounterType>

	<!-- CSC Atlantica Encounter (DEPRECATED) -->

	<EncounterType UNID="&stCSCAtlanticaEncounter;"
			obsoleteVersion=			"37"
			name=				"(CSC Atlantica)"
			sovereign=			"&svCommonwealthFleet;"

			attributes=			"fleet,friendly,envAir,envEarth,envFire,envWater"
			>

		<Ships>
			<Ship	count="1"	class="&scCSCTaskForce;" orders="hold">

				<Names definiteArticle="true">CSC Atlantica</Names>

				<InitialData>
					<CSC>"atlantica"</CSC>
				</InitialData>

				<Escorts>
					<Ship     count="2d6"	class="&scCenturion;"	orders="patrol" patrolDist="15"/>
				</Escorts>
			</Ship>
		</Ships>

	</EncounterType>

	<!-- CSC Asia Encounter (DEPRECATED) -->

	<EncounterType UNID="&stCSCAsiaEncounter;"
			obsoleteVersion=			"37"
			name=				"(CSC Asia)"
			sovereign=			"&svCommonwealthFleet;"

			attributes=			"fleet,friendly,envAir,envEarth,envFire,envWater"
			>

		<Ships>
			<Ship	count="1"	class="&scCSCTaskForce;" orders="hold">

				<Names definiteArticle="true">CSC Asia</Names>

				<InitialData>
					<CSC>"asia"</CSC>
				</InitialData>

				<Escorts>
					<Ship     count="2d6"	class="&scCenturion;"	orders="patrol" patrolDist="15"/>
				</Escorts>
			</Ship>
		</Ships>

	</EncounterType>

	<!-- CSC India Encounter (DEPRECATED) -->

	<EncounterType UNID="&stCSCIndiaEncounter;"
			obsoleteVersion=			"37"
			name=				"(CSC India)"
			sovereign=			"&svCommonwealthFleet;"

			attributes=			"fleet,friendly,envAir,envEarth,envFire,envWater"
			>

		<Ships>
			<Ship	count="1"	class="&scCSCTaskForce;" orders="hold">

				<Names definiteArticle="true">CSC India</Names>

				<InitialData>
					<CSC>"india"</CSC>
				</InitialData>

				<Escorts>
					<Ship     count="2d6"	class="&scCenturion;"	orders="patrol" patrolDist="15"/>
				</Escorts>
			</Ship>
		</Ships>

	</EncounterType>

	<!-- CSC Pacifica Encounter (DEPRECATED) -->

	<EncounterType UNID="&stCSCPacificaEncounter;"
			obsoleteVersion=			"37"
			name=				"(CSC Pacifica)"
			sovereign=			"&svCommonwealthFleet;"

			attributes=			"fleet,friendly,envAir,envEarth,envFire,envWater"
			>

		<Ships>
			<Ship	count="1"	class="&scCSCTaskForce;" orders="hold">

				<Names definiteArticle="true">CSC Pacifica</Names>

				<InitialData>
					<CSC>"pacifica"</CSC>
				</InitialData>

				<Escorts>
					<Ship     count="2d6"	class="&scCenturion;"	orders="patrol" patrolDist="15"/>
				</Escorts>
			</Ship>
		</Ships>

	</EncounterType>

	<!-- CSC Antarctica Encounter (DEPRECATED) -->

	<EncounterType UNID="&stCSCAntarcticaEncounter;"
			obsoleteVersion=			"38"
			name=				"(CSC Antarctica)"
			sovereign=			"&svCSCAntarctica;"

			level=				"9"
			attributes=			"fleet,friendly,primary,envAir,envEarth,envFire,envWater"
			maxAppearing=		"1"
			>

		<Ships>
			<Ship	count="1"	class="&scCSCAntarctica;" orders="hold">
				<Names definiteArticle="true">CSC Antarctica</Names>
				
				<InitialData>
					<CSC>"antarctica"</CSC>
				</InitialData>
			</Ship>
		</Ships>
	</EncounterType>

	<!-- Svalbard Explorer Encounter (DEPRECATED) -->

	<EncounterType UNID="&stSvalbardEncounter;"
			obsoleteVersion=			"39"
			name=				"(Svalbard Explorer)"
			sovereign=			"&svCorporate;"

			level=				"10"
			attributes=			"friendly"
			maxAppearing=		"1"
			>

		<Ships>
			<Ship	count="1"	class="&scSvalbardExplorer;" orders="hold"/>
		</Ships>
	</EncounterType>

	<!-- Sister Maryam's Archive (moved to StarsOfThePilgrim in 1.8) -->

	<StationType unid="&stMaryamsArchiveObsolete;"
			obsoleteVersion="39">
	</StationType>

	<!-- Abandoned crate looting screen (DEPRECATED) -->
	
	<DockScreen UNID="&dsAbandonedCrateObsolete;"
			obsoleteVersion=			"1"
			inherit=			"&dsDockScreenBase;"
			>
		<Panes>
			<Default>
				<OnPaneInit>
					(block nil
						(scrSetDescTranslate gScreen 'descAbandonedCrate)
						(rpgSetLootAction gSource)
						)
				</OnPaneInit>
				
				<Actions>
					<Action id="actionLoot" default="1">
						(scrShowScreen gScreen &dsRPGLoot;)
					</Action>

					<Action id="actionJettison">
						(scrShowScreen gScreen &dsRPGJettison;)
					</Action>

					<Action id="actionUndock" cancel="1" default="1">
						<Exit/>
					</Action>
				</Actions>
			</Default>
		</Panes>
		
		<Language>
			<Text id="descAbandonedCrate">"You are docked with an abandoned cargo crate."</Text>
		</Language>
	</DockScreen>
	
	<!-- Abandoned ship looting screen (DEPRECATED) -->
	
	<DockScreen UNID="&dsAbandonedShipObsolete;"
			obsoleteVersion=			"37"
			inherit=			"&dsDockScreenBase;"
			>
		<Panes>
			<Default>
				<OnPaneInit>
					(block nil
						(scrSetDescTranslate gScreen 'descAbandonedShip)
						(rpgSetLootAction gSource)
						)
				</OnPaneInit>

				<Actions>
					<Action id="actionLoot" default="1">
						(scrShowScreen gScreen &dsRPGLoot;)
					</Action>

					<Action id="actionJettison">
						(scrShowScreen gScreen &dsRPGJettison;)
					</Action>

					<Action id="actionUndock" cancel="1" default="1">
						<Exit/>
					</Action>
				</Actions>
			</Default>
		</Panes>
		
		<Language>
			<Text id="descAbandonedShip">"You are docked with the wreck of a ship."</Text>
		</Language>
	</DockScreen>
	
	<!-- Abandoned station looting screen (DEPRECATED) -->

	<DockScreen UNID="&dsAbandonedStationObsolete;"
			obsoleteVersion=			"1"
			>
		<Panes>
			<Default>
				<OnPaneInit>
					(block (desc extensionVersion)
						; Get the abandoned screen description from the object.
						(setq desc (objTranslate gSource 'AbandonedScreenDesc))
						
						; If the object doesn't have a description then come up with a good
						; default
						(if (not desc)
							(setq desc (switch
								; If not populated, then just a destroyed installation
								(not (objHasAttribute gSource "populated"))
									(cat "You are docked at a destroyed structure. "
											"Leaking fluids and venting gases obscure the ruined machinery inside.")
										
								; Standard default
								(cat "You are docked at the lifeless ruins of a destroyed station. "
										"Wrecked machinery and smoldering bodies litter the silent, cavernous bay.")
								))
							)
							
						; Set it
						(scrSetDesc gScreen desc);
						)
				</OnPaneInit>
				
				<Actions>
					<Action name="Loot" key="L" default="1" >
						(scrShowScreen gScreen &dsRPGLoot;)
					</Action>

					<Action name="Jettison" key="J">
						(scrShowScreen gScreen &dsRPGJettison;)
					</Action>

					<Action name="Undock" cancel="1" key="U">
						<Exit/>
					</Action>
				</Actions>
			</Default>
		</Panes>
	</DockScreen>

	<StationType unid="&baBattleArenaSegmentObsolete;"
			obsoleteVersion="1">
	</StationType>
	
	<StationType unid="&baBlackMarketStationObsolete;"
			obsoleteVersion="1">
	</StationType>

	<StationType unid="&baCommonwealthStationObsolete;"
			obsoleteVersion="1"
			>
	</StationType>

	<ShipClass UNID="&baCSCBaseObsolete;"
			obsoleteVersion="1">
	</ShipClass>

	<StationType unid="&baCorporateStationObsolete;"
			obsoleteVersion="1"
			>
	</StationType>

	<ShipClass UNID="&baZoanthropeBaseObsolete;"
			obsoleteVersion="1"
			>
	</ShipClass>
	
	<ShipClass UNID="&baCharonBusterObsolete;"
			obsoleteVersion="1"
			>
	</ShipClass>

	<StationType unid="&baOutlawMineObsolete;"
			obsoleteVersion="1"
			>
	</StationType>
	
	<StationType unid="&baRingersStationObsolete;"
			obsoleteVersion="1"
			>
	</StationType>

	<StationType UNID="&baStKatsArcologyBaseObsolete;"
			obsoleteVersion="1"
			>
	</StationType>
	
	<StationType UNID="&baTeratonNestBaseObsolete;"
			obsoleteVersion="1"
			>
	</StationType>
	
	<!-- Rowena's Weapons and Armor: Vol 1 -->

	<ItemType UNID="&itRowenaVol1;"
			obsoleteVersion=			"1"
			name=				"[ROM(s) of ]Rowena's Weapons and Armor: Volume I"
			level=				"1"
			value=				"50"
			mass=				"1"
			frequency=			"notrandom"
			unknownType=		"&itUnknownROM;"
			attributes=			"cannotOrder, Info; MinorItem"

			description=		"The definitive guide to starship weapons and armor. This ROM contains specification for commercially available weapons and armor of the Commonwealth."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objSendMessage gSource Nil "\"Rowena's Weapons and Armor (Volume I)\" installed")
				(itmEnumTypes "adsw" itemType
					(if (and (geq (itmGetLevel itemType) 1) (leq (itmGetLevel itemType) 5))
						(itmSetReference itemType)
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Rowena's Weapons and Armor: Vol 2 -->

	<ItemType UNID="&itRowenaVol2;"
			obsoleteVersion=			"1"
			name=				"[ROM(s) of ]Rowena's Weapons and Armor: Volume II"
			level=				"4"
			value=				"500"
			mass=				"1"
			frequency=			"notrandom"
			unknownType=		"&itUnknownROM;"
			attributes=			"cannotOrder, Info; MinorItem"

			description=		"The definitive guide to starship weapons and armor. This ROM contains specification for military weapons and armor used in the Commonwealth."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objSendMessage gSource Nil "\"Rowena's Weapons and Armor (Volume II)\" installed")
				(itmEnumTypes "adsw" itemType
					(if (and (geq (itmGetLevel itemType) 6) (leq (itmGetLevel itemType) 10))
						(itmSetReference itemType)
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Rowena's Weapons and Armor: Vol 3 -->

	<ItemType UNID="&itRowenaVol3;"
			obsoleteVersion=			"1"
			name=				"[ROM(s) of ]Rowena's Weapons and Armor: Volume III"
			level=				"8"
			value=				"2500"
			mass=				"1"
			frequency=			"notrandom"
			unknownType=		"&itUnknownROM;"
			attributes=			"cannotOrder, Info; MinorItem"

			description=		"The definitive guide to starship weapons and armor. This ROM contains specification for weapons and armor used by the Ancient Races."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objSendMessage gSource Nil "\"Rowena's Weapons and Armor (Volume III)\" installed")
				(itmEnumTypes "adsw" itemType
					(if (and (geq (itmGetLevel itemType) 11) (leq (itmGetLevel itemType) 15))
						(itmSetReference itemType)
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Rowena's Weapons and Armor: Vol 4 -->

	<ItemType UNID="&itRowenaVol4;"
			obsoleteVersion=			"1"
			name=				"[ROM(s) of ]Rowena's Weapons and Armor: Volume IV"
			level=				"12"
			value=				"10000"
			mass=				"1"
			frequency=			"notrandom"
			unknownType=		"&itUnknownROM;"
			attributes=			"cannotOrder, Info; MinorItem"

			description=		"The definitive guide to starship weapons and armor. This ROM contains specification for weapons and armor developed by the Halo Races."

			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objSendMessage gSource Nil "\"Rowena's Weapons and Armor (Volume IV)\" installed")
				(itmEnumTypes "adsw" itemType
					(if (and (geq (itmGetLevel itemType) 16) (leq (itmGetLevel itemType) 20))
						(itmSetReference itemType)
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Rowena's Weapons and Armor: Vol 5 -->

	<ItemType UNID="&itRowenaVol5;"
			obsoleteVersion=			"1"
			name=				"[ROM(s) of ]Rowena's Weapons and Armor: Volume V"
			level=				"16"
			value=				"30000"
			mass=				"1"
			frequency=			"notrandom"
			unknownType=		"&itUnknownROM;"
			attributes=			"cannotOrder, Info; MinorItem"

			description=		"The definitive guide to starship weapons and armor. This ROM contains specification for weapons and armor used by the Hierodules and the entities Oracus and Domina."

			>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Invoke>
			(block Nil
				(objSendMessage gSource Nil "\"Rowena's Weapons and Armor (Volume V)\" installed")
				(itmEnumTypes "adsw" itemType
					(if (and (geq (itmGetLevel itemType) 21) (leq (itmGetLevel itemType) 25))
						(itmSetReference itemType)
						)
					)

				; Identify the item
				(itmSetKnown gItem)

				; Remove ROM
				(objRemoveItem gSource gItem 1)
				)
		</Invoke>
	</ItemType>

	<!-- Autopilot ROM -->

	<ItemType UNID="&itAutopilotROM;"
			obsoleteVersion=	"49"
			name=				"autopilot ROM"
			attributes=			"info, minorItem, shipEquipment"
			inherit=			"&baStdEquipmentItem;"

			level=				"1"
			frequency=			"uncommon"

			value=				"50"
			mass=				"1"
			unknownType=		"&itUnknownROM;, &itUnknownROMB;, &itUnknownROMC;"

			description=		"This program allows the ship's captain to rest while the ship maintains a steady course."
			>

		<Properties>
			<Constant id="rpg.equipment">'autopilot</Constant>
		</Properties>

		<Image imageID="&rsItems1;" imageX="192" imageY="96" imageWidth="96" imageHeight="96"/>

		<Language>
			<Text id="rpg.equipmentInstalled">Autopilot installed</Text>
			<Text id="rpg.equipmentNoEffect">Ship already has an autopilot</Text>
			<Text id="rpg.equipmentRedundant">Installed redundant autopilot</Text>
			<Text id="rpg.equipmentRepaired">Autopilot repaired</Text>
		</Language>
	</ItemType>

	<!-- Centauri Commandship (Obsolete) -->

	<ShipClass UNID="&scCentauriCommandShip;"
			obsoleteVersion=			"39"
			manufacturer=		"Centauri"
			class=				""
			type=				"command ship"

			mass=				"100"
			cargoSpace=			"50"
			thrust=				"400"
			maxSpeed=			"10"

			attributes=			"centauriWarlords"
			>

		<Armor>
			<ArmorSection start="315" span="90" armorID="&itLightPlasteelPlate;" areaSet="0,2" />
			<ArmorSection start="225" span="90" armorID="&itLightPlasteelPlate;" areaSet="3,4" />
			<ArmorSection start="135" span="90" armorID="&itLightPlasteelPlate;" areaSet="1,6" />
			<ArmorSection start="45"  span="90" armorID="&itLightPlasteelPlate;" areaSet="7,13" />
		</Armor>

		<Devices>
			<Device deviceID="&itPartisanCannon;" secondaryWeapon="true" omnidirectional="true"/>
		</Devices>

		<Maneuver
			maxRotationRate=	"4.5"
			rotationAccel=		"1.0"
			/>

		<Image imageID="&rsMediumShips2;" imageX="384" imageY="0" imageWidth="64" imageHeight="64"/>

		<AISettings
			fireRateAdj=		"30"
			fireAccuracy=		"70"
			perception=			"4"
			/>

	</ShipClass>

	<!-- EI500-class Freighter Base Class -->

	<ShipClass UNID="&scPlayerEI500Base;"
			obsoleteVersion=			"40"
			class=				"(player EI500 base class)"
			virtual=			"true" 
			
			attributes=			"baseClass" 
			>

		<PlayerSettings
			desc=				"The EI500 is slow and ungraceful, but its omnidirectional laser can hit even the fastest gunships. Six open slots for devices give you lots of upgrade flexibility."
			largeImage=			"&rsEI100XLarge;"
			initialClass=		"true"
			startingCredits=	"5d20+200"
			>

			<ArmorDisplay>
				<ShipImage imageID="&rsArmorHUDShip_EI500;" imageWidth="136" imageHeight="136"/>
				
				<ArmorSection name="forward"
						segment="0"
						imageID="&rsEI100XArmor;" 
						imageX="0" imageY="0" imageWidth="90" imageHeight="9"
						destX="23" destY="32" hpX="55" hpY="27"
						nameY="8" nameBreakWidth="360" nameDestX="12" nameDestY="0" />

				<ArmorSection name="starboard"
						segment="3"
						imageID="&rsEI100XArmor;" 
						imageX="90" imageY="0" imageWidth="9" imageHeight="56"
						destX="104" destY="41" hpX="98" hpY="60"
						nameY="30" nameBreakWidth="275" nameDestX="0" nameDestY="8" />

				<ArmorSection name="port"
						segment="1"
						imageID="&rsEI100XArmor;" 
						imageX="189" imageY="0" imageWidth="9" imageHeight="56"
						destX="23" destY="41" hpX="12" hpY="60"
						nameY="52" nameBreakWidth="200" nameDestX="0" nameDestY="8" />

				<ArmorSection name="aft"
						segment="2"
						imageID="&rsEI100XArmor;" 
						imageX="99" imageY="0" imageWidth="90" imageHeight="9"
						destX="23" destY="97" hpX="55" hpY="97"
						nameY="74" nameBreakWidth="200" nameDestX="0" nameDestY="8" />
			</ArmorDisplay>

			<ShieldDisplay shieldLevelEffect="&efShieldHUDDefault;">
			</ShieldDisplay>

			<ReactorDisplay>
				<Image imageID="&rsZubrinReactor;" 
						imageX="0" imageY="0" imageWidth="256" imageHeight="60"/>

				<PowerLevelImage imageID="&rsZubrinReactor;"
						imageX="0" imageY="60" imageWidth="202" imageHeight="14"
						destX="54" destY="9"/>

				<FuelLevelImage imageID="&rsZubrinReactor;"
						imageX="0" imageY="74" imageWidth="194" imageHeight="14"
						destX="54" destY="37"/>

				<FuelLowLevelImage imageID="&rsZubrinReactor;"
						imageX="0" imageY="88" imageWidth="194" imageHeight="14"/>

				<ReactorText x="62" y="22" width="154" height="14"/>
				<PowerLevelText x="62" y="0" width="154" height="9"/>
				<FuelLevelText x="62" y="51" width="154" height="9"/>
			</ReactorDisplay>

		</PlayerSettings>

	</ShipClass>

	<!-- Sapphire-class Yacht Base Class -->

	<ShipClass UNID="&scPlayerSapphireBase;"
			obsoleteVersion=			"40"
			class=				"(player Sapphire base class)"
			virtual=			"true" 
			
			attributes=			"baseClass" 
			>

		<PlayerSettings
			desc=				"The versatile Sapphire yacht strikes a good balance between a gunship and a freighter."
			largeImage=			"&rsZubrinLarge;"
			initialClass=		"true"
			startingCredits=	"10d100+1500"
			>

			<ArmorDisplay>
				<ShipImage imageID="&rsArmorHUDShip_Sapphire;" imageWidth="136" imageHeight="136"/>
				
				<ArmorSection name="forward"
						segment="0"
						imageID="&rsZubrinArmor;" 
						imageX="0" imageY="0" imageWidth="52" imageHeight="29"
						destX="42" destY="15" hpX="55" hpY="14"
						nameY="8" nameBreakWidth="200" nameDestX="0" nameDestY="10" />

				<ArmorSection name="starboard"
						segment="3"
						imageID="&rsZubrinArmor;" 
						imageX="52" imageY="0" imageWidth="22" imageHeight="59"
						destX="92" destY="45" hpX="95" hpY="60"
						nameY="30" nameBreakWidth="360" nameDestX="12" nameDestY="0" />

				<ArmorSection name="port"
						segment="1"
						imageID="&rsZubrinArmor;" 
						imageX="142" imageY="0" imageWidth="22" imageHeight="59"
						destX="22" destY="45" hpX="15" hpY="60"
						nameY="52" nameBreakWidth="200" nameDestX="0" nameDestY="8" />

				<ArmorSection name="aft"
						segment="2"
						imageID="&rsZubrinArmor;" 
						imageX="74" imageY="0" imageWidth="68" imageHeight="14"
						destX="34" destY="103" hpX="55" hpY="105"
						nameY="74" nameBreakWidth="360" nameDestX="12" nameDestY="0" />
			</ArmorDisplay>

			<ShieldDisplay shieldLevelEffect="&efShieldHUDDefault;">
			</ShieldDisplay>

			<ReactorDisplay>
				<Image imageID="&rsZubrinReactor;" 
						imageX="0" imageY="0" imageWidth="256" imageHeight="60"/>

				<PowerLevelImage imageID="&rsZubrinReactor;"
						imageX="0" imageY="60" imageWidth="202" imageHeight="14"
						destX="54" destY="9"/>

				<FuelLevelImage imageID="&rsZubrinReactor;"
						imageX="0" imageY="74" imageWidth="194" imageHeight="14"
						destX="54" destY="37"/>

				<FuelLowLevelImage imageID="&rsZubrinReactor;"
						imageX="0" imageY="88" imageWidth="194" imageHeight="14"/>

				<ReactorText x="62" y="22" width="154" height="14"/>
				<PowerLevelText x="62" y="0" width="154" height="9"/>
				<FuelLevelText x="62" y="51" width="154" height="9"/>
			</ReactorDisplay>
			
			<WeaponDisplay>
				<Image imageID="&rsZubrinTargeting;" imageX="0" imageY="0" imageWidth="360" imageHeight="120"/>
			</WeaponDisplay>
		</PlayerSettings>
		
	</ShipClass>

	<!-- Wolfen-class Gunship Base Class -->

	<ShipClass UNID="&scPlayerWolfenBase;"
			obsoleteVersion=			"40"
			class=				"(player Wolfen base class)"
			virtual=			"true" 
			
			attributes=			"baseClass" 
			>

		<PlayerSettings
			desc=				"Fast and deadly, the Wolfen is designed for combat. Though limited in cargo capacity, it has lots of room for more weapons."
			largeImage=			"&rsWolfenLarge;"
			initialClass=		"true"
			startingCredits=	"5d20+200"
			>

			<ArmorDisplay>
				<ShipImage imageID="&rsArmorHUDShip_Wolfen;" imageWidth="136" imageHeight="136"/>
				
				<ArmorSection name="forward"
						segment="0"
						imageID="&rsWolfenArmor;" 
						imageX="0" imageY="0" imageWidth="52" imageHeight="15"
						destX="42" destY="19" hpX="55" hpY="18"
						nameY="8" nameBreakWidth="200" nameDestX="0" nameDestY="10" />

				<ArmorSection name="starboard"
						segment="3"
						imageID="&rsWolfenArmor;" 
						imageX="75" imageY="0" imageWidth="23" imageHeight="69"
						destX="94" destY="34" hpX="97" hpY="60"
						nameY="30" nameBreakWidth="360" nameDestX="12" nameDestY="0" />

				<ArmorSection name="port"
						segment="1"
						imageID="&rsWolfenArmor;" 
						imageX="52" imageY="0" imageWidth="23" imageHeight="69"
						destX="19" destY="34" hpX="13" hpY="60"
						nameY="52" nameBreakWidth="200" nameDestX="0" nameDestY="8" />

				<ArmorSection name="aft"
						segment="2"
						imageID="&rsWolfenArmor;" 
						imageX="0" imageY="75" imageWidth="52" imageHeight="16"
						destX="42" destY="103" hpX="55" hpY="107"
						nameY="74" nameBreakWidth="360" nameDestX="12" nameDestY="0" />
			</ArmorDisplay>

			<ShieldDisplay shieldLevelEffect="&efShieldHUDDefault;">
			</ShieldDisplay>

			<ReactorDisplay>
				<Image imageID="&rsZubrinReactor;" 
						imageX="0" imageY="0" imageWidth="256" imageHeight="60"/>

				<PowerLevelImage imageID="&rsZubrinReactor;"
						imageX="0" imageY="60" imageWidth="202" imageHeight="14"
						destX="54" destY="9"/>

				<FuelLevelImage imageID="&rsZubrinReactor;"
						imageX="0" imageY="74" imageWidth="194" imageHeight="14"
						destX="54" destY="37"/>

				<FuelLowLevelImage imageID="&rsZubrinReactor;"
						imageX="0" imageY="88" imageWidth="194" imageHeight="14"/>

				<ReactorText x="62" y="22" width="154" height="14"/>
				<PowerLevelText x="62" y="0" width="154" height="9"/>
				<FuelLevelText x="62" y="51" width="154" height="9"/>
			</ReactorDisplay>

		</PlayerSettings>

	</ShipClass>

	<!-- Dry dock screen -->

	<DockScreen UNID="&dsDryDock;"
			obsoleteVersion=			"40"
			inherit=			"&dsDockScreenBase;"
			>
		
		<Panes>
			<Default descID="descWelcome">
				<Actions>
					<Action id="actionDockServices" default="1">
						(rpgDockServices gPlayerShip {
							checkMilitaryID: True
							})
					</Action>
					
					<Action id="actionUndock" cancel="1">
						<Exit/>
					</Action>
				</Actions>
			</Default>
		</Panes>
		
		<Language>
			<Text id="descWelcome">Your ship is in dry dock.</Text>
		</Language>
	</DockScreen>

	<!-- Black Market Station in Rigel Aurelius -->

	<StationType UNID="&stBlackMarketRigelAurelius;"
			obsoleteVersion=			"40"
			name=				"Black Market station"
			sovereign=			"&svBlackMarket;"
			inherit=			"&baBlackMarketStation;"
				 
			dockScreen=			"Main"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			dockingPorts=		"8"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"320"
			regen=			    "1.6"
			fireRateAdj=		"20"
			explosionType=		"&vtBlastExplosion2;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"blackMarket, friendly, human, katamiRescue, majorStation, outlaws, populated"
			>

		<Image			imageID="&rsStations3;" imageX="128" imageY="0" imageWidth="128" imageHeight="128"/>

		<Ships>
			<Ship	count="1"	class="&scMolotok;" orders="guard"/>

			<Table count="1d4">
				<Ship chance="25"  count="1" class="&scZulu-II;" orders="gateOnThreat"/>
				<Ship chance="15"  count="1" class="&scOromo;" orders="gateOnThreat"/>
				<Ship chance="15"  count="1" class="&scWolfen;" orders="gateOnThreat"/>
				<Ship chance="30" count="1" class="&scEI500;" orders="gateOnThreat"/>
				<Ship chance="15"  count="1" class="&scT31ArmedTransport;" orders="gateOnThreat">
					<Items>
						<Item					count="8d20" item="&itSmartCannonShell;"/>
						<Lookup	chance="50"		count="1d3-1" table="&trIllegalItems2;"/>
						<Table chance="50">
							<Lookup chance="40" count="1" table="&trConsumables2;"/>
							<Lookup chance="40" count="1" table="&trMinorItem2;"/>
							<Lookup chance="20" count="1" table="&trMajorItem2;"/>
						</Table>
					</Items>
				</Ship>
			</Table>
		</Ships>

		<Devices>
			<Device deviceID="&itSlamCannon;"	omnidirectional="true" posAngle="45"  posRadius="60"/>
			<Device deviceID="&itSlamCannon;"	omnidirectional="true" posAngle="215" posRadius="60"/>
		</Devices>

		<Trade currency="credit">
			<Sell	criteria="m +illegal; -notForSale; -notStandard;" priceAdj="100" inventoryAdj="100" levelFrequency="systemLevel:ruc|c|cur"/>
			<Sell	criteria="m +military; -notForSale; -notStandard;" priceAdj="100" inventoryAdj="100" levelFrequency="systemLevel:ruc|c|cur"/>
			<Sell	criteria="*NU +Illegal; -ID; -NotForSale;"	priceAdj="110"/>
			<Sell	criteria="*NU -ID; -NotForSale;"	priceAdj="100"/>
			<Buy	criteria="*NU +Illegal; -ID; -NotForSale;"	priceAdj="85"/>
			<Buy	criteria="*NU +military; -ID -NotForSale;"		priceAdj="90"/>
			<Buy	criteria="*NU +Illegal; -ID;"				priceAdj="10"/>
			<Buy	criteria="*NU +military; -ID;"				priceAdj="10"/>
			
			<Refuel			criteria="f +BasicFuel; L:1-6;" priceAdj="100"/>
			<RepairArmor	criteria="a L:1-6;" priceAdj="100"/>
			<ReplaceArmor	criteria="a L:1-6;" priceAdj="100"/>
			<InstallDevice	criteria="c +Illegal; L:1-8" priceAdj="100"	upgradeInstallOnly="true"/>
			<RemoveDevice	criteria="c L:1-8;" priceAdj="100" upgradeInstallOnly="true"/>
			
			<InstallDevice	criteria="d L:1-8;" priceAdj="unavailable"	messageID="descNoInstall"/>
		</Trade>
		
		<Items>
			<RandomItem count="1d4"
					criteria=		"c L:1-8; +illegal; -notForSale; -notStandard;"
					levelFrequency=	"systemLevel:rrrru|c|cur"
					/>
			<RandomItem count="6d12" 
					criteria=		"t +consumerGood; +illegal;"
					levelFrequency=	"systemLevel:ruc|c|cur"
					/>
			<RandomItem count="4d4" 
					criteria=		"* +illegal; -consumerGood; -id;"
					levelFrequency=	"systemLevel:ruc|c|cur"
					/>
		</Items>

		<!-- Events and Data -->
		
		<StaticData>
			<Data id="blackMarket.deployBountyHunters">True</Data>
			
			<Data id="blackMarket.destroyPenalty">250000</Data>
			<Data id="blackMarket.destroyBountyHunters">(random 1 3)</Data>
		</StaticData>
		
		<DockScreens>
			<Main>
				<Panes>
					<Default descID="descWelcome">
						<Actions>
							<Action id="actionTalk">
								(block Nil
									(setq gPrevScreen "Main")
									(scrShowScreen gScreen "Boss")
									)
							</Action>

							<Action id="actionBuyItems" default="1">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeBuy;)
							</Action>

							<Action id="actionSellItems">
								(scrShowScreen gScreen &dsRPGCommoditiesExchangeSell;)
							</Action>

							<Action id="actionDockServices">
								(rpgDockServices gPlayerShip {
									checkMilitaryID: Nil
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>
						</Actions>
					</Default>
				</Panes>
			</Main>

			<Boss>
				<Panes>
					<Default descID="descNoBoss">
						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</Default>
				</Panes>
			</Boss>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="90" />
			<Port x="0"		y="-90" />
			<Port x="60"	y="60" />
			<Port x="60"	y="-60" />
			<Port x="90"	y="0" />
			
			<Port x="-90"	y="0" />
			<Port x="-60"	y="60" />
			<Port x="-60"	y="-60" />
		</DockingPorts>

		<Language>
			<Text id="descNoInstall">
				We only install smuggler's equipment. We cannot install %itemName% on your ship.
			</Text>
			<Text id="dockServices:installAbility">
				We install smuggler's equipment up to tech level %maxLevel%.
			</Text>
		</Language>
	</StationType>

	<!-- Kate Morgental's Corporate Cruiser

	EXTRA DATA

	behavior:			Current behavior
							Nil						= Done
							'katamiRescueWait		= Waiting for the player to destroy defenders
							'katamiRescueDestroy	= Destroy the black market station
							'katamiRescueDock		= Dock with black market station

	target:				Target object
	-->

	<ShipClass UNID="&scKateMorgentalCruiserArena;"
			obsoleteVersion=			"40"
			manufacturer=		"Rasiermesser"
			class=				"corporate cruiser"
			type=				""

			attributes=			"capitalShip, corporate, kateMorgental, majorShip"
			   
			size=				"275"
			mass=				"25000"
			thrustRatio=		"2"
			maxSpeed=			"20"
			cargoSpace=			"1000"

			cyberDefenseLevel=	"8"

			explosionType=		"&vtThermoExplosion3;"
			>

		<Names noArticle="true" personalName="true">Kate Morgental</Names>

		<!-- Configuration -->
		
		<Armor
			armorID=			"&itHexaCarbideArmor;"
			count=				"16"
			/>
		
		<Devices>
			<Device deviceID="&itRasiermesserLauncher;" secondaryWeapon="true" minFireArc="340" maxFireArc="200"	posAngle="110" posRadius="60" posZ="0"/>
			<Device deviceID="&itRasiermesserLauncher;" secondaryWeapon="true" minFireArc="160" maxFireArc="20"		posAngle="250" posRadius="60" posZ="0"/>
			<Device deviceID="&itPlasmaShieldGenerator;"/>
		</Devices>

		<Maneuver
			maxRotationRate=	"3.0"
			rotationAccel=		"0.5"
			/>

		<Interior>
			<Compartment name="interior"
					hitPoints=	"300"
					/>
			
			<Compartment name="main drive"
					type=		"mainDrive"
					hitPoints=	"100"

					posX=		"-25"
					posY=		"0"
					sizeX=		"50"
					sizeY=		"40"
					/>
		</Interior>

		<Items>
			<Item count="40d20" item="&itGotha10Missile;"/>
			<Item count="2d12" item="&itPteracniumFuelRod;"/>
		</Items>

		<!-- Image and Effects -->

		<Image imageID="&rsCorporateCruiser;" imageWidth="230" imageHeight="230"/>

		<Effects>
			<Effect type="thrustMain"		posAngle="180"	posRadius="0"	posZ="-10"	rotation="180"	sendToBack="*"/>
		</Effects>
		
		<!-- AI and Behavior -->
		
		<AISettings
			fireRateAdj=		"40"
			fireAccuracy=		"95"
			perception=			"4"
			/>

		<Events>
			<OnBehavior>
				(block (state)
					(setq state (objGetData gSource "behavior"))
					(switch
						(eq state 'katamiRescueWait)
							(if (not (filter (staGetSubordinates (objGetObjRefData gSource "target")) theGuard (eq (objGetType theGuard) &scMolotok;)))
								(block (theTarget)
									(setq theTarget (objGetObjRefData gSource "target"))
									(objSendMessage gPlayerShip gSource "Nice work! Clear the area; we're inbound hot!")

									(if (objIsAbandoned theTarget)
										; If the station is already destroyed, just dock
										(block Nil
											(shpCancelOrders gSource)
											(shpOrder gSource 'dock theTarget)

											(objSetData gSource "behavior" 'katamiRescueDock)
											)

										; Otherwise, destroy the station
										(block Nil
											(shpCancelOrders gSource)
											(shpOrder gSource 'approach theTarget 100)
											(shpOrder gSource 'attack theTarget)

											(objSetData gSource "behavior" 'katamiRescueDestroy)
											)
										)
									)
								)

						(eq state 'katamiRescueDestroy)
							(if (objIsAbandoned (objGetObjRefData gSource "target"))
								(block Nil
									(objSendMessage gPlayerShip gSource "Target destroyed!")

									(shpCancelOrders gSource)
									(shpOrder gSource 'dock (objGetObjRefData gSource "target"))

									(objSetData gSource "behavior" 'katamiRescueDock)
									)
								)

						(eq state 'katamiRescueDock)
							(if (eq (typGetGlobalData &stBattleArena; "katamiStatus") 'rescued)
								(block Nil
									(shpCancelOrders gSource)
									(shpOrder gSource 'goto (objGetObjRefData gSource "anchorObj"))
									(shpOrder gSource 'wait 5)
									(shpOrder gSource 'gate)

									(sysCancelTimerEvent gSource "OnBehavior")

									(objSetData gSource "behavior" Nil)
									)
								)
						)
					)
			</OnBehavior>

			<OnDestroy>
				(switch
					; OK if Kate leaves
					(eq aDestroyReason 'enteredStargate)
						Nil
						
					; If player destroyed Kate's ship, then she remembers
					(and gPlayerShip (eq aOrderGiver gPlayerShip))
						(typSetGlobalData &svCorporate; "statusKateM" 'destroyedByPlayer)
					
					; Otherwise, we remembed that she was destroyed
					(typSetGlobalData &svCorporate; "statusKateM" 'destroyed)
					)
			</OnDestroy>

			<OrderKatamiRescue>
				(block (
					(theArena (sysFindObject gSource "TN +battleArena;"))
					targetObj
					)
					
					; Find the black market station
					(setq targetObj (sysFindObject gSource "TN +katamiRescue"))
					(objSetObjRefData gSource "target" targetObj)

					; Orbit the black market station waiting for the player
					(shpCancelOrders gSource)
					(shpOrder gSource 'approach targetObj 180)
					(shpOrder gSource 'orbit targetObj 180)

					; State
					(objSetData gSource "behavior" 'katamiRescueWait)

					; Set a timer so that we can do some custom behavior
					(sysAddObjRecurringTimerEvent 10 gSource "OnBehavior")
					)
			</OrderKatamiRescue>
			
			<OrderClearArena>
				(block (
					(arenaObj (sysFindObject gSource "TN +battleArenaMaximus;"))
					)
					
					(if (ls (objGetDistance gSource arenaObj) 80)
						(block Nil
							(objSetPos gSource (sysVectorPolarOffset arenaObj 270 80))
							
							(shpCancelOrders gSource)
							(shpOrder gSource 'gate)
							)
						)
					)
			</OrderClearArena>
		</Events>

	</ShipClass>

	<Globals>
		(block Nil
			(setq intBuyItems (lambda (itemCount itemCost)
				(rpgBuyItems itemCount itemCost)
				))

			(setq intDestroyItems (lambda (theObj)
				(rpgDestroyItems theObj)
				))

			(setq intJettisonItem (lambda (theObj theItem)
				(rpgJettisonItem theObj theItem)
				))

			(setq intSellItems (lambda (itemCount itemCost)
				(rpgSellItems itemCount itemCost)
				))

			; Dock screen functions --------------------------------------------
			
			(setq scrShowBuyScreen (lambda (itemsToSell returnScreen installOptions)
			
			; Shows a dockscreen allowing the player to buy items from the
			; station that the player is docked at.
			;
			; itemsToSell is either a function or an item criteria. If it is a
			; function then it should return the price of an item (or Nil if the
			; station will not buy the item.
			;
			; returnScreen is deprecated and no longer used.
			;
			; installOptions is an optional argument. If present the player is
			; offered the option to install an item that she buys. InstallOptions
			; is a list with the following elements:
			;
			; 0) Item criteria of items installed by this station.
			; 1) Max tech level that the station installs.
			; 2) Nil (Unused)
			; 3) If True, check military ID before allowing install.
			; 4) Markup in install cost (%)
			; ------------------------------------------------------------------
			
				(block Nil
					; Generate the function that computes price and availability
					(switch
						(isfunction itemsToSell)
							(setq gMargin itemsToSell)
						
						; If itemsToSell is set, then combine with station's Trade descriptors
						(and itemsToSell (not (eq itemsToSell "*")))
							(setq gMargin 
								(lambda (theItem)
									(switch
										(not (itmMatches theItem itemsToSell))
											Nil
											
										(intComputeSellPrice theItem)
										)
									)
								)
							
						; Otherwise, rely on station's Trade descriptors
						(setq gMargin intComputeSellPrice)
						)
						
					; If this station installs devices after purchase, set some vars
					(if installOptions
						(block Nil
							(setq gInstallCriteria (item installOptions 0))
							(setq gTechLevel (item installOptions 1))
							(setq gTechModifier (item installOptions 2))
							(setq gCheckMilitaryID (item installOptions 3))
							; Note: gInstallMargin = 100 means no markup
							(setq gInstallMargin (add 100 (item installOptions 4)))
							)
						(setq gInstallCriteria Nil)
						)
						
					; Show the screen
					(scrShowScreen gScreen "&dsExchangeBuy;")
					)
				))

			(setq useRepairArmor (lambda (theItem theSegment)
				(block (needsRepair resultText)
					(setq needsRepair (gr (objGetArmorDamage gPlayerShip theSegment) 0))
					
					(if needsRepair
						(block (repair failureChance skillLevel usedUp)
							(setq skillLevel (typGetGlobalData &dsUseArmorPatch; "skillLevel"))
							(setq repair (eval (itmGetStaticData theItem "RepairHP")))
							
							; If the repairing item is damaged armor, then we don't repair as much
							(if (itmMatches theItem "aD")
								(setq repair (divide repair 2))
								)

							; As skill level increased, the player's failure chance
							; decreases. Also the amount of hp repaired increased.
							(switch
								(ls skillLevel 2)
									(block Nil
										(setq failureChance 20)
										(setq repair (divide (multiply repair 80) 100))
										)

								(ls skillLevel 5)
									(setq failureChance 10)

								(ls skillLevel 10)
									(block Nil
										(setq failureChance 5)
										(setq repair (divide (multiply repair 110) 100))
										)

								(block Nil
									(setq failureChance 0)
									(setq repair 
										(divide (multiply repair (min (add 70 (multiply skillLevel 5)) 200)) 100)
										)
									)
								)
								
							; Do the repairs
							(setq usedUp 100)
							(switch
								(not repair)
									(setq resultText "ERROR: &lt;RepairHP&gt; static data not found.")

								(leq (random 1 100) failureChance)
									(if (eq (random 1 2) 1)
										; Sometimes we fail and damage the armor
										(block Nil
											(shpDamageArmor gPlayerShip theSegment 7 (divide (multiply repair (random 20 100)) 100))
											(setq resultText "Unfortunately, your attempt to repair the armor has only damaged it further.")
											)
											
										; Sometimes we fail without damaging further
										(block Nil
											(setq resultText (cat 
												"Unfortunately, your attempt to repair the armor was unsuccessful "
												"and the " (itmGetName theItem 0) " was ruined in the process."
												))
											)
										)

								(block (hpRepaired)
									(setq hpRepaired (objRepairArmor gPlayerShip theSegment repair))
									(setq resultText (cat 
										"You have successfully repaired " hpRepaired
										(if (eq hpRepaired 1) " hit point " " hit points ")
										"of damage to your armor."
										))
										
									; How much of the kit did we use?
									(if (gr repair 0)
										(setq usedUp (divide (multiply 100 hpRepaired) repair))
										)
										
									; Skill level increases
									(typIncGlobalData &dsUseArmorPatch; "skillLevel" 1)
									)
								)
								
							; Use up the item
							(if (or (ls skillLevel 10)
									(geq usedUp 20)
									(leq (random 1 100) (add usedUp 20))
									)
								(objRemoveItem gPlayerShip theItem 1)
								
								; Item is not used up
								(setq resultText (cat resultText 
									"\n\nThere is still enough of the " (itmGetName theItem 0)
									" left to repair other segments."
									))
								)
							)

						(setq resultText "That armor segment is not damaged. There is no need to attempt repairs.")
						)

					resultText
					)
				))

			(setq intFieldCrystalInstall (lambda (enhancementType theLifetime)
				(block (theShields)
					(switch
						; Must have a shield generator
						(not (setq theShields (item (objGetItems gSource "sI") 0)))
							(objSendMessage gSource Nil "Shield generator required")

						; Novaya repairers cannot be enhanced
						(itmHasAttribute theShields 'nonEnergyShields)
							(objSendMessage gSource Nil (typTranslate &itGreenEtheriumCrystal; 'msgCannotEnhance { itemName:(itmGetName theShields '(article short)) }))

						; If the shield generator is not advanced enough, then nothing happens
						(ls (itmGetLevel theShields) 7)
							(objSendMessage gSource Nil "Shield generator is too primitive for the field crystal")
							
						; If the shield generator is too advanced, then nothing happens
						(gr (itmGetLevel theShields) 12)
							(objSendMessage gSource Nil "Shield generator is too advanced for the field crystal")

						; Damage items cannot be enhanced
						(itmIsDamaged theShields)
							(objSendMessage gSource Nil "This crystal cannot enhance a damaged shield generator")
							
						; Enhance!
						(block Nil
							; Add enhancement
							(if (not (objAddItemEnhancement gSource theShields enhancementType theLifetime))
								(objSendMessage gSource Nil "The crystal has no effect")
								)

							; Identify the item
							(itmSetKnown gItem)

							; Remove ROM
							(objRemoveItem gSource gItem 1)
							)
						)
					)
				))

			(setq intFieldCrystalUse (lambda (newMods successText)
				(block (notFound)
					; Install
					(setq notFound True)
					(objEnumItems gSource "sI" theItem
						(block (shieldItem)
							(setq shieldItem theItem)
							(if notFound
								(block Nil
									(switch
										; Novaya repairers cannot be enhanced
										(itmHasAttribute shieldItem 'nonEnergyShields)
											(objSendMessage gSource Nil (typTranslate &itGreenEtheriumCrystal; 'msgCannotEnhance { itemName:(itmGetName shieldItem '(article short)) }))

										; If the shield generator is not advanced enough, then nothing happens
										(ls (itmGetLevel shieldItem) 7)
											(objSendMessage gSource Nil "Shield generator is too primitive for the field crystal")

										; If the shield generator is too advanced, then nothing happens
										(gr (itmGetLevel shieldItem) 12)
											(objSendMessage gSource Nil "Shield generator is too advanced for the field crystal")

										; If the item is damaged, we repair it
										(and (itmIsDamaged shieldItem) (ls newMods 0x8000))
											(block Nil
												(shpRepairItem gSource theItem)
												(objSendMessage gSource Nil "Shield generator has been repaired")
												
												; Remove ROM
												(objRemoveItem gSource gItem 1)
												)

										; Enhance the shield generator
										(block (result)
											(setq result (shpEnhanceItem gSource theItem {
												enhancement: newMods
												type: gType
												}))

											(objSendMessage gSource Nil (intItemEnhanceStatus result successText "shield generator"))
											
											; Identify the item
											(itmSetKnown gItem)

											; Remove ROM
											(objRemoveItem gSource gItem 1)
											)
										)
									(setq notFound Nil)
									)
								)
							)
						)

					(if notFound
						(objSendMessage gSource Nil "Shield generator required")
						)
					)
				))

			(setq intArmorEnhanceStatus (lambda (result)
				(switch
					(eq result 0)	;	ok
						""

					(eq result 1)	;	noEffect
						" But it has no effect on your armor."

					(eq result 2)	;	alreadyEnhanced
						" But your armor is already enhanced."

					(eq result 3)	;	degraded
						" Your armor has weakened further."

					(eq result 4)	;	defectRemoved
						" It seems to have restored your armor."

					(eq result 5)	;	enhancementRemoved
						" Your armor has lost its enhancement."

					(eq result 6)	;	enhancementReplaced
						" Unfortunately, your armor has lost its previous enhancement."

					(eq result 7)	;	improved
						" Your armor has been further enhanced."

					""
					)
				))

			(setq miningScanObj (lambda (asteroidObj podType)
				Nil
				))
				
			;	This function has been moved to a base class for all Black Market stations.
			
			(setq intBlackMarketOnDestroy (lambda (cost)
				(block Nil
					; Destroy items on the station
					(rpgDestroyItems gSource)

					; Player is tracked
					(if (and gPlayerShip (eq aOrderGiver gPlayerShip))
						(block (totalCrimeCost)
							(setq totalCrimeCost (objIncData gPlayerShip "blackMarketCrimeCost" cost))
							(if (objGetData gPlayerShip "blackMarketCrime")
								(objSetData gPlayerShip "blackMarketCrime" "multiple offenses against the Sindikat")
								(objSetData gPlayerShip "blackMarketCrime" (cat "the destruction of " (objGetName gSource 4)))
								)
								
							; If the cost of the player's crime is more than the equivalent
							; current experience level, then the Black Market becomes an enemy.
							; [I.e., the better the relationship with the BM, the greater the
							; chance that the BM will allow the player to pay back her debts.]
                    
							(if (gr (/ totalCrimeCost 100) (typ@ &unidBlackMarketMember; 'xp))
								(block Nil
									(sovSetDisposition &svBlackMarket; &svPlayer; 'enemy)
									(sovSetDisposition &svPlayer; &svBlackMarket; 'enemy)
    								)
	    						)
							)
						)
					)
				))
				
			;	No longer needed with new enhancement UI
				
			(setq intEnhanceWeaponUse (lambda (newMods damageType successText maxLevel)
				(block (notFound)
					(if (not maxLevel) (setq maxLevel 10))
					; Install
					(setq notFound True)
					(objEnumItems gSource "w~lI" theItem
						(block (weaponItem)
							(setq weaponItem theItem)
							(if (and 
									notFound 
									(or (not damageType) (eq (itmGetDamageType weaponItem) damageType))
									(eq (shpGetItemDeviceName gSource weaponItem) 0)
									)
								(block Nil
									(switch
										; If the weapon is too advanced, it doesn't work
										(gr (itmGetLevel weaponItem) maxLevel)
											(objSendMessage gSource Nil (cat "Your " (itmGetName weaponItem 32) " is too advanced to be optimized"))
												
										; If the item is damaged, we repair it
										(and (itmIsDamaged weaponItem) (ls newMods 0x8000))
											(block Nil
												(shpRepairItem gSource theItem)
												(objSendMessage gSource Nil (cat (itmGetName weaponItem 33) " has been repaired"))
												)

										; Enhance the weapon
										(block (result)
											(setq result (shpEnhanceItem gSource theItem {
												enhancement: newMods
												type: gType
												}))

											(objSendMessage gSource Nil (intItemEnhanceStatus result (cat "Your " (itmGetName weaponItem 32) " " successText) (cat "your " (itmGetName weaponItem 32))))
											)
										)
									(setq notFound Nil)
									)
								)
							)
						)

					; Item is identified

					(itmSetKnown gItem)

					; If we did not find a weapon to enhance, then no effect. Otherwise
					; we consume the item

					(if notFound
						(objSendMessage gSource Nil "The enhancement has no effect")
						(objRemoveItem gSource gItem 1)
						)
					)
				))

			; Aliases for backwards compatibility ------------------------------
			
			(setq comShowBuyScreen scrShowBuyScreen)
			(setq comShowSellScreen scrShowSellScreen)
			(setq intMassString strMassString)
			(setq intTranslate objTranslate)
			)
	</Globals>

	<!-- CSC Hospital -->

	<ShipClass UNID="&scCSCHospital;"
			obsoleteVersion=	"44"
			manufacturer=		"Earth Industries"
			class=				"Commonwealth Star Carrier"
			type=				""

			attributes=			"capitalShip, commonwealth, commonwealthFleet, commonwealthMilitary, EI, fleetLaw, majorShip"
			inherit=			"&baCSCBase;"
			   
			size=				"400"
			mass=				"200000"
			cargoSpace=			"5000"
			thrustRatio=		"0.5"
			maxSpeed=			"2"
			cyberDefenseLevel=	"6"
			   
			explosionType=		"&vtPlasmaExplosion2;"

			dockScreen=			"Main"
			>

		<!-- Configuration -->
		
		<Armor
			armorID=			"&itP1000HexphaseArmor;"
			count=				"20"
			/>
		
		<Devices>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" minFireArc="270" maxFireArc="90"  posAngle="0" posRadius="98" posZ="-5"/>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" minFireArc="90"  maxFireArc="270" posAngle="180" posRadius="98" posZ="-5"/>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" omnidirectional="true" posAngle="90" posRadius="98" posZ="-5"/>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" omnidirectional="true" posAngle="270" posRadius="98" posZ="-5"/>
			
			<Device deviceID="&itMissileDefense;" omnidirectional="true" />
			<Device deviceID="&vtDamageControlParty;"/>
		</Devices>

		<Maneuver
			maxRotationRate=	"1"
			rotationAccel=		"0.1"
			/>

		<Interior>
			<Compartment name="interior"
					hitPoints=	"400"
					/>
			
			<Compartment name="main drive"
					type=		"mainDrive"
					hitPoints=	"200"

					posX=		"-56"
					posY=		"0"
					sizeX=		"42"
					sizeY=		"60"
					/>
		</Interior>
		
		<Items>
			<Item				count="6d12"	item="&itPteracniumFuelRod;"/>
			
			<!-- Some upgrades for sale -->
			
			<RandomItem count="1d3" criteria="r -illegal; -notForSale; -notStandard; L:6-8;"		levelFrequency="systemLevel:ru|c|curv"/>
			
			<Item count="3d4"	item="&itBlastPlate;"/>
			<Item count="3d4"	item="&itP120HexphaseArmor;"/>
			<Item count="1d4"	item="&itTeV9Blaster;"/>
			<Item count="1d4"	item="&itR1Deflector;"/>
		</Items>

		<Image imageID="&rsCSCHD;" imageWidth="370" imageHeight="370" rotationCount="120" rotationColumns="12" viewportRatio="0.03"/>

		<Effects>
			<Effect type="thrustMain"		posAngle="166"	posRadius="116"	posZ="-10"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="180"	posRadius="114"	posZ="-10"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="-166"	posRadius="116"	posZ="-10"	rotation="180"	effect="&efMainThrusterLarge;"/>
		</Effects>
			
		<DockingPorts>
			<Port posAngle="90"   posRadius="105"  posZ="0" />
			<Port posAngle="-90"  posRadius="105"  posZ="0" />

			<Port posAngle="45"   posRadius="105"  posZ="0"	bringToFront="*"/>
			<Port posAngle="135"  posRadius="105"  posZ="0"	bringToFront="*"/>
			<Port posAngle="225"  posRadius="105"  posZ="0"	bringToFront="*"/>
			<Port posAngle="315"  posRadius="105"  posZ="0"	bringToFront="*"/>
		</DockingPorts>

		<AISettings
			fireRateAdj=		"15"
			fireAccuracy=		"95"
			perception=			"4"
			/>

		<Trade currency="credit">
			<Sell	criteria="m +commonwealth; +military; -illegal; -notForSale; -notStandard;" priceAdj="100" inventoryAdj="200" levelFrequency="systemLevel:ruc|c|cur"/>
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="100"/>
			
			<Refuel			criteria="f +BasicFuel; L:1-9;" priceAdj="100"/>
			<RepairArmor	criteria="a L:1-9;" priceAdj="100"/>
			<ReplaceArmor	criteria="a L:1-9;" priceAdj="100"/>
			<InstallDevice	criteria="d L:1-8;" priceAdj="100"/>
			<RemoveDevice	criteria="d L:1-8;" priceAdj="100"/>
		</Trade>
		
		<StaticData>
			<arcticaCaptainWelcome>
				(
					"The captain of the CSC Arctica welcomes you aboard: \"How are things going back in the Commonwealth? I haven't been to St. Katharine's in more than five years&#x97;had an amazing time at this little bar in the inner system. You really should check it out&#x97;if you make it back, I mean.\""
					)
			</arcticaCaptainWelcome>

			<arcticaGiftTable>
				(	; donation	item						count	unique
					(10000		&itPlasmaShieldGenerator;	1		'Gift1)
					(5000		&itInvincibleDeflector;		1		'Gift2)
					(2500		&itR5Deflector;				1		'Gift3)
					(1250		&itEMPImmuneCoating;		4		'Gift4)
					(0			&itKobeWater;				1		Nil)
					)
			</arcticaGiftTable>

			<saharaCaptainWelcome>
				(
					"The captain of the CSC Sahara welcomes you aboard: \"I hope you will be able to help our good doctor to obtain medical supplies. This damn war has made more invalids than heroes.\""
					)
			</saharaCaptainWelcome>

			<saharaGiftTable>
				(	; donation	item						count	unique
					(10000		&itMammoth100Deflector;		1		'Gift1)
					(5000		&itBlueEtheriumCrystal;		1		'Gift2)
					(2500		&itPatchSpider;				1		'Gift3)
					(1250		&itR1Deflector;				1		'Gift4)
					(0			&itEuropanIceVodka;			1		Nil)
					)
			</saharaGiftTable>
		</StaticData>

		<DockScreens>
			<Main backgroundID="none">
				<Display>
					<Image left="140" top="144" width="320" height="240" transparent="true">
						(@ (objGetData gSource 'CSCData) 'emblem)
					</Image>
				</Display>
				
				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDescTranslate gScreen 'descWelcome { shipName:(objGetName gSource 'article) })
						</OnPaneInit>

						<Actions>
							<Action id="actionBridge" default="1">
								(block Nil
									(scrShowScreen gScreen "Bridge")
								
									; If see if we got promoted
									(if (intFleetPromotion)
										(scrShowScreen gScreen "&dsFleetPromotion;")
										)
									)
							</Action>

							<Action id="actionInfirmary">
								(scrShowScreen gScreen "Infirmary")
							</Action>

							<Action id="actionDockServices">
								(rpgDockServices gPlayerShip {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>
						</Actions>
					</Default>
				</Panes>

			</Main>

			<Bridge
				name=			"Bridge"
				backgroundID=	"none"
				>

				<Display>
					<Image left="140" top="144" width="320" height="240" transparent="true">
						(@ (objGetData gSource 'CSCData) 'emblem)
					</Image>
				</Display>
				
				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDesc gScreen (intRandomMessage gSource (cat (objGetData gSource "CSC") "CaptainWelcome") "arcticaCaptainWelcome"))
						</OnPaneInit>

						<Actions>
							<Action id="actionLeave" default="1" cancel="1">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</Default>
				</Panes>

			</Bridge>

			<Infirmary
				name=			"Infirmary"
				backgroundID=	"none"
				>

				<Display>
					<Image left="140" top="144" width="320" height="240" transparent="true">
						(@ (objGetData gSource 'CSCData) 'emblem)
					</Image>
				</Display>
				
				<Panes>
					<Default descID="descInfirmary">
						<Actions>
							<Action id="actionTalkMedical" default="1">
								(block Nil
									; See if the player has any medical supplies
									(setq gItem (objGetItems gPlayerShip "*U +Meds; -questItem; -notForSale;"))

									(if gItem
										(scrShowPane gScreen "SellMedicalItems")
										(scrShowPane gScreen "NoMedicalItems")
										)
									)
							</Action>

							<!--
							<Action name="Talk to patient" key="P">
								</Action>
								-->

							<Action id="actionLeave" cancel="1">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</Default>

					<NoMedicalItems descID="descNoMedicalItems">
						<Actions>
							<Action id="actionLeave" default="1" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>

					</NoMedicalItems>

					<SellMedicalItems>
						<OnPaneInit>
							(block (medicalItem)
								; Figure out how much all the supplies cost
								(setq gCost 0)
								(enum gItem medicalItem
									(setq gCost 
										(add gCost 
											; Offer 25% more
											(divide (multiply 125 (itmGetPrice medicalItem 'credit) (itmGetCount medicalItem)) 100)
											)
										)
									)

								; Set the description
								(if (eq (count gItem) 1)
									; Only one item
									(scrSetDesc gScreen 
										"\"Welcome to the Infirmary, %sir%! We are in desperate need of medical supplies. "
										"I'm prepared to offer you " gCost " credits for the " (itmGetName (item gItem 0) 16) " in your cargo hold. "
										"What do you say?\""
										)

									; Multiple items
									(block (medicalItem itemListDesc)
										(enum gItem medicalItem
											(if itemListDesc
												(setq itemListDesc (cat itemListDesc ", " (itmGetName medicalItem 8)))
												(setq itemListDesc (cat "(" (itmGetName medicalItem 8)))
												)
											)

										(setq itemListDesc (cat itemListDesc ")"))

										(scrSetDesc gScreen 
											"\"Welcome to the Infirmary, %sir%! We are in desperate need of medical supplies. "
											"I'm prepared to offer you " gCost " credits for all the medical items in your cargo hold: " itemListDesc 
											". What do you say?\""
											)
										)
									)
								)
						</OnPaneInit>

						<Actions>
							<Action id="actionSellItems" default="1">
								(block (medicalItem)
									; Remove the items from the cargo hold
									(enum gItem medicalItem
										(block Nil
											(objRemoveItem gPlayerShip medicalItem)
											(plyRecordSellItem gPlayer medicalItem 
												(divide (multiply 125 (itmGetPrice medicalItem 'credit) (itmGetCount medicalItem)) 100)
												)
											)
										)

									; Pay the player
									(plyCredit gPlayer gCost)

									; Done
									(scrShowPane gScreen "DoneSelling")
									)
							</Action>

							<Action id="actionDonate">
								(block (medicalItems)
									; Remove the items from the cargo hold
									(enum gItem medicalItem
										(objRemoveItem gPlayerShip medicalItem)
										)
										
									; Keep track of how much we donate
									(typIncGlobalData &svCommonwealthFleet; "medsDonated" gCost)

									; Player gets a gift depending on how much she donated
									(scrShowPane gScreen "Donate")
									)
							</Action>

							<Action id="actionLeave" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>

					</SellMedicalItems>

					<DoneSelling descID="descDoneSelling">
						<Actions>
							<Action id="actionLeave" default="1" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>

					</DoneSelling>

					<Donate>
						<OnPaneInit>
							(block (gift giftTable fleetXP xpGain maxGain)
								; Get the gift table
								(setq giftTable (objGetStaticData gSource (cat (objGetData gSource "CSC") "GiftTable")))
								(if (not giftTable)
									(setq giftTable (objGetStaticData gSource "arcticaGiftTable"))
									)

								; Find the appropriate gift based on the donation. The donation amount
								; must be greater than the minimum for the gift and the gift must have
								; not been given before (or the gift must not be unique).
								(setq gift Nil)
								(enumwhile giftTable (not gift) thisEntry
									(if (and (geq gCost (item thisEntry 0))
											(or (not (item thisEntry 3)) (not (objGetData gSource (item thisEntry 3))))
											)
										(block Nil
											(setq gift (itmCreate (item thisEntry 1) (item thisEntry 2)))

											; Do not give this gift again
											(if (item thisEntry 3)
												(objSetData gSource (item thisEntry 3) True)
												)
											)
										)
									)

								; Describe the gift
								(scrSetDesc gScreen (cat "\"Your generosity humbles me! When I was posted in the front-lines I came across " (itmGetName gift 8) ". I would be honored if you would accept it as a gift.\""))

								; Give the gift to the player
								(objAddItem gPlayerShip gift)

								; Figure out how much experience we could gain. We cannot gain more than
								; 200xp or xp beyond 600 (Master Sergeant).
								(setq fleetXP (objGetData gPlayerShip "fleetXP"))
								(switch
									(geq fleetXP 600)
										(setq maxGain 0)

									(geq fleetXP 400)
										(setq maxGain (subtract 600 fleetXP))

									(setq maxGain 200)
									)

								; Player gains experience at the rate of 1 xp per 10 credits
								; up to a maximum
								(setq xpGain (divide gCost 10))
								(if (gr xpGain maxGain)
									(setq xpGain maxGain)
									)

								(objIncData gPlayerShip "fleetXP" xpGain)
								)
						</OnPaneInit>

						<Actions>
							<Action id="actionDone" default="1" cancel="1">
								(scrShowPane gScreen "Default")
							</Action>
						</Actions>
					</Donate>

				</Panes>

			</Infirmary>

		</DockScreens>

		<Language>
			<Text id="actionBridge">[B]ridge</Text>
			<Text id="actionInfirmary">[M]edbay</Text>
			<Text id="actionTalkMedical">Talk to [M]edical Officer</Text>
			<Text id="actionDonate">[D]onate Items</Text>

			<Text id="descWelcome">

				You are in the docking bay of %shipName%.

			</Text>
			<Text id="descInfirmary">

				You are in the main infirmary of a Commonwealth Star Carrier. 
				Sleep-deprived technicians attend hundreds of patients in their 
				rejuv tanks, mostly oblivious to the insistent medical alarms. 
				
				The smell of blood, wounds, and antiseptics smother you.

			</Text>
			<Text id="descNoMedicalItems">

				The Medical Officer complains about how hard it is to get 
				medical supplies this deep in space.
				
				"We're getting killed out here fighting the Ares and this is 
				how the Commonwealth thanks us&mdash;no supplies, no 
				reinforcements, nothing!"

			</Text>
			<String id="descDoneSelling">

				"Thank you, those supplies are really going to help these troopers."

			</String>
		</Language>

	</ShipClass>

	<!-- CSC Task Force
	
	GLOBAL DATA
	
	missionsAccepted:	Total missions accepted
	missionsCompleted:	Total missions completed successfully
	missionsFailed:		Total missions failed

	EXTRA DATA
	
	MissionID:			ID of current mission
	MissionStatus:		Current status of mission:
							Nil					= no mission in progress
							'inprogress			= mission in progress
							'success			= mission succeeded
							'failure			= mission failed

	PLAYER SHIP EXTRA
	
	fleetTFSuccess:		Total number of successful missions
	fleetTFFailure:		Total number of failed missions

	-->

	<ShipClass UNID="&scCSCTaskForce;"
			obsoleteVersion=	"44"
			manufacturer=		"Earth Industries"
			class=				"Commonwealth Star Carrier"
			type=				""
			defaultSovereign=	"&svCommonwealthFleet;"

			attributes=			"capitalShip, commonwealth, commonwealthFleet, commonwealthMilitary, EI, fleetLaw, majorShip"
			inherit=			"&baCSCBase;"
			   
			size=				"400"
			mass=				"200000"
			thrustRatio=		"0.5"
			maxSpeed=			"2"
			cargoSpace=			"5000"
			cyberDefenseLevel=	"8"
			   
			explosionType=		"&vtPlasmaExplosion2;"

			dockScreen=			"Main"
			>

		<!-- Configuration -->
		
		<Armor
			armorID=			"&itP1000HexphaseArmor;"
			count=				"20"
			/>
		
		<Devices>
			<Device deviceID="&itSAR40Cannon;" secondaryWeapon="true" minFireArc="270" maxFireArc="90"  posAngle="0" posRadius="98" posZ="-5"/>
			<Device deviceID="&itSAR40Cannon;" secondaryWeapon="true" minFireArc="90"  maxFireArc="270" posAngle="180" posRadius="98" posZ="-5"/>
			<Device deviceID="&itSAR40Cannon;" secondaryWeapon="true" omnidirectional="true" posAngle="90" posRadius="98" posZ="-5"/>
			<Device deviceID="&itSAR40Cannon;" secondaryWeapon="true" omnidirectional="true" posAngle="270" posRadius="98" posZ="-5"/>
			
			<Device deviceID="&itMissileDefense;" omnidirectional="true" />
			<Device deviceID="&vtDamageControlParty;"/>
		</Devices>

		<Maneuver
			maxRotationRate=	"1"
			rotationAccel=		"0.1"
			/>

		<Interior>
			<Compartment name="interior"
					hitPoints=	"600"
					/>
			
			<Compartment name="main drive"
					type=		"mainDrive"
					hitPoints=	"200"

					posX=		"-56"
					posY=		"0"
					sizeX=		"42"
					sizeY=		"60"
					/>
		</Interior>

		<Items>
			<Item				count="6d12"	item="&itPteracniumFuelRod;"/>
			
			<!-- Some upgrades for sale -->
			
			<RandomItem count="1d4" criteria="r -illegal; -notForSale; -notStandard; L:6-9;"		levelFrequency="systemLevel:ru|c|curv"/>
			
			<Item count="3d4"	item="&itBlastPlate;"/>
			<Item count="3d4"	item="&itP120HexphaseArmor;"/>
			<Item count="1d4"	item="&itStarCannon;"/>
			<Item count="1d4"	item="&itTeV9Blaster;"/>
			<Item count="1d4"	item="&itR1Deflector;"/>
			<Item count="1d4"	item="&itR5BDeflector;"/>
		</Items>

		<!-- Image and Effects -->

		<Image imageID="&rsCSCHD;" imageWidth="370" imageHeight="370" rotationCount="120" rotationColumns="12" viewportRatio="0.03"/>

		<Effects>
			<Effect type="thrustMain"		posAngle="166"	posRadius="116"	posZ="-10"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="180"	posRadius="114"	posZ="-10"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="-166"	posRadius="116"	posZ="-10"	rotation="180"	effect="&efMainThrusterLarge;"/>
		</Effects>
			
		<DockingPorts>
			<Port posAngle="90"   posRadius="105"  posZ="0" />
			<Port posAngle="-90"  posRadius="105"  posZ="0" />

			<Port posAngle="45"   posRadius="105"  posZ="0"	bringToFront="*"/>
			<Port posAngle="135"  posRadius="105"  posZ="0"	bringToFront="*"/>
			<Port posAngle="225"  posRadius="105"  posZ="0"	bringToFront="*"/>
			<Port posAngle="315"  posRadius="105"  posZ="0"	bringToFront="*"/>
		</DockingPorts>

		<!-- AI and Behavior -->

		<AISettings
			fireRateAdj=		"20"
			fireAccuracy=		"95"
			perception=			"6"
			/>
		
		<Trade currency="credit">
			<Sell	criteria="m +commonwealth; +military; -illegal; -notForSale; -notStandard;" priceAdj="100" inventoryAdj="500" levelFrequency="systemLevel:ruc|c|cur"/>
			<Sell	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="100"/>
			
			<Refuel			criteria="f +BasicFuel; L:1-9;" priceAdj="100"/>
			<RepairArmor	criteria="a L:1-10;" priceAdj="100"/>
			<ReplaceArmor	criteria="a L:1-10;" priceAdj="100"/>
			<InstallDevice	criteria="d L:1-9;" priceAdj="100"/>
			<RemoveDevice	criteria="d L:1-9;" priceAdj="100"/>
		</Trade>

		<DockScreens>
			<Main backgroundID="none">
				<Display>
					<Image left="140" top="144" width="320" height="240" transparent="true">
						(@ (objGetData gSource 'CSCData) 'emblem)
					</Image>
				</Display>

				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDescTranslate gScreen 'descWelcome { shipName:(objGetName gSource 'article) })
						</OnPaneInit>

						<Actions>
							<Action id="actionBridge" default="1">
								(scrShowScreen gScreen "Bridge")
							</Action>

							<Action id="actionFlightDeck">
								(scrShowScreen gScreen "FlightDeck")
							</Action>

							<Action id="actionDockServices">
								(rpgDockServices gPlayerShip {
									checkMilitaryID: True
									})
							</Action>

							<Action id="actionUndock" cancel="1">
								<Exit/>
							</Action>
						</Actions>
					</Default>
				</Panes>
			</Main>

			<Bridge
				name=			"Bridge"
				backgroundID=	"none"
				>

				<Display>
					<Image left="140" top="144" width="320" height="240" transparent="true">
						(@ (objGetData gSource 'CSCData) 'emblem)
					</Image>
				</Display>
				
				<Panes>
					<Default>
						<OnPaneInit>
							(switch
								(eq (objGetData gSource "CSC") "america")
									(scrSetDesc gScreen "You talk to the captain of the CSC America. \"The Ares have been ruthless. When we lost the CSC Europa, the damn Martians deliberately targeted the emergency capsules. We taught them a lesson after that, though: we torched several of their communes.\"")

								(eq (objGetData gSource "CSC") "india")
									(scrSetDesc gScreen "You talk to the captain of the CSC India. \"If you ever get back to the Commonwealth, you've got to tell them to send more ships. We're getting killed out here and I don't even know if anyone back home cares.\"")

								(eq (objGetData gSource "CSC") "atlantica")
									(scrSetDesc gScreen "You talk to the captain of the CSC Atlantica. \"This war has been tough on the troops. We've had to start scavenging for vital supplies. I'm not surprised that the discipline in some units has deteriorated.\"")

								(eq (objGetData gSource "CSC") "asia")
									(scrSetDesc gScreen "You talk to the captain of the CSC Asia. \"When the Antarctica went rogue, Admiral Decker just about pissed acid. He was furious! He took it as a personal betrayal.\"")

								(eq (objGetData gSource "CSC") "pacifica")
									(scrSetDesc gScreen "You talk to the captain of the CSC Pacifica. \"You ever meet a Martian? Not the meek little Syrtians&#x97;I mean the Ares clones. They all have this smug look of superiority that cranks me up. They look better in the crosshairs of TeV 9, that's for sure!\"")

								(scrSetDesc gScreen "The captain welcomes you aboard.")
								)
						</OnPaneInit>

						<Actions>
							<Action id="actionLeave" default="1" cancel="1">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</Default>
				</Panes>

			</Bridge>

			<FlightDeck
				name=			"Flight Deck"
				backgroundID=	"none"
				>

				<Display>
					<Image left="140" top="144" width="320" height="240" transparent="true">
						(@ (objGetData gSource 'CSCData) 'emblem)
					</Image>
				</Display>
				
				<Panes>
					<Default>
						<OnPaneInit>
							(block (behavior rank)
								(setq behavior (objGetData gSource "behavior"))
								(setq rank (objGetData gPlayerShip "fleetLevel"))
								
								(switch
									(eq behavior 'moving)
										(scrSetDesc gScreen
											"You are on the flight deck of " (objGetName gSource 'article) ". "
											"The ship is on maneuvers and the XO is giving orders to the astrogator and the sensor chief."
											)
											
									(eq rank 1)
										(scrSetDesc gScreen
											"The flight deck of " (objGetName gSource 'article) 
											" hums with the activity of men and women working at terminals and holocharts. "
											"The XO is giving orders to a squadron out on a mission."
											)

									(scrSetDesc gScreen
										"You are on the flight deck of " (objGetName gSource 'article) ". "
										"Men and women work at terminals planning missions and communicating with squadrons on patrol. "
										"The XO is near a holochart, listening to a report."
										)
									)
								)
						</OnPaneInit>

						<Actions>
							<Action id="actionTalk" default="1">
								(block (
									(behavior (objGetData gSource "behavior"))
									(rank (objGetData gPlayerShip "fleetLevel"))
									)
									(switch
										(eq behavior 'moving)
											(scrShowPane gScreen "ShipMoving")
										
										(rpgMissionAssignment {
											missionCriteria: (cat "n +cscTaskForce; +rank" (int rank) "; =" (sysGetLevel) ";")
											noMissionTextID: 'descNoMissions
											})
										)
									)
							</Action>

							<Action id="actionLeave" cancel="1">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</Default>
					
					<ShipMoving>
						<OnPaneInit>
							(scrSetDesc gScreen
								"The XO is too busy to talk to you right now. He waves you away while he concentrates on the maneuvers."
								)
						</OnPaneInit>
						
						<Actions>
							<Action id="actionLeave" default="1" cancel="1">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</ShipMoving>
				</Panes>
			</FlightDeck>

		</DockScreens>

		<Language>
			<Text id="actionBridge">[B]ridge</Text>
			<Text id="actionFlightDeck">[F]light Deck</Text>
			<Text id="actionTalk">Talk to E[x]ecutive Officer</Text>

			<Text id="descWelcome">

				You are in the docking bay of %shipName%.

			</Text>

			<Text id="descNoMissions">

				"Sorry, there are no missions available for you."

			</Text>
		</Language>

	</ShipClass>

	<!-- Starting in API 43 we add attributes to system nodes to decide where 
		various sovereigns can spawn. But to handle old extensions (e.g., TSB)
		we add some compatibility code here. -->

	<SystemMap unid="&smSpawnCompatibility;"
			displayOn="&smHumanSpace;"
			obsoleteVersion="1"
			>
		<!-- This particular solution (add attributes to all systems) has too
			many disadvantages. In particular, it means that extensions like 
			TBR, which has been updated, begin to fail if the player includes an
			old extension.

			As of API 44, we've decided to remove the backwards compatibility
			code and just deal with the fallout.

			If we really need to fix this, we would have to do the following:

			1. Keep track of the API version for each node created.
			2. Add a TopologyProcessor criteria to select nodes of a give API
			   version range.

		<TopologyProcessor priority="primaryColony">
			<System attributes="abbasidSpace, anarchistSpace, aresSpace, centauriWarlordsSpace, commonwealthCore, commonwealthSpace, corporateCore, corporateSpace, cscOperationsSpace, dwargSpace, ferianSpace, gaianSpace, heliotropeSpace, himalSpace, kobolSpace, luminousSpace, outlawSpace, penitentSpace, ranxSpace, ringerSpace, rogueFleetSpace, salvagerSpace, sapiensSpace, sungSpace, teratonSpace, tinkerSpace, urakSpace, ventariSpace, xenophobeSpace"/>
		</TopologyProcessor>
		-->
	</SystemMap>

	<!-- Use Armor Coating -->

	<DockScreen UNID="&dsUseArmorCoating;"
			obsoleteVersion=			"45"
			name=				"Ship's Interior"
			type=				"itemPicker"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"aI"
			/>

		<Panes>
			<Default>
				<OnPaneInit>
					(block (desc type)
						(setq gArmorSegment (itmGetArmorInstalledLocation (scrGetItem gScreen)))
						(setq type (objGetArmorType gPlayerShip gArmorSegment))
						(if (itmIsKnown gItem)
							(setq desc (cat "You can use the " (itmGetName gItem 0) " on"))
							(setq desc (cat "The barrel seems to contain some kind of armor paste. You can use it on"))
							)

						(scrSetDesc gScreen (cat desc " your ship's " (objGetArmorName gPlayerShip gArmorSegment) " " (armGetName type) "."))
						)
				</OnPaneInit>

				<Actions>
					<Action name="Use on this Armor Segment" key="U" default="1">
						(block (coatingType)
							(setq gArmorSegment (itmGetArmorInstalledLocation (scrGetItem gScreen)))
							(setq coatingType (itmGetTypeData gItem))
							(switch
								(eq coatingType 'ablative)
								(block (desc result)
									(setq desc "The paste is an ablative coating that resists laser and particle damage.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0a05)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'acid)
								(block Nil
									(shpDamageArmor gPlayerShip gArmorSegment 2 (rollDice 3 6 0))
									(setq gTitle "Unfortunately, the barrel contained an organic acid that eats through most metals. Your armor has been damaged.")
									)

								(eq coatingType 'carbon-weave)
								(block (desc result enhancement itemLevel)
									(setq desc "The coating is composed of nanomachines that strengthen your armor.")

									; Figure out the enhancement based on the level
									(setq itemLevel (itmGetLevel (scrGetItem gScreen)))
									(setq enhancement Nil)
									(switch
										(leq itemLevel 3)
											(setq enhancement 0x0105)

										(leq itemLevel 5)
											(setq enhancement 0x0103)

										(leq itemLevel 6)
											(setq enhancement 0x0101)
										)

									(if enhancement
										(block Nil
											(setq result (shpEnhanceItem gPlayerShip (scrGetItem gScreen) enhancement))
											(setq gTitle (cat desc (intArmorEnhanceStatus result)))
											)
										(setq gTitle (cat desc " Unfortunately, your armor is too strong for the nanomachines."))
										)
									)

								(eq coatingType 'carbon-weave2)
								(block (desc result itemLevel)
									(setq desc "The coating is composed of nanomachines that strengthen your armor.")

									; Figure out the enhancement based on the level
									(setq itemLevel (itmGetLevel (scrGetItem gScreen)))
									(switch
										(leq itemLevel 6)
											(setq gTitle (cat desc " Unfortunately, your armor is too primitive for the nanomachines."))

										(leq itemLevel 10)
											(block Nil
												(setq result (shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0105))
												(setq gTitle (cat desc (intArmorEnhanceStatus result)))
												)

										(setq gTitle (cat desc " Unfortunately, your armor is too strong for the nanomachines."))
										)
									)

								(eq coatingType 'centauriNanos)
								(block (desc result enhancement itemLevel)
									(setq desc "The coating is composed of nanomachines that strengthen your armor against laser and impact damage.")

									; Figure out the enhancement based on the level
									(setq itemLevel (itmGetLevel (scrGetItem gScreen)))
									(setq enhancement Nil)
									(switch
										(leq itemLevel 3)
											(setq enhancement 0x0808)

										(leq itemLevel 5)
											(setq enhancement 0x0805)

										(leq itemLevel 6)
											(setq enhancement 0x0803)
										)

									(if enhancement
										(block Nil
											(setq result (shpEnhanceItem gPlayerShip (scrGetItem gScreen) enhancement))
											(setq gTitle (cat desc (intArmorEnhanceStatus result)))
											)
										(setq gTitle (cat desc " Unfortunately, your armor is too strong for the nanomachines."))
										)
									)

								(eq coatingType 'decon)
								(block Nil
									(setq desc "The barrel was filled with a decontamination gel.")

									(if (shpIsRadioactive gPlayerShip)
										(block Nil
											(shpDecontaminate gPlayerShip)
											(setq desc (cat desc " Your ship has been decontaminated."))
											)
										(setq desc (cat desc " Since your ship is not radioactive, the gel has no effect."))
										)

									(setq gTitle desc)
									)

								(eq coatingType 'degenerating)
								(block Nil
									(setq desc "The paste is a nanomachine matrix that dissolves metals and composites.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x8200)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'EMPimmune)
								(block (desc result)
									(setq desc "The barrel contains monopole dust, which protects your armor against EMP effects.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0b20)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'ioneffectimmune)
								(block (desc result)
									(setq desc "The barrel contains dyon dust, which immunizes your armor against disabling ion effects.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0c00)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'ionresist)
								(block (desc result)
									(setq desc "The paste is a coating that resists ion damage.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0945)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'particleresist)
								(block (desc result)
									(setq desc "The paste is a coating that resists particle damage.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0925)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'radiationimmune)
								(block (desc result)
									(setq desc "The barrel contains a borocarbide paste that resists radiation.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0b00)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'radioactive)
								(block Nil
									(setq desc "The barrel contained radioactive waste.")

									(switch
										(shpIsRadioactive gPlayerShip)
											(setq desc (cat desc " Your ship is already radioactive; the waste has no further effect."))

										(shpIsRadiationImmune gPlayerShip (scrGetItem gScreen))
											(setq desc (cat desc " Fortunately, your armor is immune to radiation. The waste has no effect."))

										(block Nil
											(shpMakeRadioactive gPlayerShip)
											(setq desc (cat desc " Your ship has been contaminated."))
											)
										)

									(setq gTitle desc)
									)

								(eq coatingType 'reactive)
								(block (desc result)
									(setq desc "The paste is a reactive coating that resists kinetic and chemical explosion damage.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0a15)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'reflective)
								(block (desc result)
									(setq desc "The paste is a mirrored coating that reflects laser beams.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x030a)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'regenerating)
								(block (
									desc result
									(itemLevel (itmGetLevel (scrGetItem gScreen)))
									)
									(setq desc "The paste is a nanomachine matrix that regenerates the armor segment.")
									
									(switch
										(geq itemLevel 10)
											(setq gTitle (cat desc " Unfortunately, your armor is too advanced for the nanomachines."))
											
										(block Nil
											(setq result
												(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0200)
												)

											(setq gTitle (cat desc (intArmorEnhanceStatus result)))
											)
										)
									)

								(eq coatingType 'shieldresist)
								(block (desc result)
									(setq desc "The barrel contains meteorsteel dust.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x8c00)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(eq coatingType 'thermoresist)
								(block (desc result)
									(setq desc "The paste is a coating that resists thermonuclear damage.")

									(setq result
										(shpEnhanceItem gPlayerShip (scrGetItem gScreen) 0x0955)
										)

									(setq gTitle (cat desc (intArmorEnhanceStatus result)))
									)

								(setq gTitle "Unknown barrel type")
								)

							; Remove the armor paste from the player's list
							(objRemoveItem gPlayerShip gItem 1)

							; Identify the item
							(itmSetKnown gItem)

							(scrShowPane gScreen "Done")
							)
					</Action>

					<Action name="Cancel" key="C" cancel="1">
						<Exit/>
					</Action>

				</Actions>

			</Default>

			<Done 
					desc="=gTitle"
					noListNavigation="true"
					>

				<Actions>
					<Action name="Done" cancel="1" default="1" key="D">
						<Exit/>
					</Action>
				</Actions>
			</Done>

		</Panes>

	</DockScreen>

	<!-- Use Longzhu Sphere -->

	<DockScreen UNID="&dsUseLongzhuSphere;"
			obsoleteVersion=			"45"
			name=				"Ship's Cargo Hold"
			type=				"itemPicker"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"d -LongzhuSphere;"
			/>

		<Panes>
			<Default descID="descUseLongzhuDefault">
				<Actions>
					<Action name="Use on this Item" default="1" key="U">
						(block (itemType)
							(setq gItem (scrGetItem gScreen))
							(setq itemType (itmGetType gItem))

							(switch
								(eq itemType &itQianlongArchcannon;)
									(block (recharged)
										(setq recharged (objFireItemEvent gPlayerShip gItem "Recharge" { charges:256 }))

										(switch
											(eq recharged 0)
												(setq gTitle "The longzhu sphere glows with stored power but the Qianlong archcannon is unaffected.")

											(setq gTitle (cat "The longzhu sphere glows with stored power and the Qianlong archcannon hums with new energy. Your Qianlong archcannon has been recharged."))
											)

										(objRemoveItem gPlayerShip (itmCreate &itLongzhuSphere; 1))
										(scrShowPane gScreen "Used")
										)

								;	If this is a shield generator and it has HPs (as opposed to a non-field 
								;	repair device) then we can enhance it.

								(and (itmMatches gItem "s L:1-10;")	
										(gr (itmGetProperty gItem 'maxHP) 0)
										)
									(block Nil
										(switch
											(itmIsDamaged gItem)
												(block Nil
													(setq gTitle (cat "The longzhu sphere glows with stored power and the " (itmGetName gItem 32) " hums with new energy. Your " (itmGetName gItem 32) " has been repaired."))
													(shpRepairItem gPlayerShip gItem)
													)
											(block (result newMod)
												(if (eq (divide (itmIsEnhanced gItem) 0x100) 0x01)
													(setq newMod 0x0100)
													(setq newMod 0x0102)
													)
												(setq result (shpEnhanceItem gPlayerShip gItem newMod))
												(setq gTitle 
													(cat "The longzhu sphere glows with stored power and the " 
														(itmGetName gItem 32) 
														" hums with new energy. " 
														(intItemEnhanceStatus result "Your shield generator is more powerful" "your shield generator")
														"."
														)
													)
												)
											)
										(objRemoveItem gPlayerShip (itmCreate &itLongzhuSphere; 1))
										(scrShowPane gScreen "Used")
										)

								;	Any device that acts like an energyWeapon can be enhanced.

								(itmMatches gItem "d L:1-10; +EnergyWeapon;")
									(block Nil
										(switch
											(itmIsDamaged gItem)
												(block Nil
													(setq gTitle (cat "The longzhu sphere glows with stored power and the " (itmGetName gItem 32) " hums with new energy. Your " (itmGetName gItem 32) " has been repaired."))
													(shpRepairItem gPlayerShip gItem)
													)
											(block (result newMod)
												(if (eq (divide (itmIsEnhanced gItem) 0x100) 0x01)
													(setq newMod 0x0100)
													(setq newMod 0x0102)
													)
												(setq result (shpEnhanceItem gPlayerShip gItem newMod))
												(setq gTitle 
													(cat "The longzhu sphere glows with stored power and the " 
														(itmGetName gItem 32) 
														" hums with new energy. " 
														(intItemEnhanceStatus result "Your weapon is more powerful" "your weapon")
														"."
														)
													)
												)
											)
										(objRemoveItem gPlayerShip (itmCreate &itLongzhuSphere; 1))
										(scrShowPane gScreen "Used")
										)

								;	Drives can also be enhanced.

								(itmMatches gItem "v L:1-10; -Alien")
									(block Nil
										(switch
											(itmIsDamaged gItem)
												(setq gTitle (cat "The longzhu sphere glows with stored power and the " (itmGetName gItem 32) " hums with new energy. Your " (itmGetName gItem 32) " has been repaired."))
											(itmIsEnhanced gItem)
												(setq gTitle (cat "The longzhu sphere glows with stored power and the " (itmGetName gItem 32) " hums with new energy. Your " (itmGetName gItem 32) " is already enhanced and cannot be enhanced further."))
											(setq gTitle (cat "The longzhu sphere glows with stored power and the " (itmGetName gItem 32) " hums with new energy. Your " (itmGetName gItem 32) " has been enhanced."))
											)
										(shpEnhanceItem gPlayerShip gItem)
										(objRemoveItem gPlayerShip (itmCreate &itLongzhuSphere; 1))
										(scrShowPane gScreen "Used")
										)

								(scrShowPane gScreen "NoEffect")
								)
							)
					</Action>

					<Action name="Cancel" cancel="1" key="C">
						<Exit/>
					</Action>

				</Actions>

			</Default>

			<NoEffect>
				<OnPaneInit>
					(scrSetDesc gScreen (cat "The longzhu sphere has no effect on " (itmGetName gItem 4) "."))
				</OnPaneInit>

				<Actions>
					<Action name="Continue" default="1" cancel="1" key="C">
						(scrShowPane gScreen "Default")
					</Action>
				</Actions>
			</NoEffect>

			<Used 
					desc="=gTitle"
					noListNavigation="true"
					>
				<Actions>
					<Action name="Continue" default="1" cancel="1" key="C">
						<Exit/>
					</Action>
				</Actions>
			</Used>
		</Panes>

		<Language>
			<Text id="descUseLongzhuDefault">
				What item do you wish to use the longzhu sphere on?
			</Text>
		</Language>
	</DockScreen>

	<!-- Bering Station -->

	<StationType UNID="&stBeringStation;"
			obsoleteVersion=	"45"
			name=				": Commonwealth residentials|Commonwealth residentials"
			sovereign=			"&svCommonwealth;"
			inherit=			"&baCommonwealthStation;"
				 
			attributes=			"commonwealth, commonwealthCustoms, friendly, human, populated"
				 
			dockScreen=			"Main"
			abandonedScreen=	"&dsRPGAbandonedStation;"

			level=				"4"
			size=				"390"
			armorID=			"&itPlasteelPlate;"
			hitPoints=			"320"
			regen=				"6"
			multiHull=			"true"
				 
			explosionType=		"&vtBlastExplosion2;"
			ejectaType=			"&vtWreckEjecta;"
			>
		
		<!-- Ships and Defenses -->

		<Ships>
			<Lookup table="&tbCommDefenders;"/>
			<Lookup count="1d4+1" table="&tbCommPrivateCrafts;"/>
		</Ships>

		<!-- Image and Effects -->
		
		<Image imageID="&rsCommonwealthResidentials;" imageWidth="320" imageHeight="290" viewportRatio="0.05"/>

		<DockingPorts
				portCount=		"10"
				portRadius=		"175"
				>
		</DockingPorts>
		
		<!-- Dock Screens -->
		
		<DockScreens>
			<Main>
				<Panes>
					<Default descID="descWelcome">
						<Actions>
							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>
						</Actions>
					</Default>
				</Panes>
			</Main>
		</DockScreens>

		<!-- Events and Data -->
		
		<Language>
			<Text id="descWelcome">
				Welcome to Commonwealth Residentials.
			</Text>
		</Language>
	</StationType>

	<!-- Use Armor Patch
	
	GLOBAL DATA
	
	skillLevel:			Total number of successful uses
	
	-->

	<DockScreen UNID="&dsUseArmorPatch;"
			obsoleteVersion=	"46"
			name=				"Ship's Interior"
			type=				"itemPicker"
			>

		<ListOptions
			dataFrom=	"player"
			list=		"aI"
			/>
			
		<InitialPane>
			(switch
				(not (itmIsKnown gItem))
					"UnknownBarrel"
					
				"Default"
				)
		</InitialPane>
			
		<Panes>
			<Default>
				<OnPaneInit>
					(block (type damage desc skillLevel)
						; Init skill level
						(setq skillLevel (typGetGlobalData &dsUseArmorPatch; "skillLevel"))
						(if (not skillLevel)
							(block Nil
								(typSetGlobalData &dsUseArmorPatch; "skillLevel" 0)
								(setq skillLevel 0)
								)
							)
							
						; Intro, if necessary
						
						(setq desc (objFireItemEvent gSource gItem "GetRepairItemIntro"))
						(if (not desc)
							(setq desc "")
							)
							
						; Figure out which segment we're repairing and describe its condition
						
						(setq gArmorSegment (itmGetArmorInstalledLocation (scrGetItem gScreen)))
						(setq type (objGetArmorType gPlayerShip gArmorSegment))
						(setq damage (objGetArmorDamage gPlayerShip gArmorSegment))
						(setq desc (cat desc "The ship's " (objGetArmorName gPlayerShip gArmorSegment) " " (armGetName type)))
						(setq gCanRepair True)
						(switch
							(eq damage 0)
								(block Nil
									(setq desc (cat desc " is not damaged."))
									(setq gCanRepair Nil)
									)

							(eq damage 1)
								(setq desc (cat desc " has sustained 1 point of damage."))

							(setq desc (cat desc " has sustained " damage " points of damage."))
							)
							
						; See if we can repair it with the given item
						
						(if gCanRepair
							(block Nil
								(setq aItemToRepair (scrGetItem gScreen))
								(if (not (objFireItemEvent gSource gItem "CanRepairItem"))
									(block Nil
										(setq desc (cat desc
											"\n\nUnfortunately, it cannot be repaired with the " (itmGetName gItem 0) "."
											))
										(setq gCanRepair Nil)
										)
									)
								)
							)
						
						; Skill level
						(switch
							(not gCanRepair)
								Nil
								
							(ls skillLevel 2)
								(setq desc (cat desc
									"\n\nYou do not have much experience repairing your own armor."
									))
									
							(ls skillLevel 5)
								(setq desc (cat desc
									"\n\nYou have some experience repairing your own armor."
									))
									
							(ls skillLevel 10)
								(setq desc (cat desc
									"\n\nYou are proficient at repairing your own armor."
									))
									
							(setq desc (cat desc
								"\n\nYou are an expert at repairing your own armor."
								))
							)

						(scrSetDesc gScreen desc)

						; Disable actions if we cannot repair
						(scrEnableAction gScreen 0 gCanRepair)
						)
				</OnPaneInit>

				<Actions>
					<Action name="Repair this Armor Segment" key="R" default="1">
						(block Nil
							(setq gTitle (useRepairArmor gItem gArmorSegment))
							(scrShowPane gScreen "Done")
							)
					</Action>

					<Action name="Cancel" cancel="1" key="C">
						<Exit/>
					</Action>
					
				</Actions>
			</Default>
			
			<UnknownBarrel>
				<OnPaneInit>
					(block (desc type)
						(setq gArmorSegment (itmGetArmorInstalledLocation (scrGetItem gScreen)))
						(setq type (objGetArmorType gPlayerShip gArmorSegment))
						(if (itmIsKnown gItem)
							(setq desc (cat "You can use the " (itmGetName gItem 0) " on"))
							(setq desc (cat "The barrel seems to contain some kind of armor paste. You can use it on"))
							)

						(scrSetDesc gScreen (cat desc " your ship's " (objGetArmorName gPlayerShip gArmorSegment) " " (armGetName type) "."))
						)
				</OnPaneInit>

				<Actions>
					<Action name="Use on this Armor Segment" key="U" default="1">
						(block Nil
							; Identify the item [we do this first because we want to refer
							; to the barrel by its real name]
							(itmSetKnown gItem)

							; Repair
							(setq gTitle (useRepairArmor gItem gArmorSegment))
							(setq gTitle (cat
								(itmGetStaticData gItem "BarrelDesc") "\n\n"
								gTitle
								))
								
							(scrShowPane gScreen "Done")
							)
					</Action>

					<Action name="Cancel" key="C" cancel="1">
						<Exit/>
					</Action>
				</Actions>
			</UnknownBarrel>

			<Done 
					desc="=gTitle"
					noListNavigation="true"
					>

				<Actions>
					<Action name="Done" cancel="1" default="1" key="D">
						<Exit/>
					</Action>
				</Actions>
			</Done>
		</Panes>
	</DockScreen>

	<!-- Captured Borer-class gunship

	EXTRA DATA

	status:				Current ship status:
							Nil						= no mission yet
							'captured				= wait until freed
							'rescueInProgress		= player arrived
							'free					= done
	-->

	<ShipClass UNID="&scBorerCaptured;"
			obsoleteVersion=	"46"
			manufacturer=		"United African States"
			class=				"Borer"
			type=				"gunship"

			attributes=			""
			inherit=			"&scBorerStock;"
			>

		<!-- Configuration -->
		
		<Armor
			armorID=			"&itLightReactiveArmor;"
			count=				"4"
			/>
		
		<Devices>
			<Device deviceID="&itMiningLaser;"/>
		</Devices>

		<Items>
			<Item count="1d6" item="&itHelium3FuelRod;"/>
		</Items>

		<!-- AI and Behavior -->

		<Events>
			<OnCreate>
				(block Nil
					(sysAddObjRecurringTimerEvent 61 gSource "OnTimer")
					)
			</OnCreate>

			<OnTimer>
				(block (status)
					(setq status (objGetData gSource "status"))
					(switch
						(eq status 'captured)
							; If the player is in range, then rescue attempt has started
							(if (leq (objGetDistance gSource gPlayerShip) 50)
								(block Nil
									(objSetData gSource "status" 'rescueInProgress)
									(objSendMessage gPlayerShip gSource
										(random
											'(
												"Mayday mayday mayday! We're under attack!"
												"Over here! Help us, please!"
												"Hostiles in the area! Approach with caution!"
												"Mayday mayday mayday! Hostiles in the area!"
												)
											)
										)
									)
								)
						)
					)
			</OnTimer>

			<OrderSetCaptured>
				(block Nil
					(objSetData gSource "status" 'captured)
					(shpCancelOrders gSource)
					(shpOrder gSource 'wait)
					)
			</OrderSetCaptured>

			<OrderSetFree>
				(block (dest)
					(objSetData gSource "status" 'free)

					; Thanks to player
					(objSendMessage gPlayerShip gSource
						(random
							'(
								"You're my savior! I owe you one, buddy."
								"Kacking Centaurians! Can you believe this? Thanks for taking care of them for us!"
								"We're OK! Thanks for blasting the Centaurians!"
								"Nice shooting! Those bastards got what was coming to them!"
								)
							)
						)

					; Back to mining colony
					(setq dest (sysFindObject gSource "TN +commonwealth; +mining; +populated;"))
					(if (not dest)
						(setq dest (sysFindObject gSource "TN +commonwealth; +populated;"))
						)

					(shpCancelOrders gSource)
					(shpOrder gSource 'wait Nil (random 2 4))
					(if dest
						(block Nil
							(shpOrder gSource 'dock dest)
							(shpOrder gSource 'wait Nil (random 6 12))
							)
						)

					; Then gate
					(shpOrder gSource 'gate)
					)
			</OrderSetFree>
		</Events>
	</ShipClass>

	<StationType UNID="&stAbbasidOutpostCompatible;"
			obsoleteVersion=	"48"
			name=				"Abbasid outpost"
			sovereign=			"&svAbbasid;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			dockingPorts=		"8"

			multiHull=			"true"
			armorID=			"&itLightTitaniumArmor;"
			hitPoints=			"90"
			regen=				"1"
			fireRateAdj=		"40"
			explosionType=		"&vtBlastExplosion1;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"enemy, envFire, envAvoidsWater, human, populated"
			>

		<!-- Encounter Info -->

		<Image			imageID="&rsStations1;" imageX="256" imageY="512" imageWidth="128" imageHeight="128"/>

		<Devices>
			<Device deviceID="&itLaserArray;"	omnidirectional="true"/>
		</Devices>

		<Items>
			<Item chance="10"	count="1"		item="&itAbbasidThanogram;" />

			<Item chance="60"	count="1d12"	item="&itHelium3FuelRod;" />
			<Item chance="20"	count="1d12"	item="&itWaterIce;" />
			<Item chance="30"	count="1d12"	item="&itFrozenSupplies;" />
			<Table chance="30">
				<Lookup chance="20" count="1" table="&trConsumables2;"/>
				<Lookup chance="20" count="1" table="&trMinorItem2;"/>
				<Lookup chance="10" count="1" table="&trMajorItem2;"/>
				<Item   chance="50" count="1" item="&itLaserArray;" />
			</Table>
		</Items>

		<Satellites>
			<Orbitals count="1d4" distance="2d8+6" angle="random">
				<Station type="&stShipwreck1;">
					<InitialData>
						<!-- We don't want salvagers to take this loot (technically because
							they don't want to get close to the outpost, but game-wise 
							because we want players to get this loot). -->

						<Data id="core.noSalvage">True</Data>
					</InitialData>
				</Station>
			</Orbitals>
		</Satellites>
	</StationType>

	<!-- Arcology
	
	EXTRA DATA
	
	totalProduced:		Total number of items produced

	-->
	
	<StationType UNID="&stStKatsArcologyOld;"
			obsoleteVersion=	"49"
			name=				"Arcology of New Victoria"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"

			virtual=			"true"
			definiteArticle=	"true"
			
			level=              "7"
			size=				"5000"
			attributes=			"commonwealthCustoms, dockObj, human, majorStation, stKatsArcology"
			>

		<Properties>
			<Constant		id="rpg.checkMilitaryID">"* +militaryID;"</Constant>
			<Constant		id="rpg.showActualItem">True</Constant>
			<Constant		id="rpg.shipBrokerCriteria">"s +systemLevel:0-2; +commonwealth; -notStandard; +shipBroker;"</Constant>
			<DynamicData	id="rpg.shipBrokerInventory">(rpgGetShipInventory gSource)</DynamicData>
		</Properties>

		<Items>
			<RandomItem count="8d10" 
					criteria=		"ad~r L:1-7; -alien; -illegal; -military; -notForSale; -notStandard; -specialty;"
					levelFrequency=	"systemLevel:r|c|cur"
					/>
			<RandomItem count="1d6" 
					criteria=		"r L:3-7; -alien; -illegal; -military; -notForSale; -notStandard;"	
					levelFrequency="systemLevel:ru|c|curv"
					/>
			
			<RandomItem count="20" 
					criteria=		"*~ad -alien; -illegal; -military; -notForSale; -notStandard; -specialty;"
					levelFrequency=	"systemLevel:ru|c|cur"
					/>
					
			<Item count="1d20" item="&itIncandescentCoffee;"/>
		</Items>

		<Trade currency="credit">
			<Sell	criteria="m +commonwealth; -defective; -military; -illegal; -notForSale; -notStandard;" priceAdj="100" inventoryAdj="400" levelFrequency="systemLevel:ruc|c|cur"/>
			<Sell	criteria="*NU -defective; -Illegal; -ID; -NotForSale;"	priceAdj="100"/>
			<Buy	criteria="amdNU -Illegal; -NotForSale;"		priceAdj="50"/>
			<Buy	criteria="*NU -Illegal; -ID; -NotForSale;"	priceAdj="90"/>
			<Buy	criteria="*NU -Illegal; -ID;"				priceAdj="10"/>
			
			<Refuel			criteria="f +BasicFuel; L:1-7;" priceAdj="100"/>
			<RepairArmor	criteria="a L:1-7;" priceAdj="100"/>
			<ReplaceArmor	criteria="a L:1-7;" priceAdj="100"/>
			<InstallDevice	criteria="d L:1-7;" priceAdj="100"/>
			<RemoveDevice	criteria="d L:1-7;" priceAdj="100"/>

			<SellShip		criteria="s -notForSale;" priceAdj="100"/>
			<BuyShip		criteria="s L:1-10; -notForSale;" priceAdj="80"/>

			<BalanceTrade	criteria="{core.fusionFuel}"		impact="20"/>
			<BalanceTrade	criteria="{human.basicFood}"	impact="20"/>
			<BalanceTrade	criteria="{human.lux}"		impact="20"/>
			<BalanceTrade	criteria="{human.meds}"		impact="20"/>
			<BalanceTrade	criteria="{human.res}"		impact="20"/>
			<BalanceTrade	criteria="{core.ore}"			impact="10"/>
		</Trade>
		
		<!-- Satellites -->

		<Satellites>
			<Station type="&stStKatsArcology15;"	xOffset="355"	 yOffset="88"	segment="true"/>
			<Station type="&stStKatsArcology45;"	xOffset="260"	 yOffset="237"	segment="true"/>
			<Station type="&stStKatsArcology75;"	xOffset="95"	 yOffset="320"	segment="true"/>
			<Station type="&stStKatsArcology105;"	xOffset="-95"	 yOffset="320"	segment="true"/>
			<Station type="&stStKatsArcology135;"	xOffset="-260"	 yOffset="237"	segment="true"/>
			<Station type="&stStKatsArcology165;"	xOffset="-355"	 yOffset="88"	segment="true"/>
			<Station type="&stStKatsArcology195;"	xOffset="-355"	 yOffset="-90"	segment="true"/>
			<Station type="&stStKatsArcology225;"	xOffset="-260"	 yOffset="-252"	segment="true"/>
			<Station type="&stStKatsArcology255;"	xOffset="-95"	 yOffset="-323"	segment="true"/>
			<Station type="&stStKatsArcology285;"	xOffset="95"	 yOffset="-323"	segment="true"/>
			<Station type="&stStKatsArcology315;"	xOffset="260"	 yOffset="-252"	segment="true"/>
			<Station type="&stStKatsArcology345;"	xOffset="355"	 yOffset="-90"	segment="true"/>
		</Satellites>
		
		<HeroImage imageID="&rsStKatsArcologyHero;" imageWidth="800" imageHeight="528"/>
		
		<Events>
			<OnCreate>
				(block Nil
					(enum (sysFindObject gSource "T +arcology") theObj
						(block Nil
							; Create some visiting ships
							(for i 1 (random 2 3)
								(block (theShip)
									(setq theShip (sysCreateShip 
										&tbStKatsTraffic;
										(sysVectorPolarOffset theObj (random 0 359) 10)
										&svCommonwealth;
										&evStKatsTrafficBehaviorOld;
										))
										
									(setq aDockObj theObj)
									(objFireEvent theShip "OrderDockAtStKats")
									)
								)
							
							; Register for events from all the objects that make up
							; the arcology
							(objRegisterForEvents gSource theObj)
							)
						)
						
					; Register a callbacks
					(sysAddObjRecurringTimerEvent 60 gSource "OnProduceProduction")
					(sysAddObjRecurringTimerEvent 90 gSource "OnTrafficControl")
					)
			</OnCreate>

			<OnProduceProduction>
				(block Nil
					; Discard any rotted produce
					(enum (objGetItems gSource "* +FreshFood") theItem
						(if (eq (itmGetData theItem "status") 'rotted)
							(block Nil
								(objRemoveItem gSource theItem)
								
								; Rotted items don't count as "produced" so subtract 
								(objIncData gSource "totalProduced" (subtract 0 (itmGetCount theItem)))
								)
							)
						)
						
					; Add fresh produce
					(if (leq (random 1 100) 5)
						(block (produceAvail)
							(setq produceAvail 0)
							(enum (objGetItems gSource "* +FreshFood") theItem
								(setq produceAvail (add produceAvail (itmGetCount theItem)))
								)
							
							(if (and (ls produceAvail 20) 
									(ls (objGetData gSource "totalProduced") 50)
									)
								(block (produceCount theMonth theItemUNID expireTime)
									; Figure out how much to produce
									(setq produceCount (random 10 20))
									
									; Figure out which to produce based on the real
									; calendar
									
									(setq theMonth (item (unvGetRealDate) 1))
									(switch
										(leq theMonth 3)
											(setq theItemUNID &itIncandescentLucuma;)
											
										(leq theMonth 6)
											(setq theItemUNID &itIncandescentPeaches;)
											
										(leq theMonth 9)
											(setq theItemUNID &itIncandescentStrawberries;)
											
										(setq theItemUNID &itIncandescentBellFruit;)
										)
										
									; Expire time
									(setq expireTime (typGetStaticData theItemUNID "expireTime"))
										
									(objAddItem gSource 
										(itmSetData 
											(itmCreate theItemUNID produceCount)
											"expireTime"
											(add (unvGetTick) (random expireTime (add expireTime 1800)))
											produceCount
											)
										)
										
									(objIncData gSource "totalProduced" produceCount)
									)
								)
							)
						)
					)
			</OnProduceProduction>
			
			<OnTrafficControl>
				(block (totalShips)
					; Count the number of ships under traffic control
					(setq totalShips (count (sysFindObject Nil "s D:0010201F_status")))
					
					; If less than the ideal number, new ships jump in
					(if (ls totalShips 50)
						(block (theShip theTarget)
							(setq theShip (sysCreateShip 
								&tbStKatsTraffic;
								(random (sysFindObject Nil "G"))
								&svCommonwealth;
								&evStKatsTrafficBehaviorOld;
								))
								
							(objFireEvent theShip "OrderEnterSystem")
							)
						)
					)
			</OnTrafficControl>

			<GetRumors>
				(append
					(rpgRumorAdd 'stKatsParliament (make 'sequence 1 5) 20)
					)
			</GetRumors>
		</Events>
		
		<Language>
			<Text id="core.mapDescMain">
				"Capital of the Commonwealth"
			</Text>

			<Text id="rumor.stKatsParliament.1">

				You enter the beautiful hall where ministers from all over the 
				Commonwealth gather to legislate and debate.
				
				The minister from Zhang Li makes an impassioned appeal for a 
				bill funding the construction of three new Commonwealth Star 
				Carriers.

				She shows pictures of refugees displaced by the Ares, but the 
				chamber is nearly empty and her energy fades in mid-speech.

			</Text>
			<Text id="rumor.stKatsParliament.2">

				You enter the beautiful hall where ministers from all over the 
				Commonwealth gather to legislate and debate.

				The chamber is nearly full as ministers debate a bill calling 
				for material support to the Huari people. Those in favor cite 
				the cruel treatment the Huari have received under the Sung 
				Slavers.
				
				Those opposed recall that the Huari themselves were once 
				aggressors who killed Commonwealth settlers in the Ungoverned 
				Territories.
				
			</Text>
			<Text id="rumor.stKatsParliament.3">

				You enter the beautiful hall where ministers from all over the 
				Commonwealth gather to legislate and debate.

				The minister from 70 Ophiuchi speaks in the Center Well:

				"...and so I urge my fellow ministers to meet this challenge. 
				With the appropriations of CP1175 we can finally provide enough 
				resources to the Militia in order to secure the safety of our 
				citizens against Marauder tyranny."
				
			</Text>
			<Text id="rumor.stKatsParliament.4">

				You enter the beautiful hall where ministers from all over the 
				Commonwealth gather to legislate and debate.

				The minister from Kinder's Star reads a bill commemorating the 
				death of Militia Colonel Simon Francis Jezerski, who was killed 
				in the line of duty in a confrontation with the Death Drugs 
				Cartel.

			</Text>
			<Text id="rumor.stKatsParliament.5">

				You enter the beautiful hall where ministers from all over the 
				Commonwealth gather to legislate and debate.

				The minister from Numerianus speaks in the Center Well:

				"My fellow citizens, if compassion is not enough to compel you 
				to vote for this bill, then consider the risk that we take by 
				opposing it. If we do not provide a safe home for our zoanthrope
				brethren then the Dwarg will happily exploit them."
				
			</Text>
		</Language>
	</StationType>
	
	<!-- Arcology Segment Base -->
	
	<Type UNID="&baStKatsArcologyBase;"
			obsoleteVersion=	"49"
			>
		<StaticData>
			<NPCService>
				(	;	service					level	margin
					(	'repairArmor			7		100		)
					)
			</NPCService>
		</StaticData>

		<Events>
			<OnDestroy>
				(intCommonwealthOnDestroy)
			</OnDestroy>
			
			<OnDockObjAdj>
				(if (not (objIsAbandoned gSource))
					(sysFindObject Nil "TNV +stKatsArcology;")
					Nil
					)
			</OnDockObjAdj>
		</Events>
	</Type>
	
	<!-- Arcology 15 -->
	
	<StationType UNID="&stStKatsArcology15;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="45" imageY="0" imageWidth="115" imageHeight="220"/>

		<DockingPorts>
			<Port x="39"	y="60"	rotation="-159" />
			<Port x="55"	y="18"	rotation="-164"/>
			<Port x="67"	y="-31" rotation="-170"/>
			<Port x="-34"	y="-38" rotation="10"/>
			<Port x="-48"	y="8"	rotation="19"/>
		</DockingPorts>
	</StationType>
	
	<!-- Arcology 45 -->
	
	<StationType UNID="&stStKatsArcology45;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="0" imageY="245" imageWidth="220" imageHeight="180"/>

		<DockingPorts>
			<Port x="7"		y="76"	rotation="-128" />
			<Port x="45"	y="45"	rotation="-134"/>
			<Port x="80"	y="8"	rotation="-141"/>
			<Port x="-22"	y="-55"	rotation="42"/>
			<Port x="-53"	y="-15"	rotation="50"/>
		</DockingPorts>
	</StationType>
	
	<!-- Arcology 75 -->
	
	<StationType UNID="&stStKatsArcology75;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="0" imageY="500" imageWidth="220" imageHeight="115"/>

		<DockingPorts>
			<Port x="-30"	y="70"	rotation="-94" />
			<Port x="26"	y="65"	rotation="-102"/>
			<Port x="76"	y="49"	rotation="-112"/>
			<Port x="18"	y="-65"	rotation="69"/>
			<Port x="-33"	y="-45"	rotation="77"/>
		</DockingPorts>
	</StationType>
	
	<!-- Arcology 105 -->
	
	<StationType UNID="&stStKatsArcology105;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="220" imageY="500" imageWidth="220" imageHeight="115"/>

		<DockingPorts>
			<Port x="-72"	y="48"	rotation="-70" />
			<Port x="-22"	y="62"	rotation="-74"/>
			<Port x="31"	y="71"	rotation="-80"/>
			<Port x="36"	y="-46"	rotation="107"/>
			<Port x="-21"	y="-57"	rotation="102"/>
		</DockingPorts>
	</StationType>
	
	<!-- Arcology 135 -->
	
	<StationType UNID="&stStKatsArcology135;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="220" imageY="245" imageWidth="220" imageHeight="180"/>

		<DockingPorts>
			<Port x="-84"	y="14"	rotation="-37" />
			<Port x="-48"	y="51"	rotation="-47"/>
			<Port x="-8"	y="76"	rotation="-56"/>
			<Port x="49"	y="-20"	rotation="138"/>
			<Port x="13"	y="-52"	rotation="132"/>
		</DockingPorts>
	</StationType>
	
	<!-- Arcology 165 -->
	
	<StationType UNID="&stStKatsArcology165;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="280" imageY="0" imageWidth="115" imageHeight="220"/>

		<DockingPorts>
			<Port x="-70"	y="-29"	rotation="-6" />
			<Port x="-61"	y="22"	rotation="-14"/>
			<Port x="-42"	y="62"	rotation="-23"/>
			<Port x="53"	y="9"	rotation="168"/>
			<Port x="38"	y="-39"	rotation="161"/>
		</DockingPorts>
	</StationType>
	
	<!-- Arcology 195 -->
	
	<StationType UNID="&stStKatsArcology195;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="500" imageY="0" imageWidth="115" imageHeight="220"/>

		<DockingPorts>
			<Port x="-48"	y="-54"	rotation="21" />
			<Port x="-65"	y="-9"	rotation="12"/>
			<Port x="-70"	y="37"	rotation="3"/>
			<Port x="35"	y="35"	rotation="-161"/>
			<Port x="54"	y="-10"	rotation="-167"/>
		</DockingPorts>
	</StationType>
	
	<!-- Arcology 225 -->
	
	<StationType UNID="&stStKatsArcology225;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="440" imageY="245" imageWidth="220" imageHeight="180"/>

		<DockingPorts>
			<Port x="-6"	y="-75"	rotation="56" />
			<Port x="-51"	y="-43"	rotation="47"/>
			<Port x="-88"	y="0"	rotation="35"/>
			<Port x="11"	y="60"	rotation="-131"/>
			<Port x="48"	y="27"	rotation="-139"/>
		</DockingPorts>
	</StationType>
	
	<!-- Arcology 255 -->
	
	<StationType UNID="&stStKatsArcology255;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="440" imageY="485" imageWidth="220" imageHeight="115"/>

		<DockingPorts>
			<Port x="37"	y="-73"	rotation="84" />
			<Port x="-22"	y="-62"	rotation="74"/>
			<Port x="-77"	y="-43"	rotation="63"/>
			<Port x="-18"	y="57"	rotation="-105"/>
			<Port x="32"	y="44"	rotation="-107"/>
		</DockingPorts>
	</StationType>
	
	<!-- Arcology 285 -->
	
	<StationType UNID="&stStKatsArcology285;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="660" imageY="485" imageWidth="220" imageHeight="115"/>

		<DockingPorts>
			<Port x="77"	y="-50"	rotation="114" />
			<Port x="24"	y="-66"	rotation="103"/>
			<Port x="-30"	y="-73"	rotation="93"/>
			<Port x="-41"	y="40"	rotation="-80"/>
			<Port x="16"	y="54"	rotation="-73"/>
		</DockingPorts>
	</StationType>
	
	<!-- Arcology 315 -->
	
	<StationType UNID="&stStKatsArcology315;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="660" imageY="245" imageWidth="220" imageHeight="180"/>

		<DockingPorts>
			<Port x="85"	y="2"	rotation="146" />
			<Port x="53"	y="-35"	rotation="134"/>
			<Port x="10"	y="-65"	rotation="125"/>
			<Port x="-48"	y="28"	rotation="-54"/>
			<Port x="-9"	y="60"	rotation="-47"/>
		</DockingPorts>
	</StationType>
	
	<!-- Arcology 345 -->
	
	<StationType UNID="&stStKatsArcology345;"
			obsoleteVersion=	"49"
			name=				"New Victoria arcology segment"
			sovereign=			"&svCommonwealth;"
			dockScreen=			"&dsStKatsArcology;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			noMapLabel=			"true"

			multiHull=			"true"
			armorID=			"&itBlastPlate;"
			hitPoints=			"1000"
			regen=				"20"
			shipRegen=			"6"
			explosionType=		"&vtBlastExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"arcology, commonwealth, commonwealthCustoms, friendly, human, majorStation, populated"

			inherit=			"&baStKatsArcologyBase;"
			>

		<Image imageID="&rsStKatsArcology;" imageX="705" imageY="0" imageWidth="115" imageHeight="220"/>

		<DockingPorts>
			<Port x="72"	y="39"	rotation="162" />
			<Port x="63"	y="-9"	rotation="170"/>
			<Port x="47"	y="-56"	rotation="178"/>
			<Port x="-51"	y="-10"	rotation="-19"/>
			<Port x="-33"	y="43"	rotation="-11"/>
		</DockingPorts>
	</StationType>
	
	<ShipClass UNID="&evStKatsTrafficBehaviorOld;"
			obsoleteVersion=	"49"
			class=				"(St Katharine's traffic behavior)"
			virtual=			"true"
			
			attributes=			"behaviorClass"
			>

		<Events>
			<OrderDockAtStKats>
				(block Nil
					(shpOrder gSource 'dock aDockObj)
					(shpOrder gSource 'waitForThreat (random 10 200))
					(objSetData gSource "0010201F_status" 'dockedAtNewVictoria)
					)
			</OrderDockAtStKats>
			
			<OrderEnterSystem>
				(objSetData gSource "0010201F_status" 'enteredSystem)
			</OrderEnterSystem>
			
			<OnOrdersCompleted>
				(block (status dockedAt allLoot)
					; Different order depending on our current state
					(setq status (objGetData gSource "0010201F_status"))
					(setq dockedAt (shpGetDockObj gSource))
					
					; If we're docked at an object, dump any loot that we found
					(if (and dockedAt
							(objHasAttribute dockedAt "populated")
							
							; Compose a list of all loot on board that the station
							; might want to buy from us.
							
							(setq allLoot (filter (objGetItems gSource "*~mf U") theItem
								(objGetBuyPrice dockedAt theItem)
								))
							)
						(block Nil
							(enum allLoot theItem (objRemoveItem gSource theItem))
							(enum allLoot theItem (objAddItem dockedAt theItem))
							)
						)
					
					; Figure out what to do next
					(switch
						(eq status 'enteredSystem)
							(block Nil
								(setq theTarget (random (sysFindObject gSource "T +arcology")))
								(shpOrder gSource 'orbit (sysFindObject Nil "TNV +stKatsArcology;") 20 (random 20 40))
								(shpOrder gSource 'dock theTarget)
								(shpOrder gSource 'waitForThreat (random 10 60))
								(objSetData gSource "0010201F_status" 'dockedAtNewVictoria)
								)
								
						(eq status 'dockedAtNewVictoria)
							(block (roll allWrecks)
								; When leaving new victoria, orbit around for a bit
								(shpOrder gSource 'orbit (sysFindObject Nil "TNV +stKatsArcology;") 20 (random 20 40))
								
								; Randomly choose a path
								(setq roll (random 1 100))
								(switch
									; Gate out
									(leq roll 30)
										(block Nil
											(shpOrder gSource 'gate)
											(objSetData gSource "0010201F_status" 'leavingSystem)
											)
											
									; If there are wrecks in the area, loot them
									(and (leq (objGetDestiny gSource) 180)
											(not (objHasAttribute gSource "freighter"))
											(leq (random 1 100) 50)
											
											; Compose a list of all wrecks in the area
											
											(setq allWrecks (rpgFindWrecksToSalvage gSource '0010201F_marked))
											)
										(block (destObj)
											(setq destObj (random allWrecks))
											(shpOrder gSource 'loot destObj)
											(objSetData destObj "0010201F_marked" True)
											(objSetData gSource "0010201F_status" 'dockedAtStation)
											)
											
									; Dock at a random station in the system
									(block (theTarget)
										(setq theTarget (random (sysFindObject gSource "TAF +populated; -arcology; -occupation;")))
										(shpOrder gSource 'dock theTarget)
										(shpOrder gSource 'waitForThreat (random 10 20))
										(objSetData gSource "0010201F_status" 'dockedAtStation)
										)
									)
								)
								
						(eq status 'dockedAtStation)
							(block (roll allWrecks)
								; Randomly choose a path
								(setq roll (random 1 100))
								(switch
									; Gate out
									(leq roll 30)
										(block Nil
											(shpOrder gSource 'gate)
											(objSetData gSource "0010201F_status" 'leavingSystem)
											)
											
									; If there are wrecks in the area, loot them
									(and (leq (objGetDestiny gSource) 180)
											(not (objHasAttribute gSource "freighter"))
											(leq (random 1 100) 50)
											
											; Compose a list of all wrecks in the area
											
											(setq allWrecks (rpgFindWrecksToSalvage gSource '0010201F_marked))
											)
										(block (destObj)
											(setq destObj (random allWrecks))
											(shpOrder gSource 'loot destObj)
											(objSetData destObj "0010201F_marked" True)
											(objSetData gSource "0010201F_status" 'dockedAtStation)
											)
											
									; Dock at new victoria
									(leq roll 80)
										(block (theTarget)
											(setq theTarget (random (sysFindObject gSource "T +arcology")))
											(shpOrder gSource 'orbit (sysFindObject Nil "TNV +stKatsArcology;") 20 (random 20 40))
											(shpOrder gSource 'dock theTarget)
											(shpOrder gSource 'waitForThreat (random 10 60))
											(objSetData gSource "0010201F_status" 'dockedAtNewVictoria)
											)
											
									; Dock at a random station in the system
									(block (theTarget)
										(setq theTarget (random (sysFindObject gSource "TAF +populated; -arcology; -occupation;")))
										(shpOrder gSource 'dock theTarget)
										(shpOrder gSource 'waitForThreat (random 10 20))
										(objSetData gSource "0010201F_status" 'dockedAtStation)
										)
									)
								)
						)
						
					; If we were docked at an object that we just looted, then destroy the object
					(if (and (objGetData dockedAt "0010201F_marked")
							(ls (objGetProperty dockedAt 'mass) 2000)
							(not (objGetProperty dockedAt 'immutable))
							)
						(objDestroy dockedAt gSource)
						)
					)
			</OnOrdersCompleted>
		</Events>
	</ShipClass>
	
	<StationType UNID="&stSungSlaveQuarters1;"
			obsoleteVersion=	"49"
			name=				"Sung slave quarters|Sung slave quarters"
			sovereign=			"&svSungSlaves;"

			attributes=			"sungSlaveQuarters"

			dockScreen=			"&dsSungSlaveQuarters;"
			abandonedScreen=	"&dsRPGAbandonedStation;"

			mass=				"3000"
			armorID=			"&itUltraLightTitaniumArmor;"
			hitPoints=			"35"
			multiHull=			"true"
			structuralHitPoints="30"

			noMapLabel=			"true"
			ejectaType=			"&vtWreckEjecta;"
			>

		<!-- Image and Effects -->

		<ImageVariants>
			<Image			imageID="&rsStations4;" imageX="192" imageY="32" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="192" imageY="64" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="192" imageY="96" imageWidth="32" imageHeight="32"/>
		</ImageVariants>

		<DockingPorts
				portCount=		"2"
				portRadius=		"24"
				maxDist=		"3"
				/>

		<!-- Events and Data -->

		<InitialData>
			<sungSlave>True</sungSlave>
		</InitialData>

		<Language>
			<Text id="core.abandonedStationDesc">

				You are docked at a ruined structure once housing slaves.
				Lifeless forms float around in zero-G amid the scraps and mementos they once owned.

			</Text>
		</Language>
	</StationType>

	<!-- Sung Slave Quarters -->

	<StationType UNID="&stSungSlaveQuarters2;"
			obsoleteVersion=	"49"
			name=				"Sung slave quarters|Sung slave quarters"
			sovereign=			"&svSungSlaves;"

			attributes=			"sungSlaveQuarters"

			dockScreen=			"&dsSungSlaveQuarters;"
			abandonedScreen=	"&dsRPGAbandonedStation;"


			mass=				"3000"
			armorID=			"&itUltraLightTitaniumArmor;"
			hitPoints=			"30"
			structuralHitPoints="10"

			noMapLabel=			"true"
			ejectaType=			"&vtWreckEjecta;"
			>

		<!-- Image and Effects -->

		<ImageVariants>
			<Image			imageID="&rsStations4;" imageX="224" imageY="0"  imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="224" imageY="32" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="224" imageY="64" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="224" imageY="96" imageWidth="32" imageHeight="32"/>
		</ImageVariants>

		<DockingPorts
				portCount=		"2"
				portRadius=		"24"
				maxDist=		"3"
				/>

		<!-- Events and Data -->

		<InitialData>
			<sungSlave>True</sungSlave>
		</InitialData>

		<Language>
			<Text id="core.abandonedStationDesc">

				You are docked at a ruined structure once housing slaves.
				Lifeless forms float around in zero-G amid the scraps and mementos they once owned.

			</Text>
		</Language>
	</StationType>

	<!-- Sung Fortress -->

	<StationType UNID="&stSungFortressOld;"
			obsoleteVersion=	"49"
			name=				"Sung fortress(es)"
			sovereign=			"&svSung;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			dockingPorts=		"8"

			multiHull=			"true"
			armorID=			"&itSungArmor;"
			hitPoints=			"400"
            regen=              "11"
			explosionType=		"&vtBlastExplosion4;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"enemy, envAir, envEarth, envFire, envWater, human, majorStation, populated, sungSlavers"
			>
		<Image			imageID="&rsStations4;" imageX="0" imageY="192" imageWidth="128" imageHeight="128"/>

		<Ships>
			<Table>
				<Ship chance="30"	count="2d6" class="&scWindSlaver;"		orders="patrol" patrolDist="20"/>
				<Group chance="60">
					<Ship			count="1"	class="&scSteelSlaver;"		orders="patrol" patrolDist="20"/>
					<Ship			count="2d4"	class="&scWindSlaver;"		orders="patrol" patrolDist="20"/>
				</Group>
				<Ship chance="10"	count="1d4"	class="&scSteelSlaver;"		orders="patrol" patrolDist="20"/>
			</Table>
		</Ships>

		<Reinforcements minShips="3">
			<Table>
				<Ship chance="75"	count="1d4"	class="&scWindSlaver;"	orders="patrol" patrolDist="20"/>
				<Ship chance="25"	count="1d2"	class="&scSteelSlaver;"	orders="patrol" patrolDist="20"/>
			</Table>
		</Reinforcements>

		<Items>
			<Lookup					count="1d4"	table="&trStationSupplies;" />
			<Lookup					count="1"	table="&trConsumables6;"/>
			<Lookup					count="1"	table="&trMinorItem6;"/>
			<Table chance="75">
				<Lookup chance="40" count="1" table="&trConsumables7;"/>
				<Lookup chance="40" count="1" table="&trMinorItem7;"/>
				<Lookup chance="20" count="1" table="&trMajorItem7;"/>
			</Table>
		</Items>

		<Encounters frequency="common">
			<Ship   count="1d4"	class="&scWindSlaver;" orders="attack"/>
		</Encounters>

		<Satellites>
			<Station type="&stSungNEWall;" xOffset="64" yOffset="64"	segment="true"/>
			<Station type="&stSungNWWall;" xOffset="-64" yOffset="64"	segment="true"/>
			<Station type="&stSungSWWall;" xOffset="-64" yOffset="-64"	segment="true"/>
			<Station type="&stSungSEWall;" xOffset="64" yOffset="-64"	segment="true"/>
		</Satellites>

	</StationType>

	<!-- Sung Walls -->

	<StationType UNID="&stSungNWWall;"
			obsoleteVersion=	"49"
			name=				"Sung defense tower"
			sovereign=			"&svSung;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			dockingPorts=		"4"
			noMapLabel=			"true"
			noFriendlyFire=		"true"

			mass=				"50000"
			multiHull=			"true"
			armorID=			"&itSungArmor;"
			hitPoints=			"120"
			structuralHitPoints="100"
			fireRateAdj=		"30"
			ejectaType=			"&vtWreckEjecta;"
			>

		<Image			imageID="&rsStations5;" imageX="0" imageY="0" imageWidth="128" imageHeight="128"/>

		<Devices>
			<Device deviceID="&itParticleBeamWeapon;"	omnidirectional="true"/>
		</Devices>

	</StationType>

	<StationType UNID="&stSungNEWall;"
			obsoleteVersion=	"49"
			name=				"Sung defense tower"
			sovereign=			"&svSung;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			dockingPorts=		"4"
			noMapLabel=			"true"
			noFriendlyFire=		"true"

			mass=				"50000"
			multiHull=			"true"
			armorID=			"&itSungArmor;"
			hitPoints=			"120"
			structuralHitPoints="100"
			fireRateAdj=		"30"
			ejectaType=			"&vtWreckEjecta;"
			>

		<Image			imageID="&rsStations5;" imageX="128" imageY="0" imageWidth="128" imageHeight="128"/>

		<Devices>
			<Device deviceID="&itParticleBeamWeapon;"	omnidirectional="true"/>
		</Devices>

	</StationType>

	<StationType UNID="&stSungSEWall;"
			obsoleteVersion=	"49"
			name=				"Sung defense tower"
			sovereign=			"&svSung;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			dockingPorts=		"4"
			noMapLabel=			"true"
			noFriendlyFire=		"true"

			mass=				"50000"
			multiHull=			"true"
			armorID=			"&itSungArmor;"
			hitPoints=			"120"
			structuralHitPoints="100"
			fireRateAdj=		"30"
			ejectaType=			"&vtWreckEjecta;"
			>

		<Image			imageID="&rsStations5;" imageX="128" imageY="128" imageWidth="128" imageHeight="128"/>

		<Devices>
			<Device deviceID="&itParticleBeamWeapon;"	omnidirectional="true"/>
		</Devices>

	</StationType>

	<StationType UNID="&stSungSWWall;"
			obsoleteVersion=	"49"
			name=				"Sung defense tower"
			sovereign=			"&svSung;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			dockingPorts=		"4"
			noMapLabel=			"true"
			noFriendlyFire=		"true"

			mass=				"50000"
			multiHull=			"true"
			armorID=			"&itSungArmor;"
			hitPoints=			"120"
			structuralHitPoints="100"
			fireRateAdj=		"30"
			ejectaType=			"&vtWreckEjecta;"
			>

		<Image			imageID="&rsStations5;" imageX="0" imageY="128" imageWidth="128" imageHeight="128"/>

		<Devices>
			<Device deviceID="&itParticleBeamWeapon;"	omnidirectional="true"/>
		</Devices>

	</StationType>

	<!-- Sung Citadel -->

	<StationType UNID="&stSungCitadelOld;"
			obsoleteVersion=	"50"
			name=				"Sung citadel"
			sovereign=			"&svSung;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			dockingPorts=		"8"

			multiHull=			"true"
			armorID=			"&itSungArmor;"
			hitPoints=			"1500"
            regen=              "11"
			fireRateAdj=		"20"
			explosionType=		"&vtThermoExplosion3;"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"enemy, human, majorStation, populated, sungSlavers"
			>

		<!-- Encounter Info -->

		<Image			imageID="&rsStations6;" imageX="0" imageY="0" imageWidth="256" imageHeight="256"/>

		<Devices>
			<Device deviceID="&itCyberDeckLowerShields;"/>
			<Device deviceID="&itParticleBeamWeapon;"	omnidirectional="true" posAngle="40"  posRadius="120"/>
			<Device deviceID="&itParticleBeamWeapon;"	omnidirectional="true" posAngle="145" posRadius="125"/>
			<Device deviceID="&itParticleBeamWeapon;"	omnidirectional="true" posAngle="270" posRadius="90"/>
		</Devices>

		<Ships>
			<Table>
				<Group chance="60">
					<Ship			count="1"	class="&scEarthSlaver;"		orders="patrol" patrolDist="30"/>
					<Ship			count="1d2"	class="&scSteelSlaver;"		orders="patrol" patrolDist="20"/>
					<Ship			count="1d3"	class="&scWindSlaver;"		orders="patrol" patrolDist="20"/>
				</Group>
				<Group chance="30">
					<Ship			count="1"	class="&scEarthSlaver;"		orders="patrol" patrolDist="30"/>
					<Ship			count="1d6"	class="&scWindSlaver;"		orders="patrol" patrolDist="20"/>
				</Group>
				<Group chance="10">
					<Ship			count="1d4"	class="&scSteelSlaver;"		orders="patrol" patrolDist="20"/>
					<Ship			count="1d6"	class="&scWindSlaver;"		orders="patrol" patrolDist="20"/>
				</Group>
			</Table>
		</Ships>

		<Reinforcements minShips="5">
			<Table>
				<Ship chance="50"	count="1d3"	class="&scWindSlaver;"	orders="patrol" patrolDist="20"/>
				<Ship chance="30"	count="1d2"	class="&scSteelSlaver;"	orders="patrol" patrolDist="20"/>
				<Ship chance="20"	count="1"	class="&scEarthSlaver;"	orders="patrol" patrolDist="30"/>
			</Table>
		</Reinforcements>

		<Items>
			<Item chance="80"		count="1d4" item="&itLongzhuSphere;"/>
			<Lookup					count="1d4"	table="&trStationSupplies;" />
			<Lookup					count="1"	table="&trConsumables6;"/>
			<Lookup					count="1"	table="&trMinorItem6;"/>
			<Table>
				<Lookup chance="45" count="1" table="&trConsumables7;"/>
				<Lookup chance="30" count="1" table="&trMinorItem7;"/>
				<Lookup chance="25" count="1" table="&trMajorItem7;"/>
			</Table>
		</Items>

		<Encounters frequency="common">
			<Table>
				<Ship chance="30"	count="2d3" class="&scWindSlaver;"		orders="attack"/>
				<Group chance="60">
					<Ship			count="1"	class="&scSteelSlaver;"		orders="attack"/>
					<Ship			count="1d4"	class="&scWindSlaver;"		orders="attack"/>
				</Group>
				<Ship chance="10"	count="1d4"	class="&scSteelSlaver;"		orders="attack"/>
			</Table>
		</Encounters>

		<Satellites overlapCheck="asteroids">
			<Orbitals count="8" distance="14" angle="equidistant">
				<Station type="&stSungDefenseSat1;"/>
			</Orbitals>
		</Satellites>

	</StationType>

	<!-- Old Effects -->
	
	<Effect UNID="&efLargeExplosion1;"	obsoleteVersion="49">
		<Image imageID="&rsLargeExplosions;" 
				imageX="0" 
				imageY="0" 
				imageWidth="128" 
				imageHeight="128"
				imageFrameCount="16"
				imageTicksPerFrame="2"/>
	</Effect>

	<!-- Old Image -->

	<Image UNID="&rsEI100Image;"	obsoleteVersion="40" bitmap="Resources\EI100.jpg" 		bitmask="Resources\EI100Mask.bmp" loadOnUse="true"/>
	<Image UNID="&rsEI200Image;"		obsoleteVersion="40" bitmap="Resources\EI200.jpg" bitmask="Resources\EI200Mask.bmp" loadOnUse="true"/>
	<Image UNID="&rsSapphireYachtHD;"	obsoleteVersion="41" bitmap="Resources\SapphireYachtHD.jpg" bitmask="Resources\SapphireYachtHDMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsMolotok;"		obsoleteVersion="41"	bitmap="Resources\Molotok.jpg" bitmask="Resources\MolotokMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsT31ArmedTransport;"	obsoleteVersion="41" bitmap="Resources\T31Transport.jpg"		bitmask="Resources\T31TransportMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsT55ArmedTransport;"	obsoleteVersion="41" bitmap="Resources\T55Transport.jpg"		bitmask="Resources\T55TransportMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsIAVHeavy;"	obsoleteVersion="41"				bitmap="Resources\IAVHeavy.jpg" bitmask="Resources\IAVHeavyMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsHimalInterceptorHD;"	obsoleteVersion="43"		bitmap="Resources\HimalInterceptorHD.jpg"		bitmask="Resources\HimalInterceptorHDMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsCSC;"			obsoleteVersion="43"		bitmap="Resources\CSC.jpg" bitmask="Resources\CSCMask.bmp" loadOnUse="true" />
	<Image UNID="&rsCSCBkgnd;"		obsoleteVersion="43" bitmap="Resources\CSCScreen.jpg" loadOnUse="true" />
	<Image UNID="&rsCharonFrigateImage;"	obsoleteVersion="43"	bitmap="Resources\CharonFrigate.jpg" bitmask="Resources\CharonFrigateMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsTripoli;"	obsoleteVersion="43"			bitmap="Resources\Tripoli.jpg"		bitmask="Resources\TripoliMask.bmp"  	loadOnUse="true"/>
	<Image UNID="&rsCorporateCruiser;"	obsoleteVersion="43"	bitmap="Resources\CorporateCruiser.jpg" bitmask="Resources\CorporateCruiserMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsEI7000Image;"	obsoleteVersion="43"		bitmap="Resources\EI7000.jpg" bitmask="Resources\EI7000Mask.bmp" loadOnUse="true"/>
	<Image UNID="&rsManufacturingPlant;"	obsoleteVersion="44" bitmap="Resources\ManufacturingPlant.jpg" bitmask="Resources\ManufacturingPlantMask.bmp" loadOnUse="true"/>

	<Image UNID="&rsAntaresIImage;"		obsoleteVersion="45"	bitmap="Resources\AntaresI.jpg" bitmask="Resources\AntaresIMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsAntaresIIImage;"	obsoleteVersion="45"	bitmap="Resources\AntaresII.jpg" bitmask="Resources\AntaresIIMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsAntaresVImage;"		obsoleteVersion="45"	bitmap="Resources\AntaresV.jpg" bitmask="Resources\AntaresVMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsAresSentryHD;"		obsoleteVersion="39" bitmap="Resources\AresSentryHD.jpg" bitmask="Resources\AresSentryHDMask.bmp" loadOnUse="true" />
	<Image UNID="&rsCometfall;"			obsoleteVersion="45"					bitmap="Resources\Cometfall.jpg" bitmask="Resources\CometfallMask.bmp" loadOnUse="true" />
	<Image UNID="&rsDeimos;"			obsoleteVersion="45"		bitmap="Resources\Deimos.jpg" bitmask="Resources\DeimosMask.bmp" loadOnUse="true" />
	<Image UNID="&rsPolarFreighter;"	obsoleteVersion="45"		bitmap="Resources\PolarFreighter.jpg" bitmask="Resources\PolarFreighterMask.bmp" loadOnUse="true" />
	<Image UNID="&rsAurochs;"			obsoleteVersion="45"	bitmap="Resources\Aurochs.jpg" bitmask="Resources\AurochsMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsAquila;"			obsoleteVersion="45"	bitmap="Resources\Aquila.jpg" bitmask="Resources\AquilaMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsIocrymSentinel;"	obsoleteVersion="45" bitmap="Resources\IocrymSentinel.jpg" bitmask="Resources\IocrymSentinelMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsIocrymCommandShip;"	obsoleteVersion="45" bitmap="Resources\IocrymCommandShip.jpg" bitmask="Resources\IocrymCommandShipMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsHurin;"				obsoleteVersion="45"		bitmap="Resources\Hurin.jpg"		bitmask="Resources\HurinMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsSteelSlaverHD;"		obsoleteVersion="46" bitmap="Resources\SteelSlaverHD.jpg"	bitmask="Resources\SteelSlaverHDMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsZulu;"				obsoleteVersion="46"				bitmap="Resources\Zulu.jpg"				bitmask="Resources\ZuluMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsBorer;"				obsoleteVersion="46"			bitmap="Resources\Borer.jpg" bitmask="Resources\BorerMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsWolfenGunship;"		obsoleteVersion="46" bitmap="Resources\ShipsWolfenGunship.jpg" bitmask="Resources\ShipsWolfenGunshipMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsWolfenGunshipHD;"	obsoleteVersion="46" bitmap="Resources\WolfenGunshipHD.jpg" bitmask="Resources\WolfenGunshipHDMask.bmp" loadOnUse="true"/>

	<Image UNID="&rsStKatsArcology;"	obsoleteVersion="49"		bitmap="Resources\StKatsArcologyOld.jpg" bitmask="Resources\StKatsArcologyOldMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsStKatsArcologyScreen;" obsoleteVersion="49"		bitmap="Resources\StKatsArcologyScreen.jpg" loadOnUse="true"/>
	<Image UNID="&rsStKatsArcologySchematic;" obsoleteVersion="49"	bitmap="Resources\StKatsArcologySchematic.jpg" bitmask="Resources\StKatsArcologySchematicMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsCorporateExplorer;"	obsoleteVersion="49" bitmap="Resources\CorporateExplorer.jpg" bitmask="Resources\CorporateExplorerMask.bmp" loadOnUse="true"/>

	<Image UNID="&rsSmallShips1;"		obsoleteVersion="49" bitmap="Resources\SmallShips1.jpg"	bitmask="Resources\SmallShips1Mask.bmp" loadOnUse="true"/>
	<Image UNID="&rsMediumShips1;"		obsoleteVersion="49"	bitmap="Resources\MediumShips1.jpg"	bitmask="Resources\MediumShips1Mask.bmp" loadOnUse="true"/>
	<Image UNID="&rsMediumShips2;"		obsoleteVersion="49" bitmap="Resources\MediumShips2.jpg"	bitmask="Resources\MediumShips2Mask.bmp" loadOnUse="true"/>
	<Image UNID="&rsMediumShips3;"		obsoleteVersion="49" bitmap="Resources\MediumShips3.jpg"	bitmask="Resources\MediumShips3Mask.bmp" loadOnUse="true"/>
	<Image UNID="&rsMediumShips4;"		obsoleteVersion="49" bitmap="Resources\MediumShips4.jpg"	bitmask="Resources\MediumShips4Mask.bmp" loadOnUse="true"/>
	<Image UNID="&rsLargeShips2;"		obsoleteVersion="49"	bitmap="Resources\LargeShips2.jpg"	bitmask="Resources\LargeShips2Mask.bmp" loadOnUse="true"/>
	<Image UNID="&rsSungTransport;"		obsoleteVersion="49" bitmap="Resources\SungTransport.jpg"	bitmask="Resources\SungTransportMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsSalvagerNomad;"		obsoleteVersion="49"				bitmap="Resources\SalvagerNomad.jpg"		bitmask="Resources\SalvagerNomadMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsXenophobeDefender;"	obsoleteVersion="49"		bitmap="Resources\XenophobeDefender.jpg"		bitmask="Resources\XenophobeDefenderMask.bmp"	loadOnUse="true"/>
	<Image UNID="&rsRanxDreadnought;"	obsoleteVersion="49"		bitmap="Resources\RanxDreadnought.jpg"		bitmask="Resources\RanxDreadnoughtMask.bmp"	loadOnUse="true"/>
	<Image UNID="&rsDragonSlaverImage;"	obsoleteVersion="49" bitmap="Resources\DragonSlaver.jpg"		bitmask="Resources\DragonSlaverMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsStargate;"			obsoleteVersion="49" bitmap="Resources\Stargates1.jpg"		bitmask="Resources\Stargates1Mask.bmp"  />
	<Image UNID="&rsShipInterior;"		obsoleteVersion="49" bitmap="Resources\ShipInterior.jpg"			loadOnUse="true" />
	<Image UNID="&rsLargeExplosions;"	obsoleteVersion="49" bitmap="Resources\LargeExplosions.jpg" bitmask="Resources\LargeExplosionsMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsVentariDestroyer;"	obsoleteVersion="49" bitmap="Resources\VentariDestroyer.jpg" bitmask="Resources\VentariDestroyerMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsLargeShips1;"		obsoleteVersion="49" bitmap="Resources\LargeShips1.jpg"	bitmask="Resources\LargeShips1Mask.bmp" loadOnUse="true"/>
	<Image UNID="&rsUrakDestroyer;"		obsoleteVersion="49" bitmap="Resources\UrakDestroyer.jpg" 	bitmask="Resources\UrakDestroyerMask.bmp" loadOnUse="true"/>
	<Image UNID="&rsHeliotropeFrigate;"	obsoleteVersion="49"			bitmap="Resources\HeliotropeFrigate.jpg"		bitmask="Resources\HeliotropeFrigateMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsFerianWarrior;"		obsoleteVersion="49"		bitmap="Resources\FerianWarrior.jpg"	bitmask="Resources\FerianWarriorMask.bmp"	loadOnUse="true"/>
	<Image UNID="&rsXenophobeWorldship;"	obsoleteVersion="49"		bitmap="Resources\XenophobeWorldship.jpg"		bitmask="Resources\XenophobeWorldshipMask.bmp"  loadOnUse="true"/>
	<Image UNID="&rsXenophobeArk;"		obsoleteVersion="49"		bitmap="Resources\XenophobeArk.jpg"				bitmask="Resources\XenophobeArkMask.bmp"  		loadOnUse="true"/>

</TranscendenceModule>
